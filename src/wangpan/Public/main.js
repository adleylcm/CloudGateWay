"use strict";require.config({baseUrl:"//j2.s.ksyun.com/pan/v1.1/1378294456726",paths:{jquery:"//j1.s.ksyun.com/lib/jquery/1.7.1",ca:"//j1.s.ksyun.com/lib/ca/v",qrcode:"//j1.s.ksyun.com/lib/jquery/qrcode"},shim:{ca:["jquery"],qrcode:["jquery"]}});var CA_FLAG="kp-1.1";define("common/baseConfig",["jquery"],function(){require(["ca"])}),"use strict",define("sandbox/sandbox",[],function(){return window.KP={},KP.Sandbox=function(){var e=function(e,t){this.obj=e,this.moduleId=t};return e.fn=e.prototype,e.fn.listen=function(e,t,n){return this.obj.listen(this.moduleId,e,t,n),this},e.fn.notify=function(e){return this.obj.broadcast(e),this},e.fn.request=function(e,t,n,r,i,s){this.obj.request(e,t,n,r,i,s)},e.fn.convertByteToMB=function(e){return this.obj.convertByteToMB(e)},e.fn.splitArrayWithKV=function(e,t,n){var r,i=[],s=[],o=e.length;while(o--)r=e[o],r[t]&&r[t]==n?i.push(r):s.push(r);return[i,s]},e.fn.sortObjectWith=function(e,t,n,r,i){if(!e.length)return e;n=n==="des"?"des":"asc",i=Object.prototype.toString.apply(i)==="[object Function]"?i:function(e){return e};if(r)return e.sort(function(e,r){return n==="asc"?i.call({},e[t])-i.call({},r[t]):i.call({},r[t])-i.call({},e[t])});switch(Object.prototype.toString.apply(i.call({},e[0][t]))){case"[object Number]":return e.sort(function(e,r){return n==="asc"?i.call({},e[t])-i.call({},r[t]):i.call({},r[t])-i.call({},e[t])});case"[object String]":return e.sort(function(e,r){return n==="asc"?i.call({},e[t]).localeCompare(i.call({},r[t])):i.call({},r[t]).localeCompare(i.call({},e[t]))});default:return e}},e.fn.formatFileName=function(e,t,n){var t=t||14,n=n||6,r=e.length;return r<t+n?e:e.substr(0,t)+"…"+e.substr(r-n)},e.fn.getDownloadUrl=function(e){return CONST.DOWNLOAD_URL+"/cdlsched/getdl?fid="+e+"&c=0"},e.fn.getOnlineViewUrl=function(e,t){var n=e.isimage,r=e.ext,i=e.fileVer,s=e.fileId;return"1"==n?t?[CONST.CONV_SERVER,"/?f=",s,"&v=",i,"&copts=pw:600,h:450&token=",CONST.Token].join(""):[CONST.CONV_SERVER,"/?f=",s,"&v=",i,"&copts=pw:120,h:120&token=",CONST.Token].join(""):[CONST.CONV_SERVER,"/?f=",s,"&v=",i,"&copts=dt:",r,",v:normal&token=",CONST.Token,"&ra=1"].join("")},e.fn.getOutLinkUrl=function(e){return"http://www.kuaipan.cn/file/id_"+e+".htm"},e.fn.createEditUrl=function(e){return[CONST.WowServer,"?host=www.kuaipan.cn&token=",this.getToken(),"&fileid=",e].join("")},e.fn.isEmail=function(e){return/^[\w\-\.]+@[\w\-\.]+(\.\w+)+$/i.test(e)},e.fn.checkNameIsRight=function(e){e=e.replace(/\s/ig,""),e=e.toUpperCase();var t=["","sharebox","CON","PRN","AUX","NUL","COM1","COM2","COM3","COM4","COM5","COM6","COM7","COM8","COM9","LPT1","LPT2","LPT3","LPT4","LPT5","LPT6","LPT7","LPT8","LPT9"],n=e.length,r=$.inArray(e,t)>-1||n>=255||e.indexOf(".")==0||/["'\/\\\?\*:\<\>\|]+/.test(e);return!r},e.fn.getUserInfo=function(){return e.fn.userinfo},e.fn.setUserInfo=function(t){e.fn.userinfo=t},e.fn.getStaticSrcHost=function(){return CONST.StaticSrcHost},e.fn.trim=function(e){return e.replace(/\s+$|^\s+/,"")},e.fn.getLang=function(e){return this.obj.getLang(e)},e.fn.getCommonDialog=function(){return this.obj.getCommonDialog()},e.fn.getHashStatus=function(){return this.obj.getHashStatus()},e.fn.getSelectedFiles=function(e){return this.obj.getSelectedFiles(e)},e.fn.setSelectedFiles=function(e,t){this.obj.setSelectedFiles(e,t)},e.fn.getToken=function(){return this.obj.getToken()},e.fn.getViewStyle=function(){return this.obj.getViewStyle()},e.fn.setViewStyle=function(e){return this.obj.setViewStyle(e)},e.fn.selectTextLength=function(e,t,n){var t=parseInt(t,10),n=parseInt(n,10),r=e.value.length;if(r){t||(t=0),n||(n=r),t>r&&(t=r),n>r&&(n=r),t<0&&(t=r+t),n<0&&(n=r+n);if(e.createTextRange){var i=e.createTextRange();i.moveStart("character",-r),i.moveEnd("character",-r),i.moveStart("character",t),i.moveEnd("character",n),i.select()}else e.setSelectionRange(t,n),e.focus()}},e}(),KP.Sandbox}),"use strict",define("common/core/baselibrary",["jquery","sandbox/sandbox"],function(){function e(e,t,n){$("#"+e).bind(t,n)}return{request:function(e,t,n,r,i,s){$.ajax({url:e,type:t,dataType:n,data:r,success:i,error:s})},convertByteToMB:function(e){return e>1073741824?(e/1073741824).toFixed(2)+" GB":e>1048576?(e/1048576).toFixed(2)+" MB":e>1024?(e/1024).toFixed(2)+" KB":"1 KB"},getLang:function(e){return Resources&&Resources[e]?Resources[e]:e},getCommonDialog:function(){var e=$("#dialog-message");return e.length||(e=$('<div id="dialog-message" class="dn"></div>').appendTo("body")),e},getToken:function(){return CONST.Token},getCookie:function(e){var t=e+"=",n=t.length,r=document.cookie.length,i=0,s=0;while(i<r){s=i+n;if(document.cookie.substring(i,s)==t)return this.getCookieVal(s);i=document.cookie.indexOf(" ",i)+1;if(i==0)break}return null},setCookie:function(e,t){var n=arguments,r=arguments.length,i=r>2?n[2]:null,s=r>3?n[3]:"/",o=r>4?n[4]:null,u=r>5?n[5]:!1;document.cookie=e+"="+escape(t)+(i==null?"":"; expires="+i.toGMTString())+(s==null?"":"; path="+s)+(o==null?"":"; domain="+o)+(u==1?"; secure":"")},clearCookies:function(e){if(this.getCookie(e)){var t=new Date;t.setTime(t.getTime()-864e5),this.setCookie(e,"",t)}},getCookieVal:function(e){var t=document.cookie.indexOf(";",e);return t==-1&&(t=document.cookie.length),unescape(document.cookie.substring(e,t))}}});var Resources={confirm:"确定",cancel:"取消",close:"关闭",upload:"上传",notice:"温馨提示",opOk:"操作成功",viewonline:"在线查看",editonline:"在线编辑",generatesharelink:"生成分享链接",outlinkmange:"分享链接管理",cancelsharelink:"取消分享",cancelsharelinkSuccess:"取消分享链接成功",cancelsharelinkerror:"取消分享链接失败",cancelsharePwd:"取消访问密码",generatesharePwd:"生成访问密码",rename:"重命名",move:"移动",order:"排序",item:"项","delete":"删除",remove:"删除",seleted:"选中",open:"打开",make:"创建",download:"下载",newFolder:"新建文件夹",openfolder:"打开文件夹",recoverFile:"还原",deleteFileFromTrash:"彻底删除",EmptyTrash:"清空回收站",downloadfolder:"打包下载",exitShareTm:"退出协作",myShare:"我的分享",recycle:"回收站",sharetofriend:"共享给好友",cancelsharetofriend:"取消共享",cancelallshare:"取消所有共享",cancelallshareok:"取消共享成功",cancelShareMsg:"您确定要取消文件 “$1” 的所有共享吗？",shareyoushouldbindemail:"绑定邮箱",sharebindemailnotice:"当前账号需要绑定一个邮箱后，才能使用共享操作。",contactManage:"联系人管理",pinCodeRequired:"验证码不能为空",pinCodeNotMatch:"验证码不匹配",getPinCode:"获取访问密码",shareLinkError:"生成外链失败",deleteOutLinkMsg:"您确定要取消这$1项分享链接吗？",NEWDIR_Dialog_title:"新建文件夹",FolderCanNotEmpty:"请输入文件夹名称",CreateFolderError:"新建文件夹失败",CreateFolderOk:"新建文件夹成功",FolderTargetExist:"当前目录存在一个相同的文件夹，您可以换个名称试试",FolderclientBadParams:"文件名中带有特殊字符，您可以换个名称试试",defaultFolderName:"新建文件夹",UPLOAD_Dialog_title:"上传文件",RENAME_Dialog_title:"重命名",RenameError:"重命名操作失败",RenameTargetExist:"当前目录存在一个相同的文件（夹），换个名称试试吧",RenameOK:"重命名操作成功",ShareEmailIsErr:"请输入正确的email地址",ShareFriendExist:"好友已经在共享列表中",ShareOperateIsNotSupport:"<strong>对不起，该文件（夹）暂不支持共享操作。</strong>",ExitShareMsg:"您确定要退出这$1项协作文件吗？",ExitShareOk:"退出共享成功",DELETE_Dialog_title:"删除文件（夹）",DELETE_Dialog_delteInfo:"您确定要删除这$1项吗?",DeleteFileError:"删除文件（夹）操作失败",DeleteFileOk:"删除文件（夹）操作成功",DeleteFileIsNotAllOk:"您对$1项文件（夹）进行了删除操作，但只成功删除了$2项，您可以刷新页面再试一试",MOVE_Dialog_title:"移动文件（夹）",MOVE_Dialog_PleaseSelctFolder:"请选择文件夹",MoveSelectMoveLoc:"请选择移动到的文件夹",MoveFileOk:"移动文件（夹）操作成功",MoveFileIsNotAllOk:"您对$1项文件（夹）进行了移动操作，但只成功移动了$2项，您可以刷新页面再试一试",Recycle_Dialog_ConifrmEmptyTrash:"您确定要清空回收站吗？清空后将无法再找回文件。",recycle_dialog_emptytrashok:"清空回收站成功",Recycle_Dialog_Delete:"您确实要删除这$1项吗？删除后将无法找回。",Recycle_dialog_deleteok:"彻底删除文件成功",Recycle_Dialog_Recover:"您确定要还原这$1个文件（夹）吗？",Recycle_Recover_ok:"还原文件操作成功",Recycle_SetPwd_ok:"设置回收站密码成功",Recycle_CanclePwd_ok:"取消回收站密码成功",Recycle_ChangePwd_ok:"修改回收站密码成功",show_deleted_files:"显示已删除",hide_deleted_files:"隐藏已删除",ShareLink2KP_Dialog_title:"保存到我的网盘",ShareLink2KP_Dialog_PleaseSelect:"请选择保存到的位置",ShareLink2KP_Dialog_operateOk:"操作成功",ShareLink2KP_Dialog_operateErr:"操作失败",ShareLInk2KP_Dialog_save2kpok:"转存到我的快盘成功",ShareLink2KP_DIalog_fileExists:"该目录下已有此文件，换一个目录试试",ShareLink2KP_Dialog_save2kpError:"转存文件到您的快盘失败，请稍后再试",filesOrFolderDeepthOverLimit:"子文件夹超过15级或文件总数超过2048个",PSA_OUTLINK_STATUS_REVIEWING:"发布的分享链接中含有敏感词，请等待审核",PSA_CLAN_EXIST:"文件（夹）所在文件夹已经发布了分享链接或文件夹内有已发布分享链接的文件",noaccess:"请输入正确的验证码",targetNotExist:"生成分享链接的文件不存在",s_published:"已发布",s_admin_examining:"审核中",s_admin_reject:"未通过",upload_BadParams:"错误码（001）",upload_HashErr:"错误码（002）",upload_ReqUlFailed:"错误码（003）",upload_ReqUlExc:"错误码（004）",upload_UlBlkFailed:"错误码（005）",upload_UlBlkExc:"错误码（006）","upload_CmtFailed ":"错误码（007）",upload_CmtExc:"错误码（008）",confirmSubmit:"确认提交"};define("lang/zh_cn",function(){}),"use strict",define("common/core/const",["lang/zh_cn"],function(){return window.Const={CONV_SERVER:"http://conv.kuaipan.cn",WOW_SERVER:"http://w.wps.cn/getkuaixie.html",DOWNLOAD_URL:"http://t1.dfs.kuaipan.cn/cdlsched/getdl?fid=",GET_USER_INFO_URL:"/index.php?ac=home&op=userinfo",GET_USER_SPACE_URL:"/index.php?ac=home&op=space",USER_SIGN_IN_URL:"/index.php?ac=common&op=usersign",USER_TASK_URL:"/index.php?ac=zone&op=taskdetail",LOAD_DIR:"/index.php?ac=home&op=dir&withdel=0",GET_PATH:"/index.php?ac=home&op=getpath",NEW_FOLDER:"/index.php?ac=home&op=newdir",RENAME:"/index.php?ac=home&op=rename",GET_DIR:"/index.php?ac=fileview_handler&op=getdir",MOVE:"/index.php?ac=fileview_handler&op=move",DELETE_FILE:"/index.php?ac=home&op=delete",CHECK_SHARE_LINK:"/index.php?ac=home&op=filepickupcode",PUBLISH_SHARE_LINK:"/index.php?ac=home&op=publishoutlink",REPUBLISH_SHARE_LINK:"/index.php?ac=home&op=republishoutlink",CANCEL_SHARE_LINK:"/index.php?ac=outlink&op=deleteOutlink",SEND_EMAIL:"/api.php?ac=email&op=sendemail",SEARCH:"/index.php?ac=home&op=search",RECYCLEBIN:"/index.php?ac=home&op=recycle",RECYCLEBIN_PAGE:"/index.php?ac=fileview_handler&op=recycleExJsonPaging",EMPTY_RECYCLEBIN:"/index.php?ac=fileview_handler&op=cleanallrecycle",REMOVE_RECYCLEBIN:"/index.php?ac=fileview_handler&op=cleans",RECOVER_RECYCLEBIN:"/home.htm?op=recover",VALIDATE_RECYCLEBIN_PASSWORD:"/home.htm?op=checkrecyclepwd",SET_RECYCLEBIN_PASSWORD:"/home.htm?op=setRecycleBinPassword",EDIT_RECYCLEBIN_PASSWORD:"/home.htm?op=editRecycleBinPassword",CANCEL_RECYCLEBIN_PASSWORD:"/home.htm?op=cancelRecycleBinPassword",CAIDAN:"/special_0205.htm",SEND_STATISTIC_DATA:"http://mobile.analysis.kuaipan.cn/web/info?",ZERO_CLIPBOARD_URL:"http://web.kuaipan.cn/static/javascript/extends/zeroclipboard/zeroclipboard.swf",HEAD_DIV_HEIGHT:58,SPLIT_SPACE:2,EMAIL_REG:/^[\w\-\.]+@[\w\-\.]+(\.\w+)+$/i,OPERATE:{SHARE:"share",OUTLINK:"outlink",DOWNLOAD:"download",RENAME:"rename",MOVE:"move",DELETE:"delete",VIEW_ONLINE:"view-online",EDIT_ONLINE:"edit-online"},OPERATE_NAME:{share:"协作",outlink:"分享",download:Resources.download,rename:Resources.rename,move:Resources.move,"delete":"删除","view-online":Resources.viewonline,"edit-online":Resources.editonline},COMMON_OPERATE:["share","outlink","download","delete"],UNCOMMON_OPERATE:["view-online","edit-online","rename","move"],DEFAULT_INPUT_TEXT:"多个邮箱用“;”号隔开",WEIBO_SHARE_CONTENT:"我正在使用 @快盘 分享文件 “[]” ，欢迎大家下载分享文件，地址：",EMAIL_SHARE_CONTENT:"您的好友 <> 通过金山快盘给您分享了一个文件“[]”，点击此链接立即查看：",CAIDAN_WEIBO:"#快盘幸运彩蛋#今天，打开快盘网站，上传、下载、移动、删除，熟悉的不能再熟悉的一次次操作，忽然我泪湿颜眼眶，我中“蛋”了。上快盘，发现你的那个“蛋”，有惊喜哦～",FILE_NAME_MAP:{"[Pictures]":"我的照片","[MobilePhoto]":"移动相册","[MobileBackup]":"我的移动备份","[Videos]":"我的视频","[Music]":"我的音乐","[Documents]":"我的文档","[Applications]":"我的应用"},FORGOT_RECYCLEBIN_PASSWORD:"请使用您注册邮箱发送邮件到kuaipan_feedback@kingsoft.com申请解除回收站密保"},Const}),"use strict",define("common/core/util",[],function(){return window.Util={},Util.formateSubStr=function(e,t,n){var r,i;return i=Math.abs(n),r=t+i+3,Util.getStrLen(e)>r?Util.subStr(e,t)+"..."+Util.subStr(e,n):e},Util.subStr=function(e,t){var n=e.length;if(t>0)while(Util.getStrLen(e)>t)e=e.substr(0,n--);else{t=Math.abs(t);while(Util.getStrLen(e)>t)e=e.substring(1,n)}return e},Util.getStrLen=function(e){if(!e)return;return e.replace(/[^\x00-\xff]/g,"**").length},Util.getCookie=function(e){if(e){var t=new RegExp("[; ]"+e+"=([^;]*)"),n=t.exec(document.cookie);if(n)return n[1]}},Util.setCookie=function(e,t,n,r,i,s){var o=new Date;o.setTime(o.getTime()),n&&(n=n*1e3*60*60*24);var u=new Date(o.getTime()+n);document.cookie=e+"="+escape(t)+(n?";expires="+u.toGMTString():"")+(r?";path="+r:"")+(i?";domain="+i:"")+(s?";secure":"")},Util.convertByteToMB=function(e,t){var n=t=="undefined"?2:t,r=1024;return e>r*r*r*r*r?(e/(r*r*r*r*r)).toFixed(n)+"P":e>r*r*r*r?(e/(r*r*r*r)).toFixed(n)+"T":e>r*r*r?(e/(r*r*r)).toFixed(n)+"G":e>r*r?(e/(r*r)).toFixed(n)+"M":e>r?(e/r).toFixed(n)+"K":"1K"},Util.getBytes=function(e){if(!e)return 0;var t=1024,n=parseInt(e.split(" ")[0]),r=e.split(" ")[1];if(r.indexOf("P")>-1)return n*t*t*t*t*t;if(r.indexOf("T")>-1)return n*t*t*t*t;if(r.indexOf("G")>-1)return n*t*t*t;if(r.indexOf("M")>-1)return n*t*t;if(r.indexOf("K")>-1)return n*t},Util.convBytesUnit=function(e){return Util.convertByteToMB(Util.getBytes(e),0)},Util.getUrlParams=function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),n=unescape(decodeURI(window.location.search)).substr(1).match(t);return n!==null?unescape(n[2]):null},Util.indexOfArray=function(e,t,n){var r=0,i=e.length;for(;r<i;r++)if(n){if(n(e[r],t))return r}else if(t===e[r])return r},Util.deleteArrayItem=function(e,t){var n=0,r=e.length;for(;n<r;n++)t===e[n]&&e.splice(n,1)},Util.unique=function(e){var t={},n=[],r,i=0,s=e.length;for(;i<s;i++)r=e[i],t[r]||(t[r]=!0,n.push(r));return n},Util.sortArray=function(e,t){var n=0,r,i=e.length,s;for(;n<i;n++)for(r=n;r<i;r++)t(e[n],e[r])&&(s=e[r],e[r]=e[n],e[n]=s)},Util.hasIntersection=function(e,t){},Util.getFileSize=function(e){return"folder"===e.type?"":Util.convertByteToMB(parseInt(e.size,10))},Util.getFileIconClass=function(e){var t={docx:"doc-icon",doc:"doc-icon",wps:"wps-icon",et:"et-icon",xls:"xls-icon",xlsx:"xls-icon",ppt:"ppt-icon",pptx:"ppt-icon",dps:"pps-icon",rar:"rar-icon",zip:"zip-icon",txt:"txt-icon",dll:"dll-icon",pdf:"pdf-icon",wmv:"video-icon",avi:"video-icon",rmvb:"video-icon",rm:"video-icon",mp3:"music-icon",ape:"music-icon",acc:"music-icon",jpg:"image-icon",png:"image-icon",jpeg:"image-icon",bmp:"image-icon",gif:"image-icon",tiff:"image-icon",pcx:"image-icon",tga:"image-icon",exif:"image-icon",svg:"image-icon",psd:"image-icon",cdr:"image-icon",pcd:"image-icon",ufo:"image-icon",eps:"image-icon",ai:"image-icon",raw:"image-icon"};e.ext||(e.ext=Util.getFileExt(e.name));var n=e.type||e;return"folder"===e.type?"0"===e.shared||e.shared===undefined?"folder-icon":"team-folder-icon":e.isimage?"image-icon":t[e.ext]?t[e.ext]:"unknown-icon"},Util.getFileIconClassName=function(e){var t={docx:"i27",doc:"i27",wps:"i40",et:"i35",xls:"i28",xlsx:"i28",ppt:"i29",pptx:"i29",dps:"i31",rar:"i33",zip:"i32",txt:"i37",dll:"i39",pdf:"i36",wmv:"i42",avi:"i42",rmvb:"i42",rm:"i42",mp3:"i34",ape:"i34",acc:"i34",jpg:"i41",png:"i41",jpeg:"i41",bmp:"i41",gif:"i41",tiff:"i41",pcx:"i41",tga:"i41",exif:"i41",svg:"i41",psd:"i41",cdr:"i41",pcd:"i41",ufo:"i41",eps:"i41",ai:"i41",raw:"i41"};e.ext||(e.ext=Util.getFileExt(e.name));var n=e.type||e;return"folder"===e.type?"0"===e.shared||e.shared===undefined?"i21":"i23":e.isimage?"i41":t[e.ext]?t[e.ext]:"i20"},Util.getFileIcon=function(e){var t,n={docx:"doc-icon",doc:"doc-icon",wps:"wps-icon",et:"et-icon",xls:"xls-icon",xlsx:"xls-icon",ppt:"ppt-icon",pptx:"ppt-icon",dps:"pps-icon",rar:"rar-icon",zip:"zip-icon",txt:"txt-icon",dll:"dll-icon",pdf:"pdf-icon",wmv:"video-icon",avi:"video-icon",rmvb:"video-icon",rm:"video-icon",mp3:"music-icon",ape:"music-icon",acc:"music-icon",png:"image-icon",jpg:"image-icon",gif:"image-icon",bmp:"image-icon"};return"folder"===e.type?"0"===e.shared||e.shared===undefined?"folder-icon":"team-folder-icon":(t=Util.getFileExt(e.name),undefined!==n[t]?n[t]:"i20")},Util.date=function(){var e=new Date,t=e.getFullYear(),n=e.getMonth()+1,r=e.getDate(),i=e.getHours(),s=e.getMinutes(),o=e.getSeconds();return t+"-"+n+"-"+r+" "+i+":"+s+":"+o},Util.setInputSelection=function(e,t,n){var r;e.selectionStart!==undefined?(e.selectionStart=t,e.selectionEnd=n):document.selection&&document.selection.createRange&&(r=document.selection.createRange(),r.collapse(!0),r.moveEnd("character",n),r.moveStart("character",t),r.select())},Util.getFileExt=function(e){var t=/\.([^.]+)$/.exec(e);return t?t[1]:""},Util.getObjectType=function(e){return e.type=="folder"?"文件夹":e.ext},Util.getRealPosition=function(e,t){var n=t,r=n.offset().left,i=n.offset().top,s=n.scrollTop();return{width:n.width()-16,height:n.height(),left:r,top:i,evtX:e.clientX-r,evtY:e.clientY-i,scrollTop:s,relativeY:e.clientY-i+s}},Util.fit_in_content=function(e,t,n){var r=Util.getRealPosition(e,n),i=r.evtX,s=r.relativeY,o=t.outerWidth(),u=t.outerHeight(),a=r.width-o-Const.SPLIT_SPACE,f=r.height+r.scrollTop-u-Const.SPLIT_SPACE;return i>a?i=a:i<0&&(i=0),s>f?s=f:s<0&&(s=0),{left:i,top:s}},Util.getFileObj=function(e){var t=e||file||{};return t.fileList&&(t=t.fileList[0]),t},Util}),define("lib/jquery/ba-hashchange",["jquery"],function(e){var t=function(e,t,n){"$:nomunge";function f(e){return e=e||location.href,"#"+e.replace(/^[^#]*#?(.*)$/,"$1")}var r="hashchange",i=document,s,o=e.event.special,u=i.documentMode,a="on"+r in t&&(u===n||u>7);e.fn[r]=function(e){return e?this.bind(r,e):this.trigger(r)},e.fn[r].delay=50,o[r]=e.extend(o[r],{setup:function(){if(a)return!1;e(s.start)},teardown:function(){if(a)return!1;e(s.stop)}}),s=function(){function p(){var n=f(),i=h(u);n!==u?(c(u=n,i),e(t).trigger(r)):i!==u&&(location.href=location.href.replace(/#.*/,"")+i),o=setTimeout(p,e.fn[r].delay)}var s={},o,u=f(),l=function(e){return e},c=l,h=l;return s.start=function(){o||p()},s.stop=function(){o&&clearTimeout(o),o=n},e.browser.msie&&!a&&function(){var t,n;s.start=function(){t||(n=e.fn[r].src,n=n&&n+f(),t=e('<iframe tabindex="-1" title="empty"/>').hide().one("load",function(){n||c(f()),p()}).attr("src",n||"javascript:0").insertAfter("body")[0].contentWindow,i.onpropertychange=function(){try{event.propertyName==="title"&&(t.document.title=i.title)}catch(e){}})},s.stop=l,h=function(){return f(t.location.href)},c=function(n,s){var o=t.document,u=e.fn[r].domain;n!==s&&(o.title=i.title,o.open(),u&&o.write('<script>document.domain="'+u+'"</script>'),o.close(),t.location.hash=n)}}(),s}()};t(e,window,undefined)}),"use strict",define("common/core/core",["common/core/baselibrary","common/core/const","common/core/util","lib/jquery/ba-hashchange"],function(e){return KP.Core=function(e){function a(e){var t=e.type,n=e.data,r=i[t];if(r)for(var s=0,o=r.length;s<o;s++)r[s].method(n)}function f(e){var t=$("html").attr("class").match(/layout-\d/);t&&t.length&&$("html").removeClass(t[0]),$("html").addClass(e)}function l(){var e=location.hash;if(e){var t=e.split("|");switch(t[0]){case"#kp":a({type:"location-hash-isfilemanage",data:location.hash}),f("layout-2");break;case"#sh":a({type:"location-hash-isshare",data:location.hash}),f("layout-2");break;case"#out":a({type:"location-hash-shareout",data:location.hash}),f("layout-1");break;case"#li":a({type:"location-hash-islink",data:location.hash}),f("layout-2");break;case"#rc":a({type:"location-hash-isrecycle",data:location.hash}),f("layout-2");break;case"#se":a({type:"location-hash-issearch",data:location.hash}),f("layout-2");break;default:a({type:"location-hash-isfilemanage",data:location.hash})}}else a({type:"location-hash-isfilemanage",data:"#kp|0|0"})}var t={},n=!1,r={},i={},s=e,o="",u={};return{startApp:function(){$(window).hashchange(function(){l(),CA.pv()}),l()},register:function(e,n){t[e]={createor:n,instance:null}},start:function(e){var n=t[e],r=new KP.Sandbox(this,e);n.instance=n.createor(r),n.instance.init()},stop:function(e){var n=t[e];n.instance&&(n.instance.destroy(),n.instance=null)},startAll:function(){for(var e in t)t.hasOwnProperty(e)&&this.start(e)},stopAll:function(){for(var e in t)t.hasOwnProperty(e)&&this.stop(e)},listen:function(e,t,n,r){$.isArray(t)||(t=[t]),$.each(t,function(t,s){i[s]?i[s].push({moduleId:e,method:n,scope:r}):i[s]=[{moduleId:e,method:n,scope:r}]})},broadcast:function(e){a(e)},request:function(e,t,n,r,i,o){s.request(e,t,n,r,i,o)},convertByteToMB:function(e){return s.convertByteToMB(e)},getHashStatus:function(){return location.hash},getSelectedFiles:function(e){return u[e]||(u[e]=[]),u[e]},setSelectedFiles:function(e,t){t=t||[],u[e]=t},getLang:function(e){return s.getLang(e)},getCommonDialog:function(){return s.getCommonDialog()},getToken:function(){return s.getToken()},getViewStyle:function(){return s.getCookie("_viewstyle")||"list"},setViewStyle:function(e){e=e||"list",s.setCookie("_viewstyle",e)},moduleData:t}}(e),KP.Core}),"use strict",define("common/core/common",["jquery"],function(e){function n(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.superClass=t.prototype,t.prototype.constructor==Object.prototype.constructor&&(t.prototype.constructor=t)}window.Event={};var t=window.Common={};return window.StateMachine=function(){},Event.on=function(e,t){this.events=this.events||{},this.events[e]=this.events[e]||[],this.events[e].push(t)},Event.off=function(e,t){},Event.trigger=function(e){var t=0,n=1,r,i=[],s=this.events?this.events[e]||[]:[];for(;n<arguments.length;n++)i.push(arguments[n]);r=s.length;for(;t<r;t++)s[t].apply(this,i)},StateMachine.fn=StateMachine.prototype,e.extend(StateMachine.fn,Event),StateMachine.fn.add=function(t){this.on("change",function(e,n){t===n?t.activate():t.deactivate()}),t.active=e.proxy(function(){this.trigger("change",t)},this)},t.inherit=n,t.checkRepeatFolderName=function(e,t){var n=0,r=e.length;for(;n<r;n++)if(t===e[n].name)return!0;return!1},t.generateCommonFolderName=function(e){var n=Resources.newFolder,r=1;while(t.checkRepeatFolderName(e,n))n=Resources.newFolder+"("+r+")",r+=1;return n},t.checkFileName=function(t){var n=["","sharebox","CON","PRN","AUX","NUL","COM1","COM2","COM3","COM4","COM5","COM6","COM7","COM8","COM9","LPT1","LPT2","LPT3","LPT4","LPT5","LPT6","LPT7","LPT8","LPT9"],r=t.length,r,i;return t=t.toUpperCase().replace(/\s/ig,""),i=e.inArray(t,n)>-1||r>=255||t.indexOf(".")==0||/["'\/\\\?\*:\<\>\|]+/.test(t),!i},t.selectFolder=function(e){var t=e.value,n=t.length;Util.setInputSelection(e,0,n)},t.selectRenamePart=function(e,t){var n=Util.getFileExt(t),r=t.length-n.length-1;Util.setInputSelection(e,0,r)},t.subFileArray=function(t,n){var r=[],i=0,s=t.length;for(;i<s;i++)-1!==e.inArray(t[i].fileId,n)&&r.push(t[i]);return r},t.getFileIds=function(e){var t=[],n=0,r=e.length;for(;n<r;n++)t.push(e[n].fileId);return t},t.getFileNames=function(e){var t=[],n=0,r=e.length;for(;n<r;n++)t.push(e[n].name);return t},t.fixedFileNames=function(e){var t=0,n=e.length,r;for(;t<n;t++){r=e[t];var i=Const.FILE_NAME_MAP[r.name];undefined!==i&&(r.name=i)}},t.getImages=function(e){var t=[],n=0,r=e.length;for(;n<r;n++)e[n].isimage&&t.push(e[n]);return t},t.getFileIndexById=function(e,t){var n=0,r=e.length;for(;n<r;n++)if(e[n].fileId===t)return n;return-1},t.getFileByFileId=function(e,t){var n=0,r=e.length;for(;n<r;n++)if(t===e[n].fileId)return e[n]},t.checkIntersection=function(e,t){return(t.topLeftX>=e.topLeftX&&t.topLeftX<=e.bottomRightX||t.bottomRightX>=e.topLeftX&&t.bottomRightX<=e.bottomRightX||e.topLeftX>t.topLeftX&&e.topLeftX<t.bottomRightX||e.bottomRightX>t.topLeftX&&e.bottomRightX<t.bottomRightX)&&(t.topLeftY>=e.topLeftY&&t.topLeftY<=e.bottomRightY||t.bottomRightY>=e.topLeftY&&t.bottomRightY<=e.bottomRightY||e.topLeftY>t.topLeftY&&e.topLeftY<t.bottomRightY||e.bottomRightY>t.topLeftY&&e.bottomRightY<t.bottomRightY)?!0:!1},t.getImageThumbnail=function(e,t){var n=[],r=Util.getCookie("token");return n.push(Const.CONV_SERVER),n.push("/getmedia?"),n.push("f="),n.push(e),n.push("&v="),n.push(t),n.push("&copts=pw:85,h:85"),n.push("&token="),n.push(r),n.join("")},t.getImageUrl=function(e){var t=[],n=Util.getCookie("token");return t.push(Const.CONV_SERVER),t.push("/getmedia?"),t.push("f="),t.push(e.fileId),t.push("&v="),t.push(e.fileVersion),t.push("&copts=pw:"+e.width+",h:"+e.height),t.push("&token="),t.push(n),t.join("")},t.compressSize=function(e,t){var n=e.width/t.width,r=e.height/t.height,i={};return n<1&&r<1?e:(n>r?(i.width=t.width,i.height=t.width/e.width*e.height):(i.height=t.height,i.width=t.height/e.height*e.width),i)},t.compressPercent=function(e,t){var n=t.width/e.width,r=t.height/e.height;if(n<1||r<1)return Math.min(n,r)},t.compressThumbnail=function(){},t.group=function(e){},t.shiftSelectFileIds=function(e){var n=e.allFiles,r=e.beginFileId,i=t.getFileByFileId(n,r),s=i.type,o=e.endFileId,u=t.getFileByFileId(n,o),a=u.type,f=[];if(i.isimage&&u.isimage)f.push("image");else if("folder"===s&&"folder"===a)f.push("folder");else if("file"===s&&"file"===a&&!i.isimage&&!u.isimage)f.push("file");else{if("folder"===s&&u.isimage||"folder"===a&&i.isimage)f.push("folder"),f.push("image");if("folder"===s&&!u.isimage||"folder"===a&&!i.isimage)f.push("folder"),f.push("image"),f.push("file");if(i.isimage&&"file"===a&&!u.isimage||u.isimage&&"file"===s&&!i.isimage)f.push("image"),f.push("file")}return t.queryFileIdsByRange(n,r,o,f)},t.queryFileIdsByRange=function(t,n,r,i){var s,o,u,a,f=[],l=0,c=t.length,h,p,d;for(;l<c;l++)n===t[l].fileId&&(s=l),r===t[l].fileId&&(o=l);if(s!==undefined&&o!==undefined){u=Math.min(s,o),a=Math.max(s,o)+1;for(h=u;h<a;h++)p=t[h],p.isimage?d="image":d=p.type,i?-1!==e.inArray(d,i)&&f.push(p.fileId):f.push(p.fileId);return f}return[]},t.browser=function(){var e={};return window.ActiveXObject&&(e.isIE=!0,navigator.appVersion.split(";")[1].replace(/[ ]/g,"")=="MSIE6.0"&&(e.isIE6=!0),navigator.appVersion.split(";")[1].replace(/[ ]/g,"")=="MSIE7.0"&&(e.isIE7=!0),navigator.appVersion.split(";")[1].replace(/[ ]/g,"")=="MSIE8.0"&&(e.isIE8=!0),navigator.appVersion.split(";")[1].replace(/[ ]/g,"")=="MSIE9.0"&&(e.isIE9=!0)),e},t.sendStaticData=function(e){var t=new Image,n=Const.SEND_STATISTIC_DATA+"data="+encodeURIComponent(e);t.src=n},t});var template=function(e,t){return template[typeof t=="object"?"render":"compile"].apply(template,arguments)};(function(e,t){e.version="2.0.1",e.openTag="<%",e.closeTag="%>",e.isEscape=!0,e.isCompress=!1,e.parser=null,e.render=function(e,t){var n=r(e);return n===undefined?i({id:e,name:"Render Error",message:"No Template"}):n(t)},e.compile=function(t,r){function c(n){try{return new f(n)+""}catch(s){return u?(s.id=t||r,s.name="Render Error",s.source=r,i(s)):e.compile(t,r,!0)(n)}}var o=arguments,u=o[2],a="anonymous";typeof r!="string"&&(u=o[1],r=o[0],t=a);try{var f=s(r,u)}catch(l){return l.id=t||r,l.name="Syntax Error",i(l)}return c.prototype=f.prototype,c.toString=function(){return f.toString()},t!==a&&(n[t]=c),c},e.helper=function(t,n){e.prototype[t]=n},e.onerror=function(e){var n="[template]:\n"+e.id+"\n\n[name]:\n"+e.name;e.message&&(n+="\n\n[message]:\n"+e.message),e.line&&(n+="\n\n[line]:\n"+e.line,n+="\n\n[source]:\n"+e.source.split(/\n/)[e.line-1].replace(/^[\s\t]+/,"")),e.temp&&(n+="\n\n[temp]:\n"+e.temp),t.console&&console.error(n)};var n={},r=function(r){var i=n[r];if(i===undefined&&"document"in t){var s=document.getElementById(r);if(s){var o=s.value||s.innerHTML;return e.compile(r,o.replace(/^\s*|\s*$/g,""))}}else if(n.hasOwnProperty(r))return i},i=function(t){function n(){return n+""}return e.onerror(t),n.toString=function(){return"{Template Error}"},n},s=function(){e.prototype={$render:e.render,$escape:function(e){return typeof e=="string"?e.replace(/&(?![\w#]+;)|[<>"']/g,function(e){return{"<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","&":"&#38;"}[e]}):e},$string:function(e){return typeof e=="string"||typeof e=="number"?e:typeof e=="function"?e():""}};var t=Array.prototype.forEach||function(e,t){var n=this.length>>>0;for(var r=0;r<n;r++)r in this&&e.call(t,this[r],r,this)},n=function(e,n){t.call(e,n)},r="break,case,catch,continue,debugger,default,delete,do,else,false,finally,for,function,if,in,instanceof,new,null,return,switch,this,throw,true,try,typeof,var,void,while,with,abstract,boolean,byte,char,class,const,double,enum,export,extends,final,float,goto,implements,import,int,interface,long,native,package,private,protected,public,short,static,super,synchronized,throws,transient,volatile,arguments,let,yield,undefined",i=/\/\*(?:.|\n)*?\*\/|\/\/[^\n]*\n|\/\/[^\n]*$|'[^']*'|"[^"]*"|[\s\t\n]*\.[\s\t\n]*[$\w\.]+/g,s=/[^\w$]+/g,o=new RegExp(["\\b"+r.replace(/,/g,"\\b|\\b")+"\\b"].join("|"),"g"),u=/\b\d[^,]*/g,a=/^,+|,+$/g,f=function(e){return e=e.replace(i,"").replace(s,",").replace(o,"").replace(u,"").replace(a,""),e=e?e.split(/,+/):[],e};return function(t,r){function S(t){return l+=t.split(/\n/).length-1,e.isCompress&&(t=t.replace(/[\n\r\t\s]+/g," ")),t=t.replace(/('|\\)/g,"\\$1").replace(/\r/g,"\\r").replace(/\n/g,"\\n"),t=m[1]+"'"+t+"'"+m[2],t+"\n"}function x(t){var n=l;o?t=o(t):r&&(t=t.replace(/\n/g,function(){return l++,"$line="+l+";"}));if(t.indexOf("=")===0){var i=t.indexOf("==")!==0;t=t.replace(/^=*|[\s;]*$/g,"");if(i&&e.isEscape){var s=t.replace(/\s*\([^\)]+\)/,"");!h.hasOwnProperty(s)&&!/^(include|print)$/.test(s)&&(t="$escape($string("+t+"))")}else t="$string("+t+")";t=m[1]+t+m[2]}return r&&(t="$line="+n+";"+t),T(t),t+"\n"}function T(e){e=f(e),n(e,function(e){c.hasOwnProperty(e)||(N(e),c[e]=!0)})}function N(e){var t;e==="print"?t=y:e==="include"?(p.$render=h.$render,t=b):(t="$data."+e,h.hasOwnProperty(e)&&(p[e]=h[e],e.indexOf("$")===0?t="$helpers."+e:t=t+"===undefined?$helpers."+e+":"+t)),d+=e+"="+t+","}var i=e.openTag,s=e.closeTag,o=e.parser,u=t,a="",l=1,c={$data:!0,$helpers:!0,$out:!0,$line:!0},h=e.prototype,p={},d="var $helpers=this,"+(r?"$line=0,":""),v="".trim,m=v?["$out='';","$out+=",";","$out"]:["$out=[];","$out.push(",");","$out.join('')"],g=v?"if(content!==undefined){$out+=content;return content}":"$out.push(content);",y="function(content){"+g+"}",b="function(id,data){if(data===undefined){data=$data}var content=$helpers.$render(id,data);"+g+"}";n(u.split(i),function(e,t){e=e.split(s);var n=e[0],r=e[1];e.length===1?a+=S(n):(a+=x(n),r&&(a+=S(r)))}),u=a,r&&(u="try{"+u+"}catch(e){"+"e.line=$line;"+"throw e"+"}"),u=""+d+m[0]+u+"return new String("+m[3]+")";try{var w=new Function("$data",u);return w.prototype=p,w}catch(E){throw E.temp="function anonymous($data) {"+u+"}",E}}}()})(template,this),typeof define=="function"?define("lib/artTemplate",["require","exports","module"],function(e,t,n){n.exports=template}):typeof exports!="undefined"&&(module.exports=template),"use strict",define("common/user/uInfo.tmpl",[],function(){return['<li class="entry noDis" id="turnplate"><a class="fuc" href="http://huodong.kuaipan.cn/turnplate/" target="_blank">今天还有一次抽奖机会哦!</a>','<li id="user-name" class="entry"><em><%= uname %></em><i class="i i7"></i>','<div id="usrDrop" class="noVis">','<p class="ttl">',"<% if(mail){ %>",'<a href="/home/personal" class="fr" title="邮箱已绑定"><i class="i i17"></i></a>',"<% } else { %>",'<a data-ca="header-mail-notbind" href="/home/personal" class="fr" title="邮箱未绑定"><i class="i i63"></i></a>',"<% } %>","<% if(mobi){ %>",'<a href="/home/personal" class="fr" title="手机已绑定"><i class="i i16"></i></a>',"<% } else { %>",'<a data-ca="header-mobi-notbind" href="/home/personal" class="fr" title="手机未绑定"><i class="i i64"></i></a>',"<% } %>",'<a href="/home/personal">安全评分：<b><%= secureMsg %></b></a>','<p class="pbar pbar2"><em style="left:<%= secureLv %>"></em>',"<ul>",'<li><a data-ca="header-upgrade" href="http://www.kuaipan.cn/home/task"><i class="i i14"></i>免费扩容</a>','<li><a data-ca="header-recharge" href="http://www.kuaipan.cn/shop/" target="_blank"><i class="i i11"></i>充值中心</a>','<li><a data-ca="header-upgrade-his" href="http://www.kuaipan.cn/home/record"><i class="i i15"></i>扩容记录</a>','<li><a data-ca="header-download" href="http://www.kuaipan.cn/download.html" target="_blank"><i class="i i12"></i>下载中心</a>','<li><a data-ca="header-account" href="http://www.kuaipan.cn/home/personal"><i class="i i9"></i>账户管理</a>','<li><a data-ca="header-bbs" href="http://bbs.kuaipan.cn"><i class="i i65"></i>进入论坛</a>','<li><a data-ca="header-feedback" href="http://www.kuaipan.cn/feedback.htm" target="_blank"><i class="i i13"></i>意见反馈</a>',"</ul>",'<p id="fallback2v1"><a data-ca="fallback2v1" href="javascript:void(0)"><i class="i i62"></i>返回旧版</a>','<p class="quit"><a data-ca="header-quit" href="<%= quitURL %>"><i class="i i18"></i>退出</a>',"</div>",'<li class="entry"><a data-ca="header-sign-in" id="sign-in" href="javascript:void(0)" class="sign-in"><i class="i i6"></i>签到</a>'].join("")}),"use strict",define("common/user/uInfo",["jquery","common/core/util","lib/artTemplate","common/user/uInfo.tmpl"],function(e,t,n,r){var i;if(!CONST.uid&&!CONST.uname){e("#entry").append('<li class="entry"><a href="javascript:;" class="login">登录</a><li class="entry"><a href="javascript:;" class="reg">注册</a>').on("click",function(t){var n=e(t.target);n.hasClass("login")?require(["app/passport/lon"],function(e){e.init(function(){location.reload()})}):n.hasClass("reg")&&require(["app/passport/reg"],function(e){e.createNew({errMsgs:{inputCorrectEmail:"请输入正确的用户名",inputPassword:"请填写登录密码",passwordLength:"密码应在6-32位字符内",noreg:"此账号未注册",checkemailcode_2:"此账号未注册",checkemailcode_:"服务器繁忙，请稍后再试",account_api_login_accountNotMatch:"账号密码不匹配",account_api_login_serverdown:"服务器维护中",account_api_login_clientUserBaned:"您的账号被限制登录",account_api_login_accUserInvalid:"正在对该账号进行绑定处理，暂无法登录",account_api_login_userLocked:"帐号锁定中，暂时无法登录"}})})});return}if(CONST.usedSpacePercent){var s=13,o=Math.round(CONST.usedSpacePercent*s);o>=s&&(o=s-1);var u=['<div id="user-space" class="user-space">',"<p>"+CONST.usedSpace+" / "+CONST.totalSpace,'<div id="spacePie"><p style="top:-'+o+'00%"></div>',"</div>"];e("#aside").append(u.join(""))}var a=3,f=1,l="低";CONST.umail&&f++,CONST.umobi&&f++,f>0&&f<a?l="中":f==a&&(l="高");var c=n.compile(r)({uname:CONST.uname,mail:CONST.umail,mobi:CONST.umobi,secureLv:f/a*100+"%",secureMsg:l,quitURL:CONST.download!==undefined&&CONST.entryId!==undefined&&CONST.olId!==undefined?"/account_logout.htm?back=1&goback="+location.href:"/account_logout.htm?back=1&goback=/user/login"});return e.post("/home.htm?op=getturnplatetime",function(t){if(typeof t=="string"&&t.search(/^{/)<0)return;t=e.parseJSON(t),"ok"==t.status&&0==t.data&&e("#turnplate").removeClass("noDis")}),e("#entry").append(c),e("#user-name").on({mouseenter:function(){e("#usrDrop").removeClass("noVis")},mouseleave:function(){e("#usrDrop").addClass("noVis")}}),e("#fallback2v1 > a").on("click",function(){e.post("/ajax/home/setHomeVer/0",function(){window.location.href="http://www.kuaipan.cn/home.htm"})}),i}),"use strict",define("module/fileview/usersign",["common/core/core"],function(){var e;KP.Core.register("fileview-usersign",function(t){function s(){$.ajax({url:r,type:"get",dataType:"json",success:function(e){if(e&&e.state==1||e&&0==e.state){$("#checkinState").attr("class","resMsg resMsg_ok").html("恭喜您，签到成功！");var t=e.increase*1,n=e.rewardsize*1;t==0&&e.monthtask.M900==900?$(".chk-reward").append("<div>本月签到积分已领取完成</div>"):(t=isNaN(t)?0:t,$(".chk-reward").append('<span class="mr15">签到奖励积分：'+t+"</span>")),n==0?$(".chk-reward").append("<div >手气太不好了！奖励 0M 空间</div>"):(n=isNaN(n)?0:n,$(".chk-reward").append("<div >签到奖励空间："+n+" M</div>"))}else e.state==-102?$("#checkinState").attr("class","resMsg resMsg_ok").html("今天您已经签到过了"):$("#checkinState").attr("class","resMsg resMsg_err").html("签到失败，请稍后再试！")}})}function o(){var e=['<div class="dialogT">签到</div>','<div class="dialogC">','<div class="resMsg" id="checkinState"></div>','<div class="chk-reward"></div>','<div class="tasklist" id="moretasktry">',"</div>","</div>",'<div class="dialogB btns2">','<button class="btn">关闭</button>',"</div>"].join("");return e}function u(){$.ajax({url:i,dataType:"json",success:function(e){if(e&&"ok"==e.result){var t=e.mission,n=[],r,i=1,s="";for(var o=0,u=t.length;o<u;o++)r=t[o],r.isDone===!1&&i<=2&&(n.push('<li class="task"><a href="/home/task" title="'+r.name+"+"+r.total_bonus+'">'+r.name+"</a>+"+r.total_bonus),i++);n.length?$("#moretasktry").html(['<p class="ttl">还想更大空间？试试这些吧：','<ul class="tasks">',n.join(""),'<li class="task"><a href="/home/task" title="查看更多任务">更多任务&gt;&gt;</a>',"</ul>"].join("")):$("#moretasktry").html(['<p class="ttl">恭喜您，所有任务已经完成了！','<ul class="tasks">','<li class="task"><a href="/home/record">查看我的空间成长记录</a>',"</ul>"].join(""))}}})}function a(){e?e.show():e=new Dialog({html:o(),classname:"taskDialog"}),e.dialogEle.on("click","div.dialogB button.btn",function(){e.hide()}),u(),s()}function f(){n.off().on("click",function(){a()})}var n=$("#sign-in"),r="/index.php?ac=common&op=usersign",i="/index.php?ac=zone&op=taskdetail";return{init:function(){f()},destroy:function(){}}})}),"use strict",define("lib/dialog/dialog",[],function(){window.Dialog=function(){function e(e){this.config={isShow:!0,onShow:function(){},onInit:function(){}},$.extend(this.config,e),$.proxy(t,this)(),$.proxy(l,this)()}function t(){var e=[],t,r;e.push('<div class="dialog '+(this.config.classname||"")+'">'),e.push('  <button class="dialog-close"></button>'),e.push(this.config.html),e.push("</div>"),t=$(e.join("")),this.element=t,$("body").append(t),this.config.width&&t.width(this.config.width),this.config.height&&t.height(this.config.height),this.config.isShow||t.hide(),r=s(t),t.css(r),this.dialogEle=t,n(),this.config.onInit()}function n(){var e=$("#overlay");e&&e.remove(),e=$('<div id="overlay" class="overlay"></div>'),i(e),$("body").append(e)}function r(e){$("#overlay").remove()}function i(e){var t=e||$("#overlay"),n=u(),r=n.width,i=n.height;if(parseInt($("html").css("padding-top"))>0&&!window.ActiveXObject)return;t.css({width:r,height:$("html").outerHeight()})}function s(e){var t=o(),n=t.width,r=t.height,i=e.width(),s=e.height(),u=21,a=function(){var e=$(this).css("zIndex")-0;u<e&&(u=e)};return $(".ui-dialog").each(function(){a.call(this)}),$(".dialog").each(function(){a.call(this)}),{left:(n-i)/2,top:(r-s)/3,zIndex:u+1}}function o(){var e={},t=document.documentElement;return e.height=t.clientHeight,e.width=t.clientWidth,e}function u(){var e={},t=document.documentElement;return e.width=t.scrollWidth,e.height=t.scrollHeight>t.clientHeight?t.scrollHeight:t.clientHeight,e}function a(){var e=this.dialogEle,t=s(e);e.css(t)}function f(){$.proxy(a,this)(),i()}function l(){var e=this.dialogEle;e.on("click",".dialog-close",$.proxy(this.hide,this)),$(window).on("resize",$.proxy(f,this)),$(document).on("keydown",$.proxy(c,this)),e.find(".dialogT").on("mousedown",$.proxy(h.start,this))}e.prototype.show=function(){n(),this.dialogEle.show()},e.prototype.hide=function(){this.dialogEle.hide(),r(),this.config.beforeClose&&this.config.beforeClose.apply(this)},e.prototype.destory=function(){this.dialogEle.remove(),r()};var c=function(e){e.keyCode==27&&this.hide()},h={eles:{title:null,dialog:null},locked:!1,x:null,y:null,freeze:function(){return h.locked?h.eles.title.addClass("noSelect"):h.eles.title.removeClass("noSelect"),!1},start:function(e){if(!$(e.target).hasClass("dialogT"))return;h.eles={title:this.dialogEle.find(".dialogT"),dialog:this.dialogEle},e.preventDefault(),e.stopPropagation(),h.x=e.clientX-h.eles.dialog.position().left,h.y=e.clientY-h.eles.dialog.position().top,h.locked=!0,$(document).on({mousemove:h.go,blur:h.stop,mouseup:h.stop,selectstart:h.freeze}),h.freeze()},go:function(e){var t=3,n=h.eles.dialog.eq(0).width()+t+2,r=h.eles.dialog.eq(0).height()+t+2,i=document.documentElement.clientWidth,s=document.documentElement.clientHeight,o=e.clientX-h.x,u=e.clientY-h.y;o-t<=0&&(o=t),o+n>=i&&(o=i-n),u-t<=0&&(u=t),u+r>=s&&(u=s-r);if(!h.locked){h.stop();return}h.eles.dialog.css({left:o+"px",top:u+"px"})},stop:function(e){h.locked=!1,$(document).off({mousemove:h.go,mouseup:h.stop,blur:h.stop,selectstart:h.freeze})}};return e}()}),"use strict",define("lib/tab/tab",["jquery"],function(){var e=function(e,t){var n,r,i,s,o;t=t||0,e?r=e.find("div.Tab"):r=$("#mainer div.Tab");if(r.data("Tab"))return r.data("Tab");i=r.find("li.tab"),i.each(function(e){$(this).attr("tab-order",e)}),s=i.find("a"),o=i.filter(".cur"),n=r.find("p.tabCursor"),n.length||(n=$('<p class="tabCursor noVis">').prependTo(r)),n.removeClass("hasTransition"),s.on({mouseenter:function(e){u($(e.target).parent())},mouseleave:function(){u(o)},click:function(e){var t=$(e.target).parent();a(t),r.trigger("tabChange",t)}});var u=function(e,t){if(!e.length){n.addClass("noVis").removeClass("hasTransition");return}t||(t=function(){}),n.css({left:e.position().left,width:e.outerWidth()}).removeClass("noVis"),setTimeout(function(){t()},0)},a=function(e,t){typeof e=="number"&&(e=i.eq(e)),t=t||1,n.removeClass("hasTransition"),i.removeClass("cur"),o=$(e),o.addClass("cur"),u(o,function(){if(!t)return;n.addClass("hasTransition")})};u(o,function(){n.addClass("hasTransition")});var f={go:a,ele:r};return r.data("Tab",f),f};return{createNew:e}}),"use strict",define("extends/lazyload/scrollstop",["jquery"],function(){(function(){var e=jQuery.event.special,t="D"+ +(new Date),n="D"+(+(new Date)+1);e.scrollstart={setup:function(){var n,r=function(t){var r=this,i=arguments;n?clearTimeout(n):(t.type="scrollstart",jQuery.event.handle.apply(r,i)),n=setTimeout(function(){n=null},e.scrollstop.latency)};jQuery(this).bind("scroll",r).data(t,r)},teardown:function(){jQuery(this).unbind("scroll",jQuery(this).data(t))}},e.scrollstop={latency:300,setup:function(){var t,r=function(n){var r=this,i=arguments;t&&clearTimeout(t),t=setTimeout(function(){t=null,n.type="scrollstop",jQuery.event.handle.apply(r,i)},e.scrollstop.latency)};jQuery(this).bind("scroll",r).data(n,r)},teardown:function(){jQuery(this).unbind("scroll",jQuery(this).data(n))}}})()}),"use strict",define("extends/lazyload/lazyload",["jquery"],function(){(function(){var e=$(window);$.fn.lazyload=function(t){function i(){var e=0;n.each(function(){var t=$(this);if(r.skip_invisible&&!t.is(":visible"))return;if(!$.abovethetop(this,r)&&!$.leftofbegin(this,r))if(!$.belowthefold(this,r)&&!$.rightoffold(this,r))t.trigger("appear");else if(++e>r.failure_limit)return!1})}var n=this,r={threshold:0,failure_limit:0,event:"scroll",effect:"show",container:window,data_attribute:"original",skip_invisible:!0,appear:null,load:null};t&&(undefined!==t.failurelimit&&(t.failure_limit=t.failurelimit,delete t.failurelimit),undefined!==t.effectspeed&&(t.effect_speed=t.effectspeed,delete t.effectspeed),$.extend(r,t));var s=r.container===undefined||r.container===window?e:$(r.container);return 0===r.event.indexOf("scroll")&&s.bind(r.event,function(e){return i()}),this.each(function(){var e=this,t=$(e);e.loaded=!1,t.one("appear",function(){if(!this.loaded){if(r.appear){var i=n.length;r.appear.call(e,i,r)}$("<img />").bind("load",function(){var i=this;i.width>0&&i.height>0&&(i.width/i.height>=r.width/r.height?i.width>r.width?(t.width(r.width),t.height(i.height*r.width/i.width)):(t.width(i.width),t.height(i.height)):i.height>r.height?(t.height(r.height),t.width(i.width*r.width/i.height)):(t.width(i.width),t.height(i.height))),t.attr("src",i.src).hide()[r.effect](r.effect_speed),t.parent("div").css({background:""}),e.loaded=!0;var s=$.grep(n,function(e){return!e.loaded});n=$(s);if(r.load){var o=n.length;r.load.call(e,o,r)}}).attr("src",t.data(r.data_attribute))}}),0!==r.event.indexOf("scroll")&&t.bind(r.event,function(n){e.loaded||t.trigger("appear")})}),e.bind("resize",function(e){i()}),i(),this},$.belowthefold=function(t,n){var r;return n.container===undefined||n.container===window?r=e.height()+e.scrollTop():r=$container.offset().top+$container.height(),r<=$(t).offset().top-n.threshold},$.rightoffold=function(t,n){var r;return n.container===undefined||n.container===window?r=e.width()+e.scrollLeft():r=$container.offset().left+$container.width(),r<=$(t).offset().left-n.threshold},$.abovethetop=function(t,n){var r;return n.container===undefined||n.container===window?r=e.scrollTop():r=$container.offset().top,r>=$(t).offset().top+n.threshold+$(t).height()},$.leftofbegin=function(t,n){var r;return n.container===undefined||n.container===window?r=e.scrollLeft():r=$container.offset().left,r>=$(t).offset().left+n.threshold+$(t).width()},$.inviewport=function(e,t){return!$.rightofscreen(e,t)&&!$.leftofscreen(e,t)&&!$.belowthefold(e,t)&&!$.abovethetop(e,t)},$.extend($.expr[":"],{"below-the-fold":function(e){return $.belowthefold(e,{threshold:0,container:window})},"above-the-top":function(e){return!$.belowthefold(e,{threshold:0,container:window})},"right-of-screen":function(e){return $.rightoffold(e,{threshold:0,container:window})},"left-of-screen":function(e){return!$.rightoffold(e,{threshold:0,container:window})},"in-viewport":function(e){return!$.inviewport(e,{threshold:0,container:window})},"above-the-fold":function(e){return!$.belowthefold(e,{threshold:0,container:window})},"right-of-fold":function(e){return $.rightoffold(e,{threshold:0,container:window})},"left-of-fold":function(e){return!$.rightoffold(e,{threshold:0,container:window})}})})()}),"use strict",define("common/core/main",["jquery","common/core/core","common/core/common","common/user/uInfo","module/fileview/usersign","lib/dialog/dialog","lib/tab/tab","extends/lazyload/scrollstop","extends/lazyload/lazyload"],function(){}),"use strict",require.config({baseUrl:"//j2.s.ksyun.com/pan/v1.1/1378294456726",paths:{jquery:"//j1.s.ksyun.com/lib/jquery/1.7.1"}}),define("common/config",["common/baseConfig","common/core/main"],function(){$(function(){document.documentElement.attachEvent&&document.documentElement.attachEvent("onselectstart",function(){var e=event.srcElement.nodeName.toLocaleLowerCase();return e==="input"||e==="textarea"})}),$("#mainer").append(['<p class="nativeApp">','<a data-ca="dl-pc-1" href="http://kad.k.wps.cn/kuaipan/setup/kuaipan_setup.exe" title="金山网盘Windows" class="pc" target="downloader"><b>Windows</b></a>','<a data-ca="dl-mac-1" href="http://kad.k.wps.cn/kuaipan/setup/kuaipan.dmg" title="Mac版网盘下载" class="mac" target="downloader"><b>Mac</b></a>','<a data-ca="dl-android-1" href="http://kad.k.wps.cn/kuaipan/setup/android/LiveSpace.apk" title="Android 网盘下载" class="android" target="downloader"><b>Android</b></a>','<a data-ca="dl-ios-1" href="http://www.kuaipan.cn/redirect.htm?url=https://itunes.apple.com/cn/app/id574341640?mt=8" title="网盘App Store" class="iphone" target="_blank"><b>iPhone</b></a>','<a data-ca="dl-more-1" href="http://www.kuaipan.cn/download.html" class="more" title="下载中心" target="_blank"><b>More</b></a>'].join("")),require(["lib/skin"])}),define("lib/jquery/ui.custom",["jquery"],function(){(function(e,t){function n(t,n){var i=t.nodeName.toLowerCase();if("area"===i){var s=t.parentNode,o=s.name,u;return!t.href||!o||s.nodeName.toLowerCase()!=="map"?!1:(u=e("img[usemap=#"+o+"]")[0],!!u&&r(u))}return(/input|select|textarea|button|object/.test(i)?!t.disabled:"a"==i?t.href||n:n)&&r(t)}function r(t){return!e(t).parents().andSelf().filter(function(){return e.curCSS(this,"visibility")==="hidden"||e.expr.filters.hidden(this)}).length}e.ui=e.ui||{};if(e.ui.version)return;e.extend(e.ui,{version:"1.8.20",keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}}),e.fn.extend({propAttr:e.fn.prop||e.fn.attr,_focus:e.fn.focus,focus:function(t,n){return typeof t=="number"?this.each(function(){var r=this;setTimeout(function(){e(r).focus(),n&&n.call(r)},t)}):this._focus.apply(this,arguments)},scrollParent:function(){var t;return e.browser.msie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?t=this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.curCSS(this,"position",1))&&/(auto|scroll)/.test(e.curCSS(this,"overflow",1)+e.curCSS(this,"overflow-y",1)+e.curCSS(this,"overflow-x",1))}).eq(0):t=this.parents().filter(function(){return/(auto|scroll)/.test(e.curCSS(this,"overflow",1)+e.curCSS(this,"overflow-y",1)+e.curCSS(this,"overflow-x",1))}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(n){if(n!==t)return this.css("zIndex",n);if(this.length){var r=e(this[0]),i,s;while(r.length&&r[0]!==document){i=r.css("position");if(i==="absolute"||i==="relative"||i==="fixed"){s=parseInt(r.css("zIndex"),10);if(!isNaN(s)&&s!==0)return s}r=r.parent()}}return 0},disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),e.each(["Width","Height"],function(n,r){function i(t,n,r,i){return e.each(s,function(){n-=parseFloat(e.curCSS(t,"padding"+this,!0))||0,r&&(n-=parseFloat(e.curCSS(t,"border"+this+"Width",!0))||0),i&&(n-=parseFloat(e.curCSS(t,"margin"+this,!0))||0)}),n}var s=r==="Width"?["Left","Right"]:["Top","Bottom"],o=r.toLowerCase(),u={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+r]=function(n){return n===t?u["inner"+r].call(this):this.each(function(){e(this).css(o,i(this,n)+"px")})},e.fn["outer"+r]=function(t,n){return typeof t!="number"?u["outer"+r].call(this,t):this.each(function(){e(this).css(o,i(this,t,!0,n)+"px")})}}),e.extend(e.expr[":"],{data:function(t,n,r){return!!e.data(t,r[3])},focusable:function(t){return n(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var r=e.attr(t,"tabindex"),i=isNaN(r);return(i||r>=0)&&n(t,!i)}}),e(function(){var t=document.body,n=t.appendChild(n=document.createElement("div"));n.offsetHeight,e.extend(n.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0}),e.support.minHeight=n.offsetHeight===100,e.support.selectstart="onselectstart"in n,t.removeChild(n).style.display="none"}),e.extend(e.ui,{plugin:{add:function(t,n,r){var i=e.ui[t].prototype;for(var s in r)i.plugins[s]=i.plugins[s]||[],i.plugins[s].push([n,r[s]])},call:function(e,t,n){var r=e.plugins[t];if(!r||!e.element[0].parentNode)return;for(var i=0;i<r.length;i++)e.options[r[i][0]]&&r[i][1].apply(e.element,n)}},contains:function(e,t){return document.compareDocumentPosition?e.compareDocumentPosition(t)&16:e!==t&&e.contains(t)},hasScroll:function(t,n){if(e(t).css("overflow")==="hidden")return!1;var r=n&&n==="left"?"scrollLeft":"scrollTop",i=!1;return t[r]>0?!0:(t[r]=1,i=t[r]>0,t[r]=0,i)},isOverAxis:function(e,t,n){return e>t&&e<t+n},isOver:function(t,n,r,i,s,o){return e.ui.isOverAxis(t,r,s)&&e.ui.isOverAxis(n,i,o)}})})(jQuery),function(e,t){if(e.cleanData){var n=e.cleanData;e.cleanData=function(t){for(var r=0,i;(i=t[r])!=null;r++)try{e(i).triggerHandler("remove")}catch(s){}n(t)}}else{var r=e.fn.remove;e.fn.remove=function(t,n){return this.each(function(){return n||(!t||e.filter(t,[this]).length)&&e("*",this).add([this]).each(function(){try{e(this).triggerHandler("remove")}catch(t){}}),r.call(e(this),t,n)})}}e.widget=function(t,n,r){var i=t.split(".")[0],s;t=t.split(".")[1],s=i+"-"+t,r||(r=n,n=e.Widget),e.expr[":"][s]=function(n){return!!e.data(n,t)},e[i]=e[i]||{},e[i][t]=function(e,t){arguments.length&&this._createWidget(e,t)};var o=new n;o.options=e.extend(!0,{},o.options),e[i][t].prototype=e.extend(!0,o,{namespace:i,widgetName:t,widgetEventPrefix:e[i][t].prototype.widgetEventPrefix||t,widgetBaseClass:s},r),e.widget.bridge(t,e[i][t])},e.widget.bridge=function(n,r){e.fn[n]=function(i){var s=typeof i=="string",o=Array.prototype.slice.call(arguments,1),u=this;return i=!s&&o.length?e.extend.apply(null,[!0,i].concat(o)):i,s&&i.charAt(0)==="_"?u:(s?this.each(function(){var r=e.data(this,n),s=r&&e.isFunction(r[i])?r[i].apply(r,o):r;if(s!==r&&s!==t)return u=s,!1}):this.each(function(){var t=e.data(this,n);t?t.option(i||{})._init():e.data(this,n,new r(i,this))}),u)}},e.Widget=function(e,t){arguments.length&&this._createWidget(e,t)},e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:!1},_createWidget:function(t,n){e.data(n,this.widgetName,this),this.element=e(n),this.options=e.extend(!0,{},this.options,this._getCreateOptions(),t);var r=this;this.element.bind("remove."+this.widgetName,function(){r.destroy()}),this._create(),this._trigger("create"),this._init()},_getCreateOptions:function(){return e.metadata&&e.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName),this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled "+"ui-state-disabled")},widget:function(){return this.element},option:function(n,r){var i=n;if(arguments.length===0)return e.extend({},this.options);if(typeof n=="string"){if(r===t)return this.options[n];i={},i[n]=r}return this._setOptions(i),this},_setOptions:function(t){var n=this;return e.each(t,function(e,t){n._setOption(e,t)}),this},_setOption:function(e,t){return this.options[e]=t,e==="disabled"&&this.widget()[t?"addClass":"removeClass"](this.widgetBaseClass+"-disabled"+" "+"ui-state-disabled").attr("aria-disabled",t),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_trigger:function(t,n,r){var i,s,o=this.options[t];r=r||{},n=e.Event(n),n.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),n.target=this.element[0],s=n.originalEvent;if(s)for(i in s)i in n||(n[i]=s[i]);return this.element.trigger(n,r),!(e.isFunction(o)&&o.call(this.element[0],n,r)===!1||n.isDefaultPrevented())}}}(jQuery),function(e,t){var n=!1;e(document).mouseup(function(e){n=!1}),e.widget("ui.mouse",{options:{cancel:":input,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(n){if(!0===e.data(n.target,t.widgetName+".preventClickEvent"))return e.removeData(n.target,t.widgetName+".preventClickEvent"),n.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(t){if(n)return;this._mouseStarted&&this._mouseUp(t),this._mouseDownEvent=t;var r=this,i=t.which==1,s=typeof this.options.cancel=="string"&&t.target.nodeName?e(t.target).closest(this.options.cancel).length:!1;if(!i||s||!this._mouseCapture(t))return!0;this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){r.mouseDelayMet=!0},this.options.delay));if(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)){this._mouseStarted=this._mouseStart(t)!==!1;if(!this._mouseStarted)return t.preventDefault(),!0}return!0===e.data(t.target,this.widgetName+".preventClickEvent")&&e.removeData(t.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return r._mouseMove(e)},this._mouseUpDelegate=function(e){return r._mouseUp(e)},e(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),t.preventDefault(),n=!0,!0},_mouseMove:function(t){return!e.browser.msie||document.documentMode>=9||!!t.button?this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted):this._mouseUp(t)},_mouseUp:function(t){return e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target==this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(e){return this.mouseDelayMet},_mouseStart:function(e){},_mouseDrag:function(e){},_mouseStop:function(e){},_mouseCapture:function(e){return!0}})}(jQuery),function(e,t){e.ui=e.ui||{};var n=/left|center|right/,r=/top|center|bottom/,i="center",s={},o=e.fn.position,u=e.fn.offset;e.fn.position=function(t){if(!t||!t.of)return o.apply(this,arguments);t=e.extend({},t);var u=e(t.of),l=u[0],h=(t.collision||"flip").split(" "),p=t.offset?t.offset.split(" "):[0,0],v,m,y;return l.nodeType===9?(v=u.width(),m=u.height(),y={top:0,left:0}):l.setTimeout?(v=u.width(),m=u.height(),y={top:u.scrollTop(),left:u.scrollLeft()}):l.preventDefault?(t.at="left top",v=m=0,y={top:t.of.pageY,left:t.of.pageX}):(v=u.outerWidth(),m=u.outerHeight(),y=u.offset()),e.each(["my","at"],function(){var e=(t[this]||"").split(" ");e.length===1&&(e=n.test(e[0])?e.concat([i]):r.test(e[0])?[i].concat(e):[i,i]),e[0]=n.test(e[0])?e[0]:i,e[1]=r.test(e[1])?e[1]:i,t[this]=e}),h.length===1&&(h[1]=h[0]),p[0]=parseInt(p[0],10)||0,p.length===1&&(p[1]=p[0]),p[1]=parseInt(p[1],10)||0,t.at[0]==="right"?y.left+=v:t.at[0]===i&&(y.left+=v/2),t.at[1]==="bottom"?y.top+=m:t.at[1]===i&&(y.top+=m/2),y.left+=p[0],y.top+=p[1],this.each(function(){var n=e(this),r=n.outerWidth(),o=n.outerHeight(),u=parseInt(e.curCSS(this,"marginLeft",!0))||0,l=parseInt(e.curCSS(this,"marginTop",!0))||0,c=r+u+(parseInt(e.curCSS(this,"marginRight",!0))||0),d=o+l+(parseInt(e.curCSS(this,"marginBottom",!0))||0),g=e.extend({},y),w;t.my[0]==="right"?g.left-=r:t.my[0]===i&&(g.left-=r/2),t.my[1]==="bottom"?g.top-=o:t.my[1]===i&&(g.top-=o/2),s.fractions||(g.left=Math.round(g.left),g.top=Math.round(g.top)),w={left:g.left-u,top:g.top-l},e.each(["left","top"],function(n,i){e.ui.position[h[n]]&&e.ui.position[h[n]][i](g,{targetWidth:v,targetHeight:m,elemWidth:r,elemHeight:o,collisionPosition:w,collisionWidth:c,collisionHeight:d,offset:p,my:t.my,at:t.at})}),e.fn.bgiframe&&n.bgiframe(),n.offset(e.extend(g,{using:t.using}))})},e.ui.position={fit:{left:function(t,n){var r=e(window),i=n.collisionPosition.left+n.collisionWidth-r.width()-r.scrollLeft();t.left=i>0?t.left-i:Math.max(t.left-n.collisionPosition.left,t.left)},top:function(t,n){var r=e(window),i=n.collisionPosition.top+n.collisionHeight-r.height()-r.scrollTop();t.top=i>0?t.top-i:Math.max(t.top-n.collisionPosition.top,t.top)}},flip:{left:function(t,n){if(n.at[0]===i)return;var r=e(window),s=n.collisionPosition.left+n.collisionWidth-r.width()-r.scrollLeft(),o=n.my[0]==="left"?-n.elemWidth:n.my[0]==="right"?n.elemWidth:0,u=n.at[0]==="left"?n.targetWidth:-n.targetWidth,f=-2*n.offset[0];t.left+=n.collisionPosition.left<0?o+u+f:s>0?o+u+f:0},top:function(t,n){if(n.at[1]===i)return;var r=e(window),s=n.collisionPosition.top+n.collisionHeight-r.height()-r.scrollTop(),o=n.my[1]==="top"?-n.elemHeight:n.my[1]==="bottom"?n.elemHeight:0,u=n.at[1]==="top"?n.targetHeight:-n.targetHeight,f=-2*n.offset[1];t.top+=n.collisionPosition.top<0?o+u+f:s>0?o+u+f:0}}},e.offset.setOffset||(e.offset.setOffset=function(t,n){/static/.test(e.curCSS(t,"position"))&&(t.style.position="relative");var r=e(t),i=r.offset(),s=parseInt(e.curCSS(t,"top",!0),10)||0,o=parseInt(e.curCSS(t,"left",!0),10)||0,u={top:n.top-i.top+s,left:n.left-i.left+o};"using"in n?n.using.call(t,u):r.css(u)},e.fn.offset=function(t){var n=this[0];return!n||!n.ownerDocument?null:t?this.each(function(){e.offset.setOffset(this,t)}):u.call(this)}),function(){var t=document.getElementsByTagName("body")[0],n=document.createElement("div"),r,i,o,u,l;r=document.createElement(t?"div":"body"),o={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},t&&e.extend(o,{position:"absolute",left:"-1000px",top:"-1000px"});for(var c in o)r.style[c]=o[c];r.appendChild(n),i=t||document.documentElement,i.insertBefore(r,i.firstChild),n.style.cssText="position: absolute; left: 10.7432222px; top: 10.432325px; height: 30px; width: 201px;",u=e(n).offset(function(e,t){return t}).offset(),r.innerHTML="",i.removeChild(r),l=u.top+u.left+(t?2e3:0),s.fractions=l>21&&l<22}()}(jQuery),function(e,t){e.widget("ui.draggable",e.ui.mouse,{widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1},_create:function(){this.options.helper=="original"&&!/^(?:r|a|f)/.test(this.element.css("position"))&&(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},destroy:function(){if(!this.element.data("draggable"))return;return this.element.removeData("draggable").unbind(".draggable").removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy(),this},_mouseCapture:function(t){var n=this.options;return this.helper||n.disabled||e(t.target).is(".ui-resizable-handle")?!1:(this.handle=this._getHandle(t),this.handle?(n.iframeFix&&e(n.iframeFix===!0?"iframe":n.iframeFix).each(function(){e('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(e(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(t){var n=this.options;return this.helper=this._createHelper(t),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,n.cursorAt&&this._adjustOffsetFromHelper(n.cursorAt),n.containment&&this._setContainment(),this._trigger("start",t)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.helper.addClass("ui-draggable-dragging"),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_mouseDrag:function(t,n){this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute");if(!n){var r=this._uiHash();if(this._trigger("drag",t,r)===!1)return this._mouseUp({}),!1;this.position=r.position}if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+"px";return e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var n=!1;e.ui.ddmanager&&!this.options.dropBehaviour&&(n=e.ui.ddmanager.drop(this,t)),this.dropped&&(n=this.dropped,this.dropped=!1);var r=this.element[0],i=!1;while(r&&(r=r.parentNode))r==document&&(i=!0);if(!i&&this.options.helper==="original")return!1;if(this.options.revert=="invalid"&&!n||this.options.revert=="valid"&&n||this.options.revert===!0||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,n)){var s=this;e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){s._trigger("stop",t)!==!1&&s._clear()})}else this._trigger("stop",t)!==!1&&this._clear();return!1},_mouseUp:function(t){return this.options.iframeFix===!0&&e("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){var n=!this.options.handle||!e(this.options.handle,this.element).length?!0:!1;return e(this.options.handle,this.element).find("*").andSelf().each(function(){this==t.target&&(n=!0)}),n},_createHelper:function(t){var n=this.options,r=e.isFunction(n.helper)?e(n.helper.apply(this.element[0],[t])):n.helper=="clone"?this.element.clone().removeAttr("id"):this.element;return r.parents("body").length||r.appendTo(n.appendTo=="parent"?this.element[0].parentNode:n.appendTo),r[0]!=this.element[0]&&!/(fixed|absolute)/.test(r.css("position"))&&r.css("position","absolute"),r},_adjustOffsetFromHelper:function(t){typeof t=="string"&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&e.ui.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop());if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&e.browser.msie)t={top:0,left:0};return{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var e=this.element.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t=this.options;t.containment=="parent"&&(t.containment=this.helper[0].parentNode);if(t.containment=="document"||t.containment=="window")this.containment=[t.containment=="document"?0:e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,t.containment=="document"?0:e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,(t.containment=="document"?0:e(window).scrollLeft())+e(t.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(t.containment=="document"?0:e(window).scrollTop())+(e(t.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(t.containment)&&t.containment.constructor!=Array){var n=e(t.containment),r=n[0];if(!r)return;var i=n.offset(),s=e(r).css("overflow")!="hidden";this.containment=[(parseInt(e(r).css("borderLeftWidth"),10)||0)+(parseInt(e(r).css("paddingLeft"),10)||0),(parseInt(e(r).css("borderTopWidth"),10)||0)+(parseInt(e(r).css("paddingTop"),10)||0),(s?Math.max(r.scrollWidth,r.offsetWidth):r.offsetWidth)-(parseInt(e(r).css("borderLeftWidth"),10)||0)-(parseInt(e(r).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(s?Math.max(r.scrollHeight,r.offsetHeight):r.offsetHeight)-(parseInt(e(r).css("borderTopWidth"),10)||0)-(parseInt(e(r).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=n}else t.containment.constructor==Array&&(this.containment=t.containment)},_convertPositionTo:function(t,n){n||(n=this.position);var r=t=="absolute"?1:-1,i=this.options,s=this.cssPosition!="absolute"||this.scrollParent[0]!=document&&!!e.ui.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(s[0].tagName);return{top:n.top+this.offset.relative.top*r+this.offset.parent.top*r-(e.browser.safari&&e.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():o?0:s.scrollTop())*r),left:n.left+this.offset.relative.left*r+this.offset.parent.left*r-(e.browser.safari&&e.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():o?0:s.scrollLeft())*r)}},_generatePosition:function(t){var n=this.options,r=this.cssPosition!="absolute"||this.scrollParent[0]!=document&&!!e.ui.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,i=/(html|body)/i.test(r[0].tagName),s=t.pageX,o=t.pageY;if(this.originalPosition){var u;if(this.containment){if(this.relative_container){var f=this.relative_container.offset();u=[this.containment[0]+f.left,this.containment[1]+f.top,this.containment[2]+f.left,this.containment[3]+f.top]}else u=this.containment;t.pageX-this.offset.click.left<u[0]&&(s=u[0]+this.offset.click.left),t.pageY-this.offset.click.top<u[1]&&(o=u[1]+this.offset.click.top),t.pageX-this.offset.click.left>u[2]&&(s=u[2]+this.offset.click.left),t.pageY-this.offset.click.top>u[3]&&(o=u[3]+this.offset.click.top)}if(n.grid){var l=n.grid[1]?this.originalPageY+Math.round((o-this.originalPageY)/n.grid[1])*n.grid[1]:this.originalPageY;o=u?l-this.offset.click.top<u[1]||l-this.offset.click.top>u[3]?l-this.offset.click.top<u[1]?l+n.grid[1]:l-n.grid[1]:l:l;var c=n.grid[0]?this.originalPageX+Math.round((s-this.originalPageX)/n.grid[0])*n.grid[0]:this.originalPageX;s=u?c-this.offset.click.left<u[0]||c-this.offset.click.left>u[2]?c-this.offset.click.left<u[0]?c+n.grid[0]:c-n.grid[0]:c:c}}return{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(e.browser.safari&&e.browser.version<526&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollTop():i?0:r.scrollTop()),left:s-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(e.browser.safari&&e.browser.version<526&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():i?0:r.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval&&this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(t,n,r){return r=r||this._uiHash(),e.ui.plugin.call(this,t,[n,r]),t=="drag"&&(this.positionAbs=this._convertPositionTo("absolute")),e.Widget.prototype._trigger.call(this,t,n,r)},plugins:{},_uiHash:function(e){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.extend(e.ui.draggable,{version:"1.8.20"}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,n){var r=e(this).data("draggable"),i=r.options,s=e.extend({},n,{item:r.element});r.sortables=[],e(i.connectToSortable).each(function(){var n=e.data(this,"sortable");n&&!n.options.disabled&&(r.sortables.push({instance:n,shouldRevert:n.options.revert}),n.refreshPositions(),n._trigger("activate",t,s))})},stop:function(t,n){var r=e(this).data("draggable"),i=e.extend({},n,{item:r.element});e.each(r.sortables,function(){this.instance.isOver?(this.instance.isOver=0,r.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=!0),this.instance._mouseStop(t),this.instance.options.helper=this.instance.options._helper,r.options.helper=="original"&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",t,i))})},drag:function(t,n){var r=e(this).data("draggable"),i=this,s=function(t){var n=this.offset.click.top,r=this.offset.click.left,i=this.positionAbs.top,s=this.positionAbs.left,o=t.height,u=t.width,f=t.top,l=t.left;return e.ui.isOver(i+n,s+r,f,l,o,u)};e.each(r.sortables,function(s){this.instance.positionAbs=r.positionAbs,this.instance.helperProportions=r.helperProportions,this.instance.offset.click=r.offset.click,this.instance._intersectsWith(this.instance.containerCache)?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=e(i).clone().removeAttr("id").appendTo(this.instance.element).data("sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return n.helper[0]},t.target=this.instance.currentItem[0],this.instance._mouseCapture(t,!0),this.instance._mouseStart(t,!0,!0),this.instance.offset.click.top=r.offset.click.top,this.instance.offset.click.left=r.offset.click.left,this.instance.offset.parent.left-=r.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=r.offset.parent.top-this.instance.offset.parent.top,r._trigger("toSortable",t),r.dropped=this.instance.element,r.currentItem=r.element,this.instance.fromOutside=r),this.instance.currentItem&&this.instance._mouseDrag(t)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",t,this.instance._uiHash(this.instance)),this.instance._mouseStop(t,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),r._trigger("fromSortable",t),r.dropped=!1)})}}),e.ui.plugin.add("draggable","cursor",{start:function(t,n){var r=e("body"),i=e(this).data("draggable").options;r.css("cursor")&&(i._cursor=r.css("cursor")),r.css("cursor",i.cursor)},stop:function(t,n){var r=e(this).data("draggable").options;r._cursor&&e("body").css("cursor",r._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(t,n){var r=e(n.helper),i=e(this).data("draggable").options;r.css("opacity")&&(i._opacity=r.css("opacity")),r.css("opacity",i.opacity)},stop:function(t,n){var r=e(this).data("draggable").options;r._opacity&&e(n.helper).css("opacity",r._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(t,n){var r=e(this).data("draggable");r.scrollParent[0]!=document&&r.scrollParent[0].tagName!="HTML"&&(r.overflowOffset=r.scrollParent.offset())},drag:function(t,n){var r=e(this).data("draggable"),i=r.options,s=!1;if(r.scrollParent[0]!=document&&r.scrollParent[0].tagName!="HTML"){if(!i.axis||i.axis!="x")r.overflowOffset.top+r.scrollParent[0].offsetHeight-t.pageY<i.scrollSensitivity?r.scrollParent[0].scrollTop=s=r.scrollParent[0].scrollTop+i.scrollSpeed:t.pageY-r.overflowOffset.top<i.scrollSensitivity&&(r.scrollParent[0].scrollTop=s=r.scrollParent[0].scrollTop-i.scrollSpeed);if(!i.axis||i.axis!="y")r.overflowOffset.left+r.scrollParent[0].offsetWidth-t.pageX<i.scrollSensitivity?r.scrollParent[0].scrollLeft=s=r.scrollParent[0].scrollLeft+i.scrollSpeed:t.pageX-r.overflowOffset.left<i.scrollSensitivity&&(r.scrollParent[0].scrollLeft=s=r.scrollParent[0].scrollLeft-i.scrollSpeed)}else{if(!i.axis||i.axis!="x")t.pageY-e(document).scrollTop()<i.scrollSensitivity?s=e(document).scrollTop(e(document).scrollTop()-i.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<i.scrollSensitivity&&(s=e(document).scrollTop(e(document).scrollTop()+i.scrollSpeed));if(!i.axis||i.axis!="y")t.pageX-e(document).scrollLeft()<i.scrollSensitivity?s=e(document).scrollLeft(e(document).scrollLeft()-i.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<i.scrollSensitivity&&(s=e(document).scrollLeft(e(document).scrollLeft()+i.scrollSpeed))}s!==!1&&e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(r,t)}}),e.ui.plugin.add("draggable","snap",{start:function(t,n){var r=e(this).data("draggable"),i=r.options;r.snapElements=[],e(i.snap.constructor!=String?i.snap.items||":data(draggable)":i.snap).each(function(){var t=e(this),n=t.offset();this!=r.element[0]&&r.snapElements.push({item:this,width:t.outerWidth(),height:t.outerHeight(),top:n.top,left:n.left})})},drag:function(t,n){var r=e(this).data("draggable"),i=r.options,s=i.snapTolerance,o=n.offset.left,u=o+r.helperProportions.width,f=n.offset.top,l=f+r.helperProportions.height;for(var c=r.snapElements.length-1;c>=0;c--){var h=r.snapElements[c].left,p=h+r.snapElements[c].width,d=r.snapElements[c].top,v=d+r.snapElements[c].height;if(!(h-s<o&&o<p+s&&d-s<f&&f<v+s||h-s<o&&o<p+s&&d-s<l&&l<v+s||h-s<u&&u<p+s&&d-s<f&&f<v+s||h-s<u&&u<p+s&&d-s<l&&l<v+s)){r.snapElements[c].snapping&&r.options.snap.release&&r.options.snap.release.call(r.element,t,e.extend(r._uiHash(),{snapItem:r.snapElements[c].item})),r.snapElements[c].snapping=!1;continue}if(i.snapMode!="inner"){var m=Math.abs(d-l)<=s,g=Math.abs(v-f)<=s,y=Math.abs(h-u)<=s,b=Math.abs(p-o)<=s;m&&(n.position.top=r._convertPositionTo("relative",{top:d-r.helperProportions.height,left:0}).top-r.margins.top),g&&(n.position.top=r._convertPositionTo("relative",{top:v,left:0}).top-r.margins.top),y&&(n.position.left=r._convertPositionTo("relative",{top:0,left:h-r.helperProportions.width}).left-r.margins.left),b&&(n.position.left=r._convertPositionTo("relative",{top:0,left:p}).left-r.margins.left)}var w=m||g||y||b;if(i.snapMode!="outer"){var m=Math.abs(d-f)<=s,g=Math.abs(v-l)<=s,y=Math.abs(h-o)<=s,b=Math.abs(p-u)<=s;m&&(n.position.top=r._convertPositionTo("relative",{top:d,left:0}).top-r.margins.top),g&&(n.position.top=r._convertPositionTo("relative",{top:v-r.helperProportions.height,left:0}).top-r.margins.top),y&&(n.position.left=r._convertPositionTo("relative",{top:0,left:h}).left-r.margins.left),b&&(n.position.left=r._convertPositionTo("relative",{top:0,left:p-r.helperProportions.width}).left-r.margins.left)}!r.snapElements[c].snapping&&(m||g||y||b||w)&&r.options.snap.snap&&r.options.snap.snap.call(r.element,t,e.extend(r._uiHash(),{snapItem:r.snapElements[c].item})),r.snapElements[c].snapping=m||g||y||b||w}}}),e.ui.plugin.add("draggable","stack",{start:function(t,n){var r=e(this).data("draggable").options,i=e.makeArray(e(r.stack)).sort(function(t,n){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(n).css("zIndex"),10)||0)});if(!i.length)return;var s=parseInt(i[0].style.zIndex)||0;e(i).each(function(e){this.style.zIndex=s+e}),this[0].style.zIndex=s+i.length}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,n){var r=e(n.helper),i=e(this).data("draggable").options;r.css("zIndex")&&(i._zIndex=r.css("zIndex")),r.css("zIndex",i.zIndex)},stop:function(t,n){var r=e(this).data("draggable").options;r._zIndex&&e(n.helper).css("zIndex",r._zIndex)}})}(jQuery),function(e,t){e.widget("ui.droppable",{widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect"},_create:function(){var t=this.options,n=t.accept;this.isover=0,this.isout=1,this.accept=e.isFunction(n)?n:function(e){return e.is(n)},this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight},e.ui.ddmanager.droppables[t.scope]=e.ui.ddmanager.droppables[t.scope]||[],e.ui.ddmanager.droppables[t.scope].push(this),t.addClasses&&this.element.addClass("ui-droppable")},destroy:function(){var t=e.ui.ddmanager.droppables[this.options.scope];for(var n=0;n<t.length;n++)t[n]==this&&t.splice(n,1);return this.element.removeClass("ui-droppable ui-droppable-disabled").removeData("droppable").unbind(".droppable"),this},_setOption:function(t,n){t=="accept"&&(this.accept=e.isFunction(n)?n:function(e){return e.is(n)}),e.Widget.prototype._setOption.apply(this,arguments)},_activate:function(t){var n=e.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),n&&this._trigger("activate",t,this.ui(n))},_deactivate:function(t){var n=e.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),n&&this._trigger("deactivate",t,this.ui(n))},_over:function(t){var n=e.ui.ddmanager.current;if(!n||(n.currentItem||n.element)[0]==this.element[0])return;this.accept.call(this.element[0],n.currentItem||n.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",t,this.ui(n)))},_out:function(t){var n=e.ui.ddmanager.current;if(!n||(n.currentItem||n.element)[0]==this.element[0])return;this.accept.call(this.element[0],n.currentItem||n.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",t,this.ui(n)))},_drop:function(t,n){var r=n||e.ui.ddmanager.current;if(!r||(r.currentItem||r.element)[0]==this.element[0])return!1;var i=!1;return this.element.find(":data(droppable)").not(".ui-draggable-dragging").each(function(){var t=e.data(this,"droppable");if(t.options.greedy&&!t.options.disabled&&t.options.scope==r.options.scope&&t.accept.call(t.element[0],r.currentItem||r.element)&&e.ui.intersect(r,e.extend(t,{offset:t.element.offset()}),t.options.tolerance))return i=!0,!1}),i?!1:this.accept.call(this.element[0],r.currentItem||r.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",t,this.ui(r)),this.element):!1},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}}}),e.extend(e.ui.droppable,{version:"1.8.20"}),e.ui.intersect=function(t,n,r){if(!n.offset)return!1;var i=(t.positionAbs||t.position.absolute).left,s=i+t.helperProportions.width,o=(t.positionAbs||t.position.absolute).top,u=o+t.helperProportions.height,f=n.offset.left,l=f+n.proportions.width,c=n.offset.top,h=c+n.proportions.height;switch(r){case"fit":return f<=i&&s<=l&&c<=o&&u<=h;case"intersect":return f<i+t.helperProportions.width/2&&s-t.helperProportions.width/2<l&&c<o+t.helperProportions.height/2&&u-t.helperProportions.height/2<h;case"pointer":var p=(t.positionAbs||t.position.absolute).left+(t.clickOffset||t.offset.click).left,d=(t.positionAbs||t.position.absolute).top+(t.clickOffset||t.offset.click).top,v=e.ui.isOver(d,p,c,f,n.proportions.height,n.proportions.width);return v;case"touch":return(o>=c&&o<=h||u>=c&&u<=h||o<c&&u>h)&&(i>=f&&i<=l||s>=f&&s<=l||i<f&&s>l);default:return!1}},e.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(t,n){var r=e.ui.ddmanager.droppables[t.options.scope]||[],i=n?n.type:null,s=(t.currentItem||t.element).find(":data(droppable)").andSelf();e:for(var o=0;o<r.length;o++){if(r[o].options.disabled||t&&!r[o].accept.call(r[o].element[0],t.currentItem||t.element))continue;for(var u=0;u<s.length;u++)if(s[u]==r[o].element[0]){r[o].proportions.height=0;continue e}r[o].visible=r[o].element.css("display")!="none";if(!r[o].visible)continue;i=="mousedown"&&r[o]._activate.call(r[o],n),r[o].offset=r[o].element.offset(),r[o].proportions={width:r[o].element[0].offsetWidth,height:r[o].element[0].offsetHeight}}},drop:function(t,n){var r=!1;return e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(!this.options)return;!this.options.disabled&&this.visible&&e.ui.intersect(t,this,this.options.tolerance)&&(r=this._drop.call(this,n)||r),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.isout=1,this.isover=0,this._deactivate.call(this,n))}),r},dragStart:function(t,n){t.element.parents(":not(body,html)").bind("scroll.droppable",function(){t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,n)})},drag:function(t,n){t.options.refreshPositions&&e.ui.ddmanager.prepareOffsets(t,n),e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(this.options.disabled||this.greedyChild||!this.visible)return;var r=e.ui.intersect(t,this,this.options.tolerance),i=!r&&this.isover==1?"isout":r&&this.isover==0?"isover":null;if(!i)return;var s;if(this.options.greedy){var o=this.element.parents(":data(droppable):eq(0)");o.length&&(s=e.data(o[0],"droppable"),s.greedyChild=i=="isover"?1:0)}s&&i=="isover"&&(s.isover=0,s.isout=1,s._out.call(s,n)),this[i]=1,this[i=="isout"?"isover":"isout"]=0,this[i=="isover"?"_over":"_out"].call(this,n),s&&i=="isout"&&(s.isout=0,s.isover=1,s._over.call(s,n))})},dragStop:function(t,n){t.element.parents(":not(body,html)").unbind("scroll.droppable"),t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,n)}}}(jQuery),function(e,t){e.widget("ui.selectable",e.ui.mouse,{options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch"},_create:function(){var t=this;this.element.addClass("ui-selectable"),this.dragged=!1;var n;this.refresh=function(){n=e(t.options.filter,t.element[0]),n.addClass("ui-selectee"),n.each(function(){var t=e(this),n=t.offset();e.data(this,"selectable-item",{element:this,$element:t,left:n.left,top:n.top,right:n.left+t.outerWidth(),bottom:n.top+t.outerHeight(),startselected:!1,selected:t.hasClass("ui-selected"),selecting:t.hasClass("ui-selecting"),unselecting:t.hasClass("ui-unselecting")})})},this.refresh(),this.selectees=n.addClass("ui-selectee"),this._mouseInit(),this.helper=e("<div class='ui-selectable-helper'></div>")},destroy:function(){return this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled").removeData("selectable").unbind(".selectable"),this._mouseDestroy(),this},_mouseStart:function(t){var n=this;this.opos=[t.pageX,t.pageY];if(this.options.disabled)return;var r=this.options;this.selectees=e(r.filter,this.element[0]),this._trigger("start",t),e(r.appendTo).append(this.helper),this.helper.css({left:t.clientX,top:t.clientY,width:0,height:0}),r.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var r=e.data(this,"selectable-item");r.startselected=!0,!t.metaKey&&!t.ctrlKey&&(r.$element.removeClass("ui-selected"),r.selected=!1,r.$element.addClass("ui-unselecting"),r.unselecting=!0,n._trigger("unselecting",t,{unselecting:r.element}))}),e(t.target).parents().andSelf().each(function(){var r=e.data(this,"selectable-item");if(r){var i=!t.metaKey&&!t.ctrlKey||!r.$element.hasClass("ui-selected");return r.$element.removeClass(i?"ui-unselecting":"ui-selected").addClass(i?"ui-selecting":"ui-unselecting"),r.unselecting=!i,r.selecting=i,r.selected=i,i?n._trigger("selecting",t,{selecting:r.element}):n._trigger("unselecting",t,{unselecting:r.element}),!1}})},_mouseDrag:function(t){var n=this;this.dragged=!0;if(this.options.disabled)return;var r=this.options,i=this.opos[0],s=this.opos[1],o=t.pageX,u=t.pageY;if(i>o){var f=o;o=i,i=f}if(s>u){var f=u;u=s,s=f}return this.helper.css({left:i,top:s,width:o-i,height:u-s}),this.selectees.each(function(){var f=e.data(this,"selectable-item");if(!f||f.element==n.element[0])return;var l=!1;r.tolerance=="touch"?l=!(f.left>o||f.right<i||f.top>u||f.bottom<s):r.tolerance=="fit"&&(l=f.left>i&&f.right<o&&f.top>s&&f.bottom<u),l?(f.selected&&(f.$element.removeClass("ui-selected"),f.selected=!1),f.unselecting&&(f.$element.removeClass("ui-unselecting"),f.unselecting=!1),f.selecting||(f.$element.addClass("ui-selecting"),f.selecting=!0,n._trigger("selecting",t,{selecting:f.element}))):(f.selecting&&((t.metaKey||t.ctrlKey)&&f.startselected?(f.$element.removeClass("ui-selecting"),f.selecting=!1,f.$element.addClass("ui-selected"),f.selected=!0):(f.$element.removeClass("ui-selecting"),f.selecting=!1,f.startselected&&(f.$element.addClass("ui-unselecting"),f.unselecting=!0),n._trigger("unselecting",t,{unselecting:f.element}))),f.selected&&!t.metaKey&&!t.ctrlKey&&!f.startselected&&(f.$element.removeClass("ui-selected"),f.selected=!1,f.$element.addClass("ui-unselecting"),f.unselecting=!0,n._trigger("unselecting",t,{unselecting:f.element})))}),!1},_mouseStop:function(t){var n=this;this.dragged=!1;var r=this.options;return e(".ui-unselecting",this.element[0]).each(function(){var r=e.data(this,"selectable-item");r.$element.removeClass("ui-unselecting"),r.unselecting=!1,r.startselected=!1,n._trigger("unselected",t,{unselected:r.element})}),e(".ui-selecting",this.element[0]).each(function(){var r=e.data(this,"selectable-item");r.$element.removeClass("ui-selecting").addClass("ui-selected"),r.selecting=!1,r.selected=!0,r.startselected=!0,n._trigger("selected",t,{selected:r.element})}),this._trigger("stop",t),this.helper.remove(),!1}}),e.extend(e.ui.selectable,{version:"1.8.20"})}(jQuery),function(e,t){var n,r,i,s,o="ui-button ui-widget ui-state-default ui-corner-all",u="ui-state-hover ui-state-active ",a="ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only",f=function(){var t=e(this).find(":ui-button");setTimeout(function(){t.button("refresh")},1)},l=function(t){var n=t.name,r=t.form,i=e([]);return n&&(r?i=e(r).find("[name='"+n+"']"):i=e("[name='"+n+"']",t.ownerDocument).filter(function(){return!this.form})),i};e.widget("ui.button",{options:{disabled:null,text:!0,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset.button").bind("reset.button",f),typeof this.options.disabled!="boolean"?this.options.disabled=!!this.element.propAttr("disabled"):this.element.propAttr("disabled",this.options.disabled),this._determineButtonType(),this.hasTitle=!!this.buttonElement.attr("title");var t=this,u=this.options,a=this.type==="checkbox"||this.type==="radio",h="ui-state-hover"+(a?"":" ui-state-active"),p="ui-state-focus";u.label===null&&(u.label=this.buttonElement.html()),this.buttonElement.addClass(o).attr("role","button").bind("mouseenter.button",function(){if(u.disabled)return;e(this).addClass("ui-state-hover"),this===n&&e(this).addClass("ui-state-active")}).bind("mouseleave.button",function(){if(u.disabled)return;e(this).removeClass(h)}).bind("click.button",function(e){u.disabled&&(e.preventDefault(),e.stopImmediatePropagation())}),this.element.bind("focus.button",function(){t.buttonElement.addClass(p)}).bind("blur.button",function(){t.buttonElement.removeClass(p)}),a&&(this.element.bind("change.button",function(){if(s)return;t.refresh()}),this.buttonElement.bind("mousedown.button",function(e){if(u.disabled)return;s=!1,r=e.pageX,i=e.pageY}).bind("mouseup.button",function(e){if(u.disabled)return;if(r!==e.pageX||i!==e.pageY)s=!0})),this.type==="checkbox"?this.buttonElement.bind("click.button",function(){if(u.disabled||s)return!1;e(this).toggleClass("ui-state-active"),t.buttonElement.attr("aria-pressed",t.element[0].checked)}):this.type==="radio"?this.buttonElement.bind("click.button",function(){if(u.disabled||s)return!1;e(this).addClass("ui-state-active"),t.buttonElement.attr("aria-pressed","true");var n=t.element[0];l(n).not(n).map(function(){return e(this).button("widget")[0]}).removeClass("ui-state-active").attr("aria-pressed","false")}):(this.buttonElement.bind("mousedown.button",function(){if(u.disabled)return!1;e(this).addClass("ui-state-active"),n=this,e(document).one("mouseup",function(){n=null})}).bind("mouseup.button",function(){if(u.disabled)return!1;e(this).removeClass("ui-state-active")}).bind("keydown.button",function(t){if(u.disabled)return!1;(t.keyCode==e.ui.keyCode.SPACE||t.keyCode==e.ui.keyCode.ENTER)&&e(this).addClass("ui-state-active")}).bind("keyup.button",function(){e(this).removeClass("ui-state-active")}),this.buttonElement.is("a")&&this.buttonElement.keyup(function(t){t.keyCode===e.ui.keyCode.SPACE&&e(this).click()})),this._setOption("disabled",u.disabled),this._resetButton()},_determineButtonType:function(){this.element.is(":checkbox")?this.type="checkbox":this.element.is(":radio")?this.type="radio":this.element.is("input")?this.type="input":this.type="button";if(this.type==="checkbox"||this.type==="radio"){var e=this.element.parents().filter(":last"),t="label[for='"+this.element.attr("id")+"']";this.buttonElement=e.find(t),this.buttonElement.length||(e=e.length?e.siblings():this.element.siblings(),this.buttonElement=e.filter(t),this.buttonElement.length||(this.buttonElement=e.find(t))),this.element.addClass("ui-helper-hidden-accessible");var n=this.element.is(":checked");n&&this.buttonElement.addClass("ui-state-active"),this.buttonElement.attr("aria-pressed",n)}else this.buttonElement=this.element},widget:function(){return this.buttonElement},destroy:function(){this.element.removeClass("ui-helper-hidden-accessible"),this.buttonElement.removeClass(o+" "+u+" "+a).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html()),this.hasTitle||this.buttonElement.removeAttr("title"),e.Widget.prototype.destroy.call(this)},_setOption:function(t,n){e.Widget.prototype._setOption.apply(this,arguments);if(t==="disabled"){n?this.element.propAttr("disabled",!0):this.element.propAttr("disabled",!1);return}this._resetButton()},refresh:function(){var t=this.element.is(":disabled");t!==this.options.disabled&&this._setOption("disabled",t),this.type==="radio"?l(this.element[0]).each(function(){e(this).is(":checked")?e(this).button("widget").addClass("ui-state-active").attr("aria-pressed","true"):e(this).button("widget").removeClass("ui-state-active").attr("aria-pressed","false")}):this.type==="checkbox"&&(this.element.is(":checked")?this.buttonElement.addClass("ui-state-active").attr("aria-pressed","true"):this.buttonElement.removeClass("ui-state-active").attr("aria-pressed","false"))},_resetButton:function(){if(this.type==="input"){this.options.label&&this.element.val(this.options.label);return}var t=this.buttonElement.removeClass(a),n=e("<span></span>",this.element[0].ownerDocument).addClass("ui-button-text").html(this.options.label).appendTo(t.empty()).text(),r=this.options.icons,i=r.primary&&r.secondary,s=[];r.primary||r.secondary?(this.options.text&&s.push("ui-button-text-icon"+(i?"s":r.primary?"-primary":"-secondary")),r.primary&&t.prepend("<span class='ui-button-icon-primary ui-icon "+r.primary+"'></span>"),r.secondary&&t.append("<span class='ui-button-icon-secondary ui-icon "+r.secondary+"'></span>"),this.options.text||(s.push(i?"ui-button-icons-only":"ui-button-icon-only"),this.hasTitle||t.attr("title",n))):s.push("ui-button-text-only"),t.addClass(s.join(" "))}}),e.widget("ui.buttonset",{options:{items:":button, :submit, :reset, :checkbox, :radio, a, :data(button)"},_create:function(){this.element.addClass("ui-buttonset")},_init:function(){this.refresh()},_setOption:function(t,n){t==="disabled"&&this.buttons.button("option",t,n),e.Widget.prototype._setOption.apply(this,arguments)},refresh:function(){var t=this.element.css("direction")==="rtl";this.buttons=this.element.find(this.options.items).filter(":ui-button").button("refresh").end().not(":ui-button").button().end().map(function(){return e(this).button("widget")[0]}).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(t?"ui-corner-right":"ui-corner-left").end().filter(":last").addClass(t?"ui-corner-left":"ui-corner-right").end().end()},destroy:function(){this.element.removeClass("ui-buttonset"),this.buttons.map(function(){return e(this).button("widget")[0]}).removeClass("ui-corner-left ui-corner-right").end().button("destroy"),e.Widget.prototype.destroy.call(this)}})}(jQuery),function(e,t){var n="ui-dialog ui-widget ui-widget-content ui-corner-all ",r={buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},i={maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0},s=e.attrFn||{val:!0,css:!0,html:!0,text:!0,data:!0,width:!0,height:!0,offset:!0,click:!0};e.widget("ui.dialog",{options:{autoOpen:!0,buttons:{},closeOnEscape:!0,closeText:"close",dialogClass:"",draggable:!0,hide:null,height:"auto",maxHeight:!1,maxWidth:!1,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",collision:"fit",using:function(t){var n=e(this).css(t).offset().top;n<0&&e(this).css("top",t.top-n)}},resizable:!0,show:null,stack:!0,title:"",width:300,zIndex:1e3},_create:function(){this.originalTitle=this.element.attr("title"),typeof this.originalTitle!="string"&&(this.originalTitle=""),this.options.title=this.options.title||this.originalTitle;var t=this,r=t.options,i=r.title||"&#160;",s=e.ui.dialog.getTitleId(t.element),o=(t.uiDialog=e("<div></div>")).appendTo(document.body).hide().addClass(n+r.dialogClass).css({zIndex:r.zIndex}).attr("tabIndex",-1).css("outline",0).keydown(function(n){r.closeOnEscape&&!n.isDefaultPrevented()&&n.keyCode&&n.keyCode===e.ui.keyCode.ESCAPE&&(t.close(n),n.preventDefault())}).attr({role:"dialog","aria-labelledby":s}).mousedown(function(e){t.moveToTop(!1,e)}),u=t.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(o),f=(t.uiDialogTitlebar=e("<div></div>")).addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(o),l=e('<a href="#"></a>').addClass("ui-dialog-titlebar-close ui-corner-all").attr("role","button").hover(function(){l.addClass("ui-state-hover")},function(){l.removeClass("ui-state-hover")}).focus(function(){l.addClass("ui-state-focus")}).blur(function(){l.removeClass("ui-state-focus")}).click(function(e){return t.close(e),!1}).appendTo(f),h=(t.uiDialogTitlebarCloseText=e("<span></span>")).addClass("ui-icon ui-icon-closethick").text(r.closeText).appendTo(l),p=e("<span></span>").addClass("ui-dialog-title").attr("id",s).html(i).prependTo(f);e.isFunction(r.beforeclose)&&!e.isFunction(r.beforeClose)&&(r.beforeClose=r.beforeclose),f.find("*").add(f).disableSelection(),r.draggable&&e.fn.draggable&&t._makeDraggable(),r.resizable&&e.fn.resizable&&t._makeResizable(),t._createButtons(r.buttons),t._isOpen=!1,e.fn.bgiframe&&o.bgiframe()},_init:function(){this.options.autoOpen&&this.open()},destroy:function(){var e=this;return e.overlay&&e.overlay.destroy(),e.uiDialog.hide(),e.element.unbind(".dialog").removeData("dialog").removeClass("ui-dialog-content ui-widget-content").hide().appendTo("body"),e.uiDialog.remove(),e.originalTitle&&e.element.attr("title",e.originalTitle),e},widget:function(){return this.uiDialog},close:function(t){var n=this,r,i;if(!1===n._trigger("beforeClose",t))return;return n.overlay&&n.overlay.destroy(),n.uiDialog.unbind("keypress.ui-dialog"),n._isOpen=!1,n.options.hide?n.uiDialog.hide(n.options.hide,function(){n._trigger("close",t)}):(n.uiDialog.hide(),n._trigger("close",t)),e.ui.dialog.overlay.resize(),n.options.modal&&(r=0,e(".ui-dialog").each(function(){this!==n.uiDialog[0]&&(i=e(this).css("z-index"),isNaN(i)||(r=Math.max(r,i)))}),e.ui.dialog.maxZ=r),n},isOpen:function(){return this._isOpen},moveToTop:function(t,n){var r=this,i=r.options,s;return i.modal&&!t||!i.stack&&!i.modal?r._trigger("focus",n):(i.zIndex>e.ui.dialog.maxZ&&(e.ui.dialog.maxZ=i.zIndex),r.overlay&&(e.ui.dialog.maxZ+=1,r.overlay.$el.css("z-index",e.ui.dialog.overlay.maxZ=e.ui.dialog.maxZ)),s={scrollTop:r.element.scrollTop(),scrollLeft:r.element.scrollLeft()},e.ui.dialog.maxZ+=1,r.uiDialog.css("z-index",e.ui.dialog.maxZ),r.element.attr(s),r._trigger("focus",n),r)},open:function(){if(this._isOpen)return;var t=this,n=t.options,r=t.uiDialog;return t.overlay=n.modal?new e.ui.dialog.overlay(t):null,t._size(),t._position(n.position),r.show(n.show),t.moveToTop(!0),n.modal&&r.bind("keydown.ui-dialog",function(t){if(t.keyCode!==e.ui.keyCode.TAB)return;var n=e(":tabbable",this),r=n.filter(":first"),i=n.filter(":last");if(t.target===i[0]&&!t.shiftKey)return r.focus(1),!1;if(t.target===r[0]&&t.shiftKey)return i.focus(1),!1}),e(t.element.find(":tabbable").get().concat(r.find(".ui-dialog-buttonpane :tabbable").get().concat(r.get()))).eq(0).focus(),t._isOpen=!0,t._trigger("open"),t},_createButtons:function(t){var n=this,r=!1,i=e("<div></div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),o=e("<div></div>").addClass("ui-dialog-buttonset").appendTo(i);n.uiDialog.find(".ui-dialog-buttonpane").remove(),typeof t=="object"&&t!==null&&e.each(t,function(){return!(r=!0)}),r&&(e.each(t,function(t,r){r=e.isFunction(r)?{click:r,text:t}:r;var i=e('<button type="button"></button>').click(function(){r.click.apply(n.element[0],arguments)}).appendTo(o);e.each(r,function(e,t){if(e==="click")return;e in s?i[e](t):i.attr(e,t)}),e.fn.button&&i.button()}),i.appendTo(n.uiDialog))},_makeDraggable:function(){function t(e){return{position:e.position,offset:e.offset}}var n=this,r=n.options,i=e(document),s;n.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(i,o){s=r.height==="auto"?"auto":e(this).height(),e(this).height(e(this).height()).addClass("ui-dialog-dragging"),n._trigger("dragStart",i,t(o))},drag:function(e,r){n._trigger("drag",e,t(r))},stop:function(o,u){r.position=[u.position.left-i.scrollLeft(),u.position.top-i.scrollTop()],e(this).removeClass("ui-dialog-dragging").height(s),n._trigger("dragStop",o,t(u)),e.ui.dialog.overlay.resize()}})},_makeResizable:function(n){function r(e){return{originalPosition:e.originalPosition,originalSize:e.originalSize,position:e.position,size:e.size}}n=n===t?this.options.resizable:n;var i=this,s=i.options,o=i.uiDialog.css("position"),u=typeof n=="string"?n:"n,e,s,w,se,sw,ne,nw";i.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:i.element,maxWidth:s.maxWidth,maxHeight:s.maxHeight,minWidth:s.minWidth,minHeight:i._minHeight(),handles:u,start:function(t,n){e(this).addClass("ui-dialog-resizing"),i._trigger("resizeStart",t,r(n))},resize:function(e,t){i._trigger("resize",e,r(t))},stop:function(t,n){e(this).removeClass("ui-dialog-resizing"),s.height=e(this).height(),s.width=e(this).width(),i._trigger("resizeStop",t,r(n)),e.ui.dialog.overlay.resize()}}).css("position",o).find(".ui-resizable-se").addClass("ui-icon ui-icon-grip-diagonal-se")},_minHeight:function(){var e=this.options;return e.height==="auto"?e.minHeight:Math.min(e.minHeight,e.height)},_position:function(t){var n=[],r=[0,0],i;if(t){if(typeof t=="string"||typeof t=="object"&&"0"in t)n=t.split?t.split(" "):[t[0],t[1]],n.length===1&&(n[1]=n[0]),e.each(["left","top"],function(e,t){+n[e]===n[e]&&(r[e]=n[e],n[e]=t)}),t={my:n.join(" "),at:n.join(" "),offset:r.join(" ")};t=e.extend({},e.ui.dialog.prototype.options.position,t)}else t=e.ui.dialog.prototype.options.position;i=this.uiDialog.is(":visible"),i||this.uiDialog.show(),this.uiDialog.css({top:0,left:0}).position(e.extend({of:window},t)),i||this.uiDialog.hide()},_setOptions:function(t){var n=this,s={},o=!1;e.each(t,function(e,t){n._setOption(e,t),e in r&&(o=!0),e in i&&(s[e]=t)}),o&&this._size(),this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option",s)},_setOption:function(t,r){var i=this,s=i.uiDialog;switch(t){case"beforeclose":t="beforeClose";break;case"buttons":i._createButtons(r);break;case"closeText":i.uiDialogTitlebarCloseText.text(""+r);break;case"dialogClass":s.removeClass(i.options.dialogClass).addClass(n+r);break;case"disabled":r?s.addClass("ui-dialog-disabled"):s.removeClass("ui-dialog-disabled");break;case"draggable":var o=s.is(":data(draggable)");o&&!r&&s.draggable("destroy"),!o&&r&&i._makeDraggable();break;case"position":i._position(r);break;case"resizable":var u=s.is(":data(resizable)");u&&!r&&s.resizable("destroy"),u&&typeof r=="string"&&s.resizable("option","handles",r),!u&&r!==!1&&i._makeResizable(r);break;case"title":e(".ui-dialog-title",i.uiDialogTitlebar).html(""+(r||"&#160;"))}e.Widget.prototype._setOption.apply(i,arguments)},_size:function(){var t=this.options,n,r,i=this.uiDialog.is(":visible");this.element.show().css({width:"auto",minHeight:0,height:0}),t.minWidth>t.width&&(t.width=t.minWidth),n=this.uiDialog.css({height:"auto",width:t.width}).height(),r=Math.max(0,t.minHeight-n);if(t.height==="auto")if(e.support.minHeight)this.element.css({minHeight:r,height:"auto"});else{this.uiDialog.show();var s=this.element.css("height","auto").height();i||this.uiDialog.hide(),this.element.height(Math.max(s,r))}else this.element.height(Math.max(t.height-n,0));this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())}}),e.extend(e.ui.dialog,{version:"1.8.20",uuid:0,maxZ:0,getTitleId:function(e){var t=e.attr("id");return t||(this.uuid+=1,t=this.uuid),"ui-dialog-title-"+t},overlay:function(t){this.$el=e.ui.dialog.overlay.create(t)}}),e.extend(e.ui.dialog.overlay,{instances:[],oldInstances:[],maxZ:0,events:e.map("focus,mousedown,mouseup,keydown,keypress,click".split(","),function(e){return e+".dialog-overlay"}).join(" "),create:function(t){this.instances.length===0&&(setTimeout(function(){e.ui.dialog.overlay.instances.length&&e(document).bind(e.ui.dialog.overlay.events,function(t){if(e(t.target).zIndex()<e.ui.dialog.overlay.maxZ)return!1})},1),e(document).bind("keydown.dialog-overlay",function(n){t.options.closeOnEscape&&!n.isDefaultPrevented()&&n.keyCode&&n.keyCode===e.ui.keyCode.ESCAPE&&(t.close(n),n.preventDefault())}),e(window).bind("resize.dialog-overlay",e.ui.dialog.overlay.resize));var n=(this.oldInstances.pop()||e("<div></div>").addClass("ui-widget-overlay")).appendTo(document.body).css({width:this.width(),height:this.height()});return e.fn.bgiframe&&n.bgiframe(),this.instances.push(n),n},destroy:function(t){var n=e.inArray(t,this.instances);n!=-1&&this.oldInstances.push(this.instances.splice(n,1)[0]),this.instances.length===0&&e([document,window]).unbind(".dialog-overlay"),t.remove();var r=0;e.each(this.instances,function(){r=Math.max(r,this.css("z-index"))}),this.maxZ=r},height:function(){var t,n;return e.browser.msie&&e.browser.version<7?(t=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight),n=Math.max(document.documentElement.offsetHeight,document.body.offsetHeight),t<n?e(window).height()+"px":t+"px"):e(document).height()+"px"},width:function(){var t,n;return e.browser.msie?(t=Math.max(document.documentElement.scrollWidth,document.body.scrollWidth),n=Math.max(document.documentElement.offsetWidth,document.body.offsetWidth),t<n?e(window).width()+"px":t+"px"):e(document).width()+"px"},resize:function(){var t=e([]);e.each(e.ui.dialog.overlay.instances,function(){t=t.add(this)}),t.css({width:0,height:0}).css({width:e.ui.dialog.overlay.width(),height:e.ui.dialog.overlay.height()})}}),e.extend(e.ui.dialog.overlay.prototype,{destroy:function(){e.ui.dialog.overlay.destroy(this.$el)}})}(jQuery),jQuery.effects||function(e,t){function n(t){var n;return t&&t.constructor==Array&&t.length==3?t:(n=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(t))?[parseInt(n[1],10),parseInt(n[2],10),parseInt(n[3],10)]:(n=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(t))?[parseFloat(n[1])*2.55,parseFloat(n[2])*2.55,parseFloat(n[3])*2.55]:(n=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(t))?[parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16)]:(n=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(t))?[parseInt(n[1]+n[1],16),parseInt(n[2]+n[2],16),parseInt(n[3]+n[3],16)]:(n=/rgba\(0, 0, 0, 0\)/.exec(t))?f.transparent:f[e.trim(t).toLowerCase()]}function r(t,r){var i;do{i=e.curCSS(t,r);if(i!=""&&i!="transparent"||e.nodeName(t,"body"))break;r="backgroundColor"}while(t=t.parentNode);return n(i)}function i(){var e=document.defaultView?document.defaultView.getComputedStyle(this,null):this.currentStyle,t={},n,r;if(e&&e.length&&e[0]&&e[e[0]]){var i=e.length;while(i--)n=e[i],typeof e[n]=="string"&&(r=n.replace(/\-(\w)/g,function(e,t){return t.toUpperCase()}),t[r]=e[n])}else for(n in e)typeof e[n]=="string"&&(t[n]=e[n]);return t}function s(t){var n,r;for(n in t)r=t[n],(r==null||e.isFunction(r)||n in c||/scrollbar/.test(n)||!/color/i.test(n)&&isNaN(parseFloat(r)))&&delete t[n];return t}function o(e,t){var n={_:0},r;for(r in t)e[r]!=t[r]&&(n[r]=t[r]);return n}function u(t,n,r,i){typeof t=="object"&&(i=n,r=null,n=t,t=n.effect),e.isFunction(n)&&(i=n,r=null,n={});if(typeof n=="number"||e.fx.speeds[n])i=r,r=n,n={};return e.isFunction(r)&&(i=r,r=null),n=n||{},r=r||n.duration,r=e.fx.off?0:typeof r=="number"?r:r in e.fx.speeds?e.fx.speeds[r]:e.fx.speeds._default,i=i||n.complete,[t,n,r,i]}function a(t){return!t||typeof t=="number"||e.fx.speeds[t]?!0:typeof t=="string"&&!e.effects[t]?!0:!1}e.effects={},e.each(["backgroundColor","borderBottomColor","borderLeftColor","borderRightColor","borderTopColor","borderColor","color","outlineColor"],function(t,i){e.fx.step[i]=function(e){e.colorInit||(e.start=r(e.elem,i),e.end=n(e.end),e.colorInit=!0),e.elem.style[i]="rgb("+Math.max(Math.min(parseInt(e.pos*(e.end[0]-e.start[0])+e.start[0],10),255),0)+","+Math.max(Math.min(parseInt(e.pos*(e.end[1]-e.start[1])+e.start[1],10),255),0)+","+Math.max(Math.min(parseInt(e.pos*(e.end[2]-e.start[2])+e.start[2],10),255),0)+")"}});var f={aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkviolet:[148,0,211],fuchsia:[255,0,255],gold:[255,215,0],green:[0,128,0],indigo:[75,0,130],khaki:[240,230,140],lightblue:[173,216,230],lightcyan:[224,255,255],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightyellow:[255,255,224],lime:[0,255,0],magenta:[255,0,255],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],pink:[255,192,203],purple:[128,0,128],violet:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0],transparent:[255,255,255]},l=["add","remove","toggle"],c={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};e.effects.animateClass=function(t,n,r,u){return e.isFunction(r)&&(u=r,r=null),this.queue(function(){var a=e(this),f=a.attr("style")||" ",c=s(i.call(this)),p,v=a.attr("class")||"";e.each(l,function(e,n){t[n]&&a[n+"Class"](t[n])}),p=s(i.call(this)),a.attr("class",v),a.animate(o(c,p),{queue:!1,duration:n,easing:r,complete:function(){e.each(l,function(e,n){t[n]&&a[n+"Class"](t[n])}),typeof a.attr("style")=="object"?(a.attr("style").cssText="",a.attr("style").cssText=f):a.attr("style",f),u&&u.apply(this,arguments),e.dequeue(this)}})})},e.fn.extend({_addClass:e.fn.addClass,addClass:function(t,n,r,i){return n?e.effects.animateClass.apply(this,[{add:t},n,r,i]):this._addClass(t)},_removeClass:e.fn.removeClass,removeClass:function(t,n,r,i){return n?e.effects.animateClass.apply(this,[{remove:t},n,r,i]):this._removeClass(t)},_toggleClass:e.fn.toggleClass,toggleClass:function(n,r,i,s,o){return typeof r=="boolean"||r===t?i?e.effects.animateClass.apply(this,[r?{add:n}:{remove:n},i,s,o]):this._toggleClass(n,r):e.effects.animateClass.apply(this,[{toggle:n},r,i,s])},switchClass:function(t,n,r,i,s){return e.effects.animateClass.apply(this,[{add:n,remove:t},r,i,s])}}),e.extend(e.effects,{version:"1.8.20",save:function(e,t){for(var n=0;n<t.length;n++)t[n]!==null&&e.data("ec.storage."+t[n],e[0].style[t[n]])},restore:function(e,t){for(var n=0;n<t.length;n++)t[n]!==null&&e.css(t[n],e.data("ec.storage."+t[n]))},setMode:function(e,t){return t=="toggle"&&(t=e.is(":hidden")?"show":"hide"),t},getBaseline:function(e,t){var n,r;switch(e[0]){case"top":n=0;break;case"middle":n=.5;break;case"bottom":n=1;break;default:n=e[0]/t.height}switch(e[1]){case"left":r=0;break;case"center":r=.5;break;case"right":r=1;break;default:r=e[1]/t.width}return{x:r,y:n}},createWrapper:function(t){if(t.parent().is(".ui-effects-wrapper"))return t.parent();var n={width:t.outerWidth(!0),height:t.outerHeight(!0),"float":t.css("float")},r=e("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),i=document.activeElement;return t.wrap(r),(t[0]===i||e.contains(t[0],i))&&e(i).focus(),r=t.parent(),t.css("position")=="static"?(r.css({position:"relative"}),t.css({position:"relative"})):(e.extend(n,{position:t.css("position"),zIndex:t.css("z-index")}),e.each(["top","left","bottom","right"],function(e,r){n[r]=t.css(r),isNaN(parseInt(n[r],10))&&(n[r]="auto")}),t.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),r.css(n).show()},removeWrapper:function(t){var n,r=document.activeElement;return t.parent().is(".ui-effects-wrapper")?(n=t.parent().replaceWith(t),(t[0]===r||e.contains(t[0],r))&&e(r).focus(),n):t},setTransition:function(t,n,r,i){return i=i||{},e.each(n,function(e,n){var s=t.cssUnit(n);s[0]>0&&(i[n]=s[0]*r+s[1])}),i}}),e.fn.extend({effect:function(t,n,r,i){var s=u.apply(this,arguments),o={options:s[1],duration:s[2],callback:s[3]},a=o.options.mode,f=e.effects[t];return e.fx.off||!f?a?this[a](o.duration,o.callback):this.each(function(){o.callback&&o.callback.call(this)}):f.call(this,o)},_show:e.fn.show,show:function(e){if(a(e))return this._show.apply(this,arguments);var t=u.apply(this,arguments);return t[1].mode="show",this.effect.apply(this,t)},_hide:e.fn.hide,hide:function(e){if(a(e))return this._hide.apply(this,arguments);var t=u.apply(this,arguments);return t[1].mode="hide",this.effect.apply(this,t)},__toggle:e.fn.toggle,toggle:function(t){if(a(t)||typeof t=="boolean"||e.isFunction(t))return this.__toggle.apply(this,arguments);var n=u.apply(this,arguments);return n[1].mode="toggle",this.effect.apply(this,n)},cssUnit:function(t){var n=this.css(t),r=[];return e.each(["em","px","%","pt"],function(e,t){n.indexOf(t)>0&&(r=[parseFloat(n),t])}),r}}),e.easing.jswing=e.easing.swing,e.extend(e.easing,{def:"easeOutQuad",swing:function(t,n,r,i,s){return e.easing[e.easing.def](t,n,r,i,s)},easeInQuad:function(e,t,n,r,i){return r*(t/=i)*t+n},easeOutQuad:function(e,t,n,r,i){return-r*(t/=i)*(t-2)+n},easeInOutQuad:function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t+n:-r/2*(--t*(t-2)-1)+n},easeInCubic:function(e,t,n,r,i){return r*(t/=i)*t*t+n},easeOutCubic:function(e,t,n,r,i){return r*((t=t/i-1)*t*t+1)+n},easeInOutCubic:function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t*t+n:r/2*((t-=2)*t*t+2)+n},easeInQuart:function(e,t,n,r,i){return r*(t/=i)*t*t*t+n},easeOutQuart:function(e,t,n,r,i){return-r*((t=t/i-1)*t*t*t-1)+n},easeInOutQuart:function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t*t*t+n:-r/2*((t-=2)*t*t*t-2)+n},easeInQuint:function(e,t,n,r,i){return r*(t/=i)*t*t*t*t+n},easeOutQuint:function(e,t,n,r,i){return r*((t=t/i-1)*t*t*t*t+1)+n},easeInOutQuint:function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t*t*t*t+n:r/2*((t-=2)*t*t*t*t+2)+n},easeInSine:function(e,t,n,r,i){return-r*Math.cos(t/i*(Math.PI/2))+r+n},easeOutSine:function(e,t,n,r,i){return r*Math.sin(t/i*(Math.PI/2))+n},easeInOutSine:function(e,t,n,r,i){return-r/2*(Math.cos(Math.PI*t/i)-1)+n},easeInExpo:function(e,t,n,r,i){return t==0?n:r*Math.pow(2,10*(t/i-1))+n},easeOutExpo:function(e,t,n,r,i){return t==i?n+r:r*(-Math.pow(2,-10*t/i)+1)+n},easeInOutExpo:function(e,t,n,r,i){return t==0?n:t==i?n+r:(t/=i/2)<1?r/2*Math.pow(2,10*(t-1))+n:r/2*(-Math.pow(2,-10*--t)+2)+n},easeInCirc:function(e,t,n,r,i){return-r*(Math.sqrt(1-(t/=i)*t)-1)+n},easeOutCirc:function(e,t,n,r,i){return r*Math.sqrt(1-(t=t/i-1)*t)+n},easeInOutCirc:function(e,t,n,r,i){return(t/=i/2)<1?-r/2*(Math.sqrt(1-t*t)-1)+n:r/2*(Math.sqrt(1-(t-=2)*t)+1)+n},easeInElastic:function(e,t,n,r,i){var s=1.70158,o=0,u=r;if(t==0)return n;if((t/=i)==1)return n+r;o||(o=i*.3);if(u<Math.abs(r)){u=r;var s=o/4}else var s=o/(2*Math.PI)*Math.asin(r/u);return-(u*Math.pow(2,10*(t-=1))*Math.sin((t*i-s)*2*Math.PI/o))+n},easeOutElastic:function(e,t,n,r,i){var s=1.70158,o=0,u=r;if(t==0)return n;if((t/=i)==1)return n+r;o||(o=i*.3);if(u<Math.abs(r)){u=r;var s=o/4}else var s=o/(2*Math.PI)*Math.asin(r/u);return u*Math.pow(2,-10*t)*Math.sin((t*i-s)*2*Math.PI/o)+r+n},easeInOutElastic:function(e,t,n,r,i){var s=1.70158,o=0,u=r;if(t==0)return n;if((t/=i/2)==2)return n+r;o||(o=i*.3*1.5);if(u<Math.abs(r)){u=r;var s=o/4}else var s=o/(2*Math.PI)*Math.asin(r/u);return t<1?-0.5*u*Math.pow(2,10*(t-=1))*Math.sin((t*i-s)*2*Math.PI/o)+n:u*Math.pow(2,-10*(t-=1))*Math.sin((t*i-s)*2*Math.PI/o)*.5+r+n},easeInBack:function(e,n,r,i,s,o){return o==t&&(o=1.70158),i*(n/=s)*n*((o+1)*n-o)+r},easeOutBack:function(e,n,r,i,s,o){return o==t&&(o=1.70158),i*((n=n/s-1)*n*((o+1)*n+o)+1)+r},easeInOutBack:function(e,n,r,i,s,o){return o==t&&(o=1.70158),(n/=s/2)<1?i/2*n*n*(((o*=1.525)+1)*n-o)+r:i/2*((n-=2)*n*(((o*=1.525)+1)*n+o)+2)+r},easeInBounce:function(t,n,r,i,s){return i-e.easing.easeOutBounce(t,s-n,0,i,s)+r},easeOutBounce:function(e,t,n,r,i){return(t/=i)<1/2.75?r*7.5625*t*t+n:t<2/2.75?r*(7.5625*(t-=1.5/2.75)*t+.75)+n:t<2.5/2.75?r*(7.5625*(t-=2.25/2.75)*t+.9375)+n:r*(7.5625*(t-=2.625/2.75)*t+.984375)+n},easeInOutBounce:function(t,n,r,i,s){return n<s/2?e.easing.easeInBounce(t,n*2,0,i,s)*.5+r:e.easing.easeOutBounce(t,n*2-s,0,i,s)*.5+i*.5+r}})}(jQuery),function(e,t){e.effects.fade=function(t){return this.queue(function(){var n=e(this),r=e.effects.setMode(n,t.options.mode||"hide");n.animate({opacity:r},{queue:!1,duration:t.duration,easing:t.options.easing,complete:function(){t.callback&&t.callback.apply(this,arguments),n.dequeue()}})})}}(jQuery)}),"use strict",define("module/hash",["lib/jquery/ba-hashchange","common/core/common"],function(){return window.hash=function(){function n(){$(window).hashchange(function(n){var r,i;n.originalEvent&&n.originalEvent.oldURL&&n.originalEvent.newURL?(r=e.getHash(n.originalEvent.oldURL),i=e.getHash(n.originalEvent.newURL)):(r=e.getHash(t),i=e.getHash(window.location.hash)),r.viewType!==i.viewType&&e.trigger("viewChange",i.viewType),r.fileId!==i.fileId&&e.trigger("dirChange",i.fileId),r.moduleName!==i.moduleName&&e.trigger("moduleChange",i.moduleName),t=window.location.hash})}function r(e){window.location.hash=e}function i(e){var t=/#(kp|sh)\|([0-9]+)\|(0|1)$/.exec(e);return t?{moduleName:t[1],fileId:t[2],viewType:t[3]}:{moduleName:"kp",fileId:"0",viewType:"0"}}var e={},t=window.location.hash;return $.extend(e,Event),e.changView=function(e){var t=window.location.hash,n,i;"list"===e?e="0":e="1",""===t||t==="#"?n="0":n=t.split("|")[1],i="#kp|"+n+"|"+e,r(i)},e.updateHash=function(t,n){var r="#kp|"+t,i=window.location.hash,s;i!==""&&(s=i.split("|")[2]),undefined!==n?("icon"===n&&(r+="|1"),"list"===n&&(r+="|0")):undefined!==s?r=r+"|"+s:r+="|0",t==="#"&&(r="#"),window.location.hash===r&&e.trigger("refreshDir",t),window.location.hash=r},e.getHash=function(e){var t=window.location.hash;return i(e||t)},n(),e}(),hash}),"use strict",define("module/fileview/navlink",["common/core/core"],function(){KP.Core.register("fileview-navlink",function(e){var t=$("#aside > .nav"),n=t.find(".all-file"),r=t.find(".share"),i=t.find(".link"),s=t.find(".link"),o=t.find(".recyclebin"),u=function(){t.find(".selected").removeClass("selected")};return{init:function(){e.listen("location-hash-isfilemanage",this.controlActive,this),e.listen("location-hash-islink",this.controlActive,this),e.listen("location-hash-isshare",this.controlActive,this),e.listen("location-hash-shareout",this.controlActive,this),e.listen("location-hash-isrecycle",this.controlActive,this)},destroy:function(){},controlActive:function(e){u();var t=e.split("|");switch(t[0]){case"#kp":n.addClass("selected");break;case"#out":i.addClass("selected");break;case"#li":s.addClass("selected");break;case"#sh":s.addClass("selected");break;case"#rc":o.addClass("selected");break;default:n.addClass("selected")}}}})});var ZeroClipboard={version:"1.0.6",clients:{},moviePath:"zeroclipboard.swf",nextId:1,_:function(e){return typeof e=="string"&&(e=document.getElementById(e)),e.addClass||(e.hide=function(){this.style.display="none"},e.show=function(){this.style.display=""},e.addClass=function(e){this.removeClass(e),this.className+=" "+e},e.removeClass=function(e){var t=this.className.split(/\s+/),n=-1;for(var r=0;r<t.length;r++)t[r]==e&&(n=r,r=t.length);return n>-1&&(t.splice(n,1),this.className=t.join(" ")),this},e.hasClass=function(e){return!!this.className.match(new RegExp("\\s*"+e+"\\s*"))}),e},setMoviePath:function(e){this.moviePath=e},dispatch:function(e,t,n){var r=this.clients[e];r&&r.receiveEvent(t,n)},register:function(e,t){this.clients[e]=t},getDOMObjectPosition:function(e,t){var n={left:0,top:0,width:e.width?e.width:e.offsetWidth,height:e.height?e.height:e.offsetHeight};while(e&&e!=t)n.left+=e.offsetLeft,n.top+=e.offsetTop,e=e.offsetParent;return n},Client:function(e){this.handlers={},this.id=ZeroClipboard.nextId++,this.movieId="ZeroClipboardMovie_"+this.id,ZeroClipboard.register(this.id,this),e&&this.glue(e)}};ZeroClipboard.Client.prototype={id:0,ready:!1,movie:null,clipText:"",handCursorEnabled:!0,cssEffects:!0,handlers:null,glue:function(e,t,n){this.domElement=ZeroClipboard._(e);var r=999;this.domElement.style.zIndex&&(r=parseInt(this.domElement.style.zIndex,10)+1),typeof t=="string"?t=ZeroClipboard._(t):typeof t=="undefined"&&(t=document.getElementsByTagName("body")[0]);var i=ZeroClipboard.getDOMObjectPosition(this.domElement,t);this.div=document.createElement("div");var s=this.div.style;s.position="absolute",s.left=""+i.left+"px",s.top=""+i.top+"px",s.width=""+i.width+"px",s.height=""+i.height+"px",s.zIndex=r;if(typeof n=="object")for(addedStyle in n)s[addedStyle]=n[addedStyle];t.appendChild(this.div),this.div.innerHTML=this.getHTML(i.width,i.height)},getHTML:function(e,t){var n="",r="id="+this.id+"&width="+e+"&height="+t;if(navigator.userAgent.match(/MSIE/)){var i=location.href.match(/^https/i)?"https://":"http://";n+='<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="'+i+'download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" width="'+e+'" height="'+t+'" id="'+this.movieId+'" align="middle"><param name="allowScriptAccess" value="always" /><param name="allowFullScreen" value="false" /><param name="movie" value="'+ZeroClipboard.moviePath+'" /><param name="loop" value="false" /><param name="menu" value="false" /><param name="quality" value="best" /><param name="bgcolor" value="#ffffff" /><param name="flashvars" value="'+r+'"/><param name="wmode" value="transparent"/></object>'}else n+='<embed id="'+this.movieId+'" src="'+ZeroClipboard.moviePath+'" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="'+e+'" height="'+t+'" name="'+this.movieId+'" align="middle" allowScriptAccess="always" allowFullScreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="'+r+'" wmode="transparent" />';return n},hide:function(){this.div&&(this.div.style.left="-2000px")},show:function(){this.reposition()},destroy:function(){if(this.domElement&&this.div){this.hide(),this.div.innerHTML="";var e=document.getElementsByTagName("body")[0];try{e.removeChild(this.div)}catch(t){}this.domElement=null,this.div=null}},reposition:function(e){e&&(this.domElement=ZeroClipboard._(e),this.domElement||this.hide());if(this.domElement&&this.div){var t=ZeroClipboard.getDOMObjectPosition(this.domElement),n=this.div.style;n.left=""+t.left+"px",n.top=""+t.top+"px"}},setText:function(e){this.clipText=e,this.ready&&this.movie.setText(e)},addEventListener:function(e,t){e=e.toString().toLowerCase().replace(/^on/,""),this.handlers[e]||(this.handlers[e]=[]),this.handlers[e].push(t)},setHandCursor:function(e){this.handCursorEnabled=e,this.ready&&this.movie.setHandCursor(e)},setCSSEffects:function(e){this.cssEffects=!!e},receiveEvent:function(e,t){e=e.toString().toLowerCase().replace(/^on/,"");switch(e){case"load":this.movie=document.getElementById(this.movieId);if(!this.movie){var n=this;setTimeout(function(){n.receiveEvent("load",null)},1);return}if(!this.ready&&navigator.userAgent.match(/Firefox/)&&navigator.userAgent.match(/Windows/)){var n=this;setTimeout(function(){n.receiveEvent("load",null)},100),this.ready=!0;return}this.ready=!0,this.movie.setText(this.clipText),this.movie.setHandCursor(this.handCursorEnabled);break;case"mouseover":this.domElement&&this.cssEffects&&(this.domElement.addClass("hover"),this.recoverActive&&this.domElement.addClass("active"));break;case"mouseout":this.domElement&&this.cssEffects&&(this.recoverActive=!1,this.domElement.hasClass("active")&&(this.domElement.removeClass("active"),this.recoverActive=!0),this.domElement.removeClass("hover"));break;case"mousedown":this.domElement&&this.cssEffects&&this.domElement.addClass("active");break;case"mouseup":this.domElement&&this.cssEffects&&(this.domElement.removeClass("active"),this.recoverActive=!1)}if(this.handlers[e])for(var r=0,i=this.handlers[e].length;r<i;r++){var s=this.handlers[e][r];typeof s=="function"?s(this,t):typeof s=="object"&&s.length==2?s[0][s[1]](this,t):typeof s=="string"&&window[s](this,t)}}},define("extends/zeroclipboard/zeroclipboard",function(){}),"use strict",define("module/operate_message",["jquery"],function(){window.operateMessage=function(){function i(){r&&clearTimeout(r),e.hide().removeClass("operate-successful-message operate-failed-message operate-loading-message")}function s(){var t=document.documentElement.clientWidth,n=e.width();return(t-n)/2}var e=$("#operate-message"),t={},n={success:"operate-successful-message",fail:"operate-failed-message",loading:"operate-loading-message"},r;return t.show=function(t){var o,u;u=t.time=t.time||2e3,e.css("display")!=="none"&&i(),e.html(t.content).addClass(n[t.type]),o=s(),e.css({left:o}).show(),-1!==u&&(r=setTimeout(function(){e.fadeOut("slow",function(){i()})},u))},t}()}),"use strict",define("module/search",["jquery","common/core/common"],function(){window.search=function(){function s(e){n.attr("hasFocus",!0),l()||n.val("")}function o(e){n.removeAttr("hasFocus"),l()||h()}function u(e){if(13===e.keyCode)return f(),!1;a.hide()}function f(e){if(!l())return n.focus(),!1;CA.q("search-post"),window.location.hash="#se|"+encodeURIComponent(n.val())}function d(){n.on({focusin:s,focusout:o,keydown:u}),t.on("mouseleave",p),r.on("click",f),r.on("mouseenter",c)}var e=$.extend({},Event),t=$("#search"),n=t.children("input"),r=t.children(".search-submit"),i=t.children(".placeholder"),a={hide:function(){i.addClass("noDis")},show:function(){i.removeClass("noDis")}},l=function(){return n.val()?!0:!1},c=function(){n.removeClass("noVis"),l()||a.show()},h=function(){n.addClass("noVis"),a.hide()},p=function(){!l()&&!n.attr("hasFocus")&&h()};return d(),e}()});var viewOnline=function(){function t(e){var t=[],n=CONST.Token,r=Util.getFileExt(e.name);return t.push(Const.CONV_SERVER),t.push("/getmedia?f="),t.push(e.fileId),t.push("&v="),t.push(e.fileVer),t.push("&token="),t.push(n),e.isimage?t.push(""):t.push("&copts=dt:"+r+",v:normal"),t.join("")}var e={};return e.show=function(e){var n=t(e);window.open(n)},e}();define("module/view_online",function(){});var editOnline=function(){function t(e){var t=[],n=CONST.Token;return t.push(Const.WOW_SERVER),t.push("?host=www.kuaipan.cn"),t.push("&token="),t.push(n),t.push("&fileid="),t.push(e.fileId),t.join("")}var e={};return e.show=function(e){var n=t(e);window.open(n)},e}();define("module/edit_online",function(){}),"use strict",define("module/select_contact_to_share",["jquery"],function(){window.selectUserAndShare=function(){function h(){t.delegate(".share-member-group li","click",g),t.delegate(".share-selected-contact li","click",y),t.delegate("#share-select-add","click",w),t.delegate("#share-select-delete","click",E)}function p(){var e="http://www.kuaipan.cn/addressbook_getcontact.htm";$.getJSON(e,function(e){var n,r;"ok"===e.status&&(n=e.result.groups,n.push({contacts:e.result.contacts,gcreator:0,gdesc:"",gid:0,gname:"未分组"}),r=v(n),t.find(".share-contact-list").html(r),$(".share-contact-group-title").toggle(T,x),d())})}function d(){var e="http://www.kuaipan.cn/share_getsharerbyfileid.htm";$.post(e,{fileId:Util.getFileObj(n).fileId},function(e){if("ok"===e.status||i==="SHARED_TO_ME_PANEL")c=e.result.file.sharer,m(l)},"json")}function v(e){var t=0,n,r=e.length,i=[],s;l=[];for(;t<r;t++){i.push('<h3 class="share-contact-group-title fold" title="'+e[t].gname+'">'+Util.formateSubStr(e[t].gname,28,0)+"</h3>"),i.push('<ul class="share-member-group share-member-list" style="display: none;">'),n=0;for(;n<e[t].contacts.length;n++)l.push(e[t].contacts[n]),s=e[t].contacts[n].contactNickName+"("+e[t].contacts[n].contactUserName+")",i.push('<li data-index="'+(l.length-1)+'" title="'+s+'"><p>'+Util.formateSubStr(e[t].contacts[n].contactUserName,25,0));i.push("</ul>")}return i.join("")}function m(e){var n=0,r,i;u=[],a=[];for(;n<c.length;n++){r=0;for(;r<e.length;r++)if(c[n].email===e[r].contactUserName){a.push(c[n].email),u.push(r);break}}i=S(),t.find(".share-selected-contact ul").html(i)}function g(){var e=$(this);e.hasClass("selected")?(e.removeClass("selected"),b(s,parseInt(e.attr("data-index"),10))):(e.addClass("selected"),s.push(parseInt(e.attr("data-index"),10))),$("#share-select-add").button({disabled:!1}),$("#share-select-delete").button({disabled:!0})}function y(){var e=$(this);e.hasClass("selected")?(e.removeClass("selected"),b(o,parseInt(e.attr("data-index"),10))):(e.addClass("selected"),o.push(parseInt(e.attr("data-index"),10))),$("#share-select-add").button({disabled:!0}),$("#share-select-delete").button({disabled:!1})}function b(e,t){var n=0,r=e.length;for(;n<r;n++)t===e[n]&&e.splice(n,1)}function w(){var e=0,n=s.length,r;if(n>0){for(;e<n;e++)-1===$.inArray(s[e],u)&&u.push(s[e]);r=S(),t.find(".share-selected-contact ul").html(r),t.find(".share-member-group .selected").removeClass("selected"),s=[]}}function E(){var e=0,n=o.length,r;if(n>0){for(;e<n;e++)-1!==$.inArray(o[e],u)&&b(u,o[e]);r=S(),t.find(".share-selected-contact ul").html(r),t.find(".share-selected-contact .selected").removeClass("selected"),o=[]}}function S(){var e=0,t=u.length,n=[],r;f=[];for(;e<t;e++)r=l[u[e]].contactNickName+"("+l[u[e]].contactUserName+")",n.push('<li data-index="'+u[e]+'" title="'+r+'"><p>'+Util.formateSubStr(l[u[e]].contactUserName,25,0)),f.push(l[u[e]].contactUserName);return n.join("")}function x(){var e=$(this);e.removeClass("unfold").addClass("fold"),e.next().hide()}function T(){var e=$(this);e.removeClass("fold").addClass("unfold"),e.next().show()}function N(){var e="http://www.kuaipan.cn/share_sharefile.htm",t=C(a,f);t.plus.length>0&&$.post(e,{fileId:Util.getFileObj(n).fileId,acttype:"add",sharers:t.plus,msg:""},function(e){"ok"===e.status&&r()},"json"),t.minus.length>0&&"MAIN_PANEL"===i&&$.post(e,{fileId:Util.getFileObj(n).fileId,acttype:"minus",sharers:t.minus,msg:""},function(e){"ok"===e.status&&r()},"json")}function C(e,t){var n={plus:[],minus:[]},r=0,i=0;for(;r<e.length;r++)-1===$.inArray(e[r],t)&&n.minus.push(e[r]);for(;i<t.length;i++)-1===$.inArray(t[i],e)&&n.plus.push(t[i]);return n}function k(){$("#share-get-contact").dialog({dialogClass:"share-contact-dialog",title:"发布协作",buttons:[{text:"取消","class":"btn",click:function(){t.find(".share-selected-contact ul").html(""),$(this).dialog("close")}},{text:"邀请","class":"btn btn_primary",click:function(){N(),t.find(".share-selected-contact ul").html(""),$(this).dialog("close")}}]})}function L(){$("#share-select-add").button({disabled:!0}),$("#share-select-delete").button({disabled:!0})}function A(e){l=[],s=[],o=[],u=[],f=[],c=[],n=e.file,r=e.callback,i=e.panel,L(),p(),k()}var e={},t=$("#share-get-contact"),n,r,i,s=[],o=[],u=[],a=[],f=[],l=[],c=[];return e.init=A,h(),e}()}),"use strict",define("module/model",["common/core/common","common/core/const"],function(){return window.Model={},Model.files=[],Model.parentFile={},$.extend(Model,Event),Model.loadDir=function(e){var t=Common.getFileByFileId(Model.files,e),n=$.now();$.getJSON(Const.LOAD_DIR,{fileId:e},$.proxy(function(n){n&&n.xLive_attr&&"ok"===n.xLive_attr.result?(this.files=n.xLive.file,Common.fixedFileNames(this.files),this.parentFile=t,n.xLive.parentFileId=e):this.trigger("operateMessage",{type:"fail",content:"获取文件列表失败",time:4e3}),this.trigger("loadDir",n)},this)).always(function(e,t){return function(){var n=$.now(),r='{"api": "001", "time": "'+(n-e)+'", "fileId": "'+t+'"}';Common.sendStaticData(r)}}(n,e))},Model.sort=function(){},Model.getPath=function(e){var t={xLive:{parents:[]},xLive_attr:{result:"ok"}};if("0"!==e){var n=$.now();$.getJSON(Const.GET_PATH,{fileId:e},$.proxy(function(e){e&&e.xLive_attr&&"ok"===e.xLive_attr.result&&Common.fixedFileNames(e.xLive.parents),this.trigger("getPath",e)},this)).always(function(e,t){return function(){var n=$.now(),r='{"api": "002", "time": "'+(n-e)+'", "fileId": "'+t+'"}';Common.sendStaticData(r)}}(n,e))}else this.trigger("getPath",t)},Model.createFolder=function(e){if(!Common.checkFileName(e.newFolderName))return this.trigger("operateMessage",{type:"fail",content:"创建文件夹失败，原因：文件名不合法",time:4e3}),this.trigger("createFolderFinished"),!1;var t=$.now();$.post(Const.NEW_FOLDER,{parentid:e.parentFileId,name:e.newFolderName},$.proxy(function(t){var n,r=Util.date(),i;"ok"===t.xLive_attr.result?(n={ext:"",fileId:t.xLive.fileId,fileVer:t.xLive.fileVer,ico:"floder",iscanconvert:!1,iscanwow:!1,modTime:r,name:e.newFolderName,shared:t.xLive.shareId,size:"0",type:"folder"},this.files.unshift(n),t.xLive=n,this.trigger("operateMessage",{type:"success",content:"新建文件夹成功"}),this.trigger("createFolderFinished",n)):("targetExist"===t.xLive_attr.result?i='创建文件夹失败，原因：<span class="error-filename">'+e.newFolderName+"</span>已存在。":i="创建文件夹失败",this.trigger("operateMessage",{type:"fail",content:i,time:4e3}),this.trigger("createFolderFinished"))},this),"json").always(function(e){return function(){var t=$.now(),n='{"api": "003", "time": "'+(t-e)+'"}';Common.sendStaticData(n)}}(t))},Model.renameFile=function(e){if(!Common.checkFileName(e.newFileName))return this.trigger("operateMessage",{type:"fail",content:"重命名文件失败，原因：文件名不合法",time:4e3}),this.trigger("renameFileFinished",{fileId:e.fileId}),!1;var t=$.now();$.post(Const.RENAME,{fileid:e.fileId,name:e.newFileName},$.proxy(function(e){var t,n=e.newFile,r;"ok"===e.result?(t=Common.getFileIndexById(this.files,e.fileId),n.shared=n.shareId,this.files[t]=n,Util.sortArray(this.files,function(e,t){return e.type===t.type?e.modTime<t.modTime?!0:!1:"folder"===t.type?!0:!1}),this.trigger("operateMessage",{type:"success",content:"重命名文件成功"})):("targetExist"===e.result?r='重命名文件失败，原因：<span class="error-filename">'+e.fileName+"</span>已存在。":r="重命名文件失败",this.trigger("operateMessage",{type:"fail",content:r})),this.trigger("renameFileFinished",e)},this),"json").always(function(e,t){return function(){var n=$.now(),r='{"api": "004", "time": "'+(n-e)+'", "fileId": "'+t+'"}';Common.sendStaticData(r)}}(t,e.fileId))},Model.moveFile=function(e){var t={success:[],failed:[]};-1!==$.inArray(e.moveTo,e.fileIds)?this.trigger("operateMessage",{type:"fail",content:"移动文件夹失败，原因：不能将文件夹移入自己",time:3e3}):$.post(Const.MOVE,{fileid:e.fileIds,parentid:e.moveTo},$.proxy(function(e){var n=0,r=e.length,i,s,o=!1,u=!1,a;for(;n<r;n++)i=e[n],"ok"===i.result?(s=Common.getFileIndexById(this.files,i.fileId),this.files.splice(s,1),t.success.push(i)):(t.failed.push(i),"targetExist"===i.result&&(o=!0),"forbidden"===i.result&&(u=!0));0===t.failed.length?this.trigger("operateMessage",{type:"success",content:'成功为您移动<span class="success-file-number">'+t.success.length+"</span>个文件"}):(a='成功为您移动<span class="success-file-number">'+t.success.length+'</span>个文件，失败<span class="fail-file-number">'+t.failed.length+"</span>个文件",o&&(a+="，原因：文件名重复"),u&&(a+="，原因：文件不能移动到自己的子目录"),this.trigger("operateMessage",{type:"fail",content:a,time:4e3})),this.trigger("moveFileFinished",t)},this),"json")},Model.deleteFile=function(e){var t={success:[],failed:[]};$.post(Const.DELETE_FILE,{fileid:e},$.proxy(function(e){var n=0,r=e.length,i,s;for(;n<r;n++)i=e[n],"ok"===i.result?(t.success.push(i),s=Common.getFileIndexById(this.files,i.fileId),this.files.splice(s,1)):t.failed.push(i);0===t.failed.length?this.trigger("operateMessage",{type:"success",content:'成功为您删除<span class="success-file-number">'+t.success.length+"</span>个文件"}):this.trigger("operateMessage",{type:"fail",content:'成功为您删除<span class="success-file-number">'+t.success.length+'</span>个文件，失败<span class="fail-file-number">'+t.failed.length+"</span>个，请稍后重试。",time:4e3}),this.trigger("deleteFileFinished",t)},this),"json")},Model.checkHasPublicLink=function(e){$.post(Const.CHECK_SHARE_LINK,{olid:e},$.proxy(function(e){"ok"===e.xLive_attr.result?this.trigger("checkHasPublicLinkFinished",e.xLive.pickupCode):this.trigger("checkHasPublicLinkFinished")},this),"json")},Model.publicShareLink=function(e){$.post(Const.PUBLISH_SHARE_LINK,e,$.proxy(function(e){this.trigger("publishShareLinkFinished",e)},this),"json")},Model.republishShareLink=function(e){$.post(Const.REPUBLISH_SHARE_LINK,e,$.proxy(function(e){this.trigger("republishShareLinkFinished",e)},this),"json")},Model.cancelSharelink=function(e){$.post(Const.CANCEL_SHARE_LINK,{fileId:[e]},$.proxy(function(e){var t=e[0];"ok"===t.result?this.trigger("operateMessage",{type:"success",content:"取消分享链接成功"}):this.trigger("operateMessage",{type:"fail",content:"取消分享链接失败",time:4e3})},this),"json")},Model.sendEmail=function(e){$.post(Const.SEND_EMAIL,{emailAddress:e.emailAddress,nickName:e.nickName,fileName:e.fileName,fileId:e.fileId},$.proxy(function(e){this.trigger("sendEmailFinished")},this),"json")},Model.search=function(e){$.post(Const.SEARCH,{keyword:e},$.proxy(function(e){},this),"json")},Model.updateCooperateInfo=function(e,t){var n=Common.getFileByFileId(this.files,e);t?n.shared=n.fileId:n.shared="0"},Model}),"use strict",define("module/fileview/kplist",["common/core/core"],function(){KP.Core.register("fileview-kplist",function(e){var t=$("#filemangebox");return{init:function(){e.listen(["location-hash-issearch","location-hash-islink","location-hash-isshare","location-hash-shareout","location-hash-isrecycle"],function(){t.hide()},this),e.listen(["location-hash-isfilemanage"],function(){t.show()},this)},updateFileListPanel:function(){},updateFileListData:function(e){}}})}),"use strict",define("module/fileview/search",["jquery","lib/jquery/ui.custom","common/core/core"],function(){KP.Core.register("fileview-search",function(e){function h(){x(),t.show()}function p(e,t,n){var r=['<li class="operate"><em class="total">搜索<span class="em3">'+e+'</span>的结果如下，共找到<span class="em3">'+(t||0)+"</span>项，耗时："+n+"秒。</em></li>"].join("");i.html(r)}function d(){var t,r,i="",s;for(t in l)r=l[t],s=r.fileid,i+='<tr data-fileid="'+s+'">',i+='<td class="select-file">',i+='<div value="'+s+'" class="bgs ico-checkbox dib h20 chk"></div></td>',i+='<td class="file-title f14">',r.ftype=="folder"?i+='<a href="#kp|'+s+'|0"  class="'+r.ico+' ico-type ico-doc browseShareLink" title="'+r.fname+'">'+r.formatname+'</a><br/><span style="margin-left:45px;" class="lgray f12">'+r.file_path+"</span></td>":i+='<a href="'+e.getDownloadUrl(s)+'"  class="'+r.ico+' ico-type ico-doc browseShareLink" title="'+r.fname+'">'+r.formatname+'</a><br/><span style="margin-left:45px;" class="lgray f12">'+r.file_path+"</span></td>",i+='<td class="tr">'+r.formatsize+"</td>",i+='<td class="tr">'+r.formattime+"</td>",i+="</tr>";""==i&&(i+="<tr>",i+='<td colspan="4" class="pl10 w320 gray">没有搜索到相关的文件（夹），换个关键词试试吧</td>',i+="</tr>"),n.html(i),e.notify({type:"fileview-search-showdefaultmenu",data:""}),e.notify({type:"fileview-searchmenuhide",data:""}),e.notify({type:"loading_close",data:""})}function v(){var t,n,r=[],i,s,o=e.getStaticSrcHost();for(t in l)n=l[t],n.type=="folder"?(r.push('<li class="file" data-fileid="',n.fileId,'"><i class="i ifl2 '+Util.getFileIconClassName(file)+'"></i></div>'),r.push('<a href="javascript:void(0)" class="name" title="'+n.formatname+'">'+n.formatname+"</a>")):n.isimage?(r.push('<li class="file" data-fileid="',n.fileId,'"><i class="i ifl2 i41"></i>'),r.push('<a href="javascript:void(0)" class="name" title="'+n.formatname+'">'+n.formatname+"</a>")):(r.push('<li class="file" data-fileid="'+n.fileId+'">i class="i ifl2 '+Util.getFileIconClassName(file)+'"></i>'),r.push('<a href="javascript:void(0)" class="name" title="'+n.formatname+'">'+n.formatname+"</a>"));r.length==0&&r.push('<div class="noFile"></div>'),u.html(r.join("")),e.notify({type:"fileview-search-showdefaultmenu",data:""}),e.notify({type:"fileview-searchmenuhide",data:""}),e.notify({type:"loading_close",data:""})}function m(){e.getViewStyle()=="list"?(o.show(),u.hide(),d()):(o.hide(),u.show(),v())}function g(t,n){e.notify({type:"loading_open",data:""}),e.request(c,"get","json",{keyword:t,page:n},function(t){var n=0,r,i=t.fileInfo||[],s=i.length;l={};for(;n<s;n++)r=i[n],r.fsize?"folder"==r.ftype?r.formatsize="":r.formatsize=e.convertByteToMB(r.fsize):r.formatsize="",r.type=r.ftype,r.ext=r.fileext,r.fileVer=r.filever,r.fileId=r.fileid,l[r.fileid]=r;t.multi?a.show().html(t.multi):a.hide().html(""),p(t.keyword,t.total,t.usetime),m()})}function y(t){var r=f=="list"?n:u,i=r.find(".ui-selected");r.find(".icon-view-selected").removeClass("icon-view-selected");var s=e.getSelectedFiles("SE");if(i.length==1&&s.length==1&&s[0]["fileid"]==i.attr("data-fileid"))e.setSelectedFiles("SE",[]),i.removeClass("ui-selected");else{e.setSelectedFiles("SE",[]);var o=[];i.each(function(e){var t=$(this);t.addClass("icon-view-selected"),fileid=t.attr("data-fileid"),fileid&&o.push(l[fileid])}),e.setSelectedFiles("SE",o)}e.notify({type:"fileview-searchmenuhide",data:""}),e.notify({type:"fileview-search-topmenu",data:t})}function b(r){var i=$(r.target).closest("li",t);i.toggleClass("ui-selected").toggleClass("icon-view-selected");var s=f=="list"?n:u,o=[];r.ctrlKey||s.find(".ui-selected").not(i).removeClass("ui-selected").removeClass("icon-view-selected"),e.setSelectedFiles("SE",[]);var a=s.find(".ui-selected");a.each(function(e){var t=$(this);t.addClass("icon-view-selected");var n=t.attr("data-fileid");n&&o.push(l[n])}),e.setSelectedFiles("SE",o),clickTimer=window.setTimeout(function(){e.notify({type:"fileview-searchmenuhide",data:r}),e.notify({type:"fileview-search-topmenu",data:r})},200)}function w(n){window.clearTimeout(clickTimer);var r=$(n.target).closest("li",t),i=l[r.attr("data-fileid")];i.type=="folder"?location.hash="#kp|"+i.fileId+"|0":e.notify({type:"onlineview",data:{file:i,records:l}})}function E(r){$(r.target).closest("tr",t).toggleClass("ui-selected").toggleClass("icon-view-selected");var i=[],s=n,o=s.find(".ui-selected");e.setSelectedFiles("SE",[]);var i=[];o.each(function(e){var t=$(this);t.addClass("icon-view-selected"),fileid=t.attr("data-fileid"),fileid&&i.push(l[fileid])}),e.setSelectedFiles("SE",i),e.notify({type:"fileview-searchmenuhide",data:""}),e.notify({type:"fileview-search-topmenu",data:r})}function S(t){var n=$(t.currentTarget),r=n.attr("dataview");f=r||"list",e.setViewStyle(f),x(),m()}function x(){e.getViewStyle()=="list"?($(".imitate-list").addClass("active-list"),$(".imitate-thumb").removeClass("active-thumb"),f="list"):($(".imitate-list").removeClass("active-list"),$(".imitate-thumb").addClass("active-thumb"),f="preview")}function T(e){var t=s.val();return t?(location.hash="#se|"+encodeURIComponent(t),!1):!1}function N(n){var r=$(n.currentTarget);r.closest("tr",t).find(".sort").not(r).hide();var i=r.find(".sort").show(),s=i.attr("sortkey"),o=i.attr("sorttype");"asc"==o?i.attr("sorttype","des").html("▲"):i.attr("sorttype","asc").html("▼");var u,a=[],f=[],c,h,p,d=0,v=!1;for(c in l)h=l[c],"folder"==h.ftype?f.push(h):a.push(h);v="fsize"==s?!0:!1,v?f=f.reverse():f=e.sortObjectWith(f,s,o,v),a=e.sortObjectWith(a,s,o,v),u=f.concat(a),p=u.length,l={},e.setSelectedFiles("SE",[]);for(;d<p;d++)h=u[d],l[h.fileid]=h;m()}function C(n){var r,i,s=[],o=f=="list"?"tr":"li";return r=$(n.target).closest(o,t),i=r.not(".ui-selected"),r.length!=0?i.length!=0&&(e.setSelectedFiles("SE",[]),t.find(".icon-view-selected").removeClass("icon-view-selected").removeClass("ui-selected"),i.addClass("icon-view-selected ui-selected"),s.push(l[i.attr("data-fileid")]),e.setSelectedFiles("SE",s)):(e.setSelectedFiles("SE",[]),t.find(".icon-view-selected").removeClass("icon-view-selected").removeClass("ui-selected")),e.notify({type:"fileview-search-showdefaultmenu",data:""}),e.notify({type:"fileview-search-contentmenu",data:{e:n,view:f}}),!1}function k(){n.selectable({cancel:"a,td.select-file",filter:"tr",stop:$.proxy(y,this)}),u.selectable({cancel:"a",filter:"li",distance:40,stop:$.proxy(y,this)}),t.delegate("th:has(.sort)","click",$.proxy(N,this)),t.delegate(".viewstyle","click",$.proxy(S,this)),t.delegate("td.select-file","click",$.proxy(E,this)),t.delegate("li.file","dblclick",$.proxy(w,this)).delegate("li.file","click",$.proxy(b,this)),t.delegate("#searchwrapfrom","submit",$.proxy(T,this)),t.bind("contextmenu",$.proxy(C,this))}var t=$("#searchmanagefilebox"),n=$("#searchfileBox"),r=$("#searchbutton"),i=$("#searchnavbox"),s=$("#searchvaluetext"),o=$("#searchlistview"),u=$("#searchthumblist"),a=$("#pagebar"),f=e.getViewStyle()||"list",l={},c="/index.php?ac=home&op=search";return{init:function(){k(),e.listen("location-hash-issearch",this.updateFileListData,this),e.listen("location-hash-islink",this.hidePanel,this),e.listen("location-hash-isfilemanage",this.hidePanel,this),e.listen("location-hash-shareout",this.hidePanel,this),e.listen("location-hash-isshare",this.hidePanel,this),e.listen("location-hash-isrecycle",this.hidePanel,this)},destroy:function(){},updateFileListData:function(e){h();var t=e.split("|"),n="请输入关键词";t.length>=2&&(n=t[1],n=decodeURIComponent(n),s.val(n));var r=t[2]||"";g(n,r)},hidePanel:function(){s.val(""),t.hide()}}})}),"use strict",define("module/fileview/sharelist",["lib/jquery/ui.custom","lib/tab/tab","common/core/core"],function(e){KP.Core.register("fileview-sharelist",function(e){function m(){var t,r,i=[],s,o;for(t in h)r=h[t],r.nickname!==""&&!$.isArray(r.nickname)?o=r.nickname:r.email!==""&&!$.isArray(r.email)?o=r.email:r.mobile!==""&&!$.isArray(r.mobile)?o=r.mobile:o=r.passport,i.push('<tr data-fileid="'+r.userId+'">'),i.push('<td class="col_cbox"></td>'),i.push('<td class="col_name file-name"><i class="i ifl i21"></i><a href="#sh|user_'+r.userId+"_"+o+'|0" title="'+o+'">'+o+"</a></td>"),i.push('<td class="col_total">'+r.file.length+"</td>"),i.push("</tr>");i.length==0&&(i.push("<tr>"),i.push('<td colspan="3" class="pl10 w320">您还没有收到协作文件夹</td>'),i.push("</tr>")),n.html(i.join("")),e.notify({type:"loading_close",data:""})}function g(){e.notify({type:"loading_open",data:""}),e.request(d,"get","json","",function(e){var t=e.xLive.users||[],n,r="",i=t.length;h={};for(n=0;n<i;n++)r=t[n],r.file=r.file.fileId?[r.file]:r.file,h[r.userId]=r;m()})}function y(){c=="list"?(o.show(),a.hide(),b()):(o.hide(),a.show(),w())}function b(){var t,n,r=[],s;for(t in h)n=h[t],r.push('<tr data-fileid="'+n.fileId+'">'),r.push('<td class="col_cbox"><span value="'+n.fileId+'" class="checkbox"></span></td>'),n.type=="folder"?r.push('<td class="col_fname file-name"><i class="i ifl i21"></i><a href="#sh|dir_'+n.fileId+"_"+f.userId+"_"+f.email+'|0" title="'+n.name+'">'+n.name+"</a></td>"):r.push('<td class="col_fname file-name '+Util.getFileIconClass(n)+'-icon"><i class="i ifl '+Util.getFileIconClassName(n)+'"></i><a href="'+e.getDownloadUrl(n.fileId)+'" title="'+n.name+'">'+n.name+"</a></td>"),r.push("</td>"),r.push('<td class="col_fsize">'+n.formatsize+"</td>"),r.push('<td class="col_date">'+n.modTime+"</td>");r.length==0&&r.push('<tr><td class="col_cbox"></td><td colspan="3">该目录下没有文件（夹）</td>'),e.notify({type:"fileview-sharetm-hidemenu",data:""}),e.notify({type:"fileview-sharetm-showdefaultmenu",data:""}),i.html(r.join("")),e.notify({type:"loading_close",data:""})}function w(){var t,n,r=[],i,s=e.getStaticSrcHost();for(t in h)n=h[t],n.type=="folder"?(r.push('<li title="',n.name,'" class="viewfileitem r2 p5 tc" dirHash="#sh|dir_'+n.fileId+"_"+f.userId+"_"+f.email+'|0" data-fileid="',n.fileId,'"><div class=" b-ico b-ico-style ',n.type,'"></div>'),r.push('<div  class="lh18">',n.name,"</div></li>")):n.isimage?(r.push('<li  title="',n.name,'"  class="viewfileitem r2 p5 tc" data-fileid="',n.fileId,'">'),r.push('<div class="b-img tc" style="background:url(',s,'/themes/images/greypic.gif)"><img src="',s,'/themes/images/greypic.gif" data-original ="',e.getOnlineViewUrl(n),'" /></div>'),r.push('<div class="lh18">',n.name,"</div></li>")):(r.push('<li  title="',n.name,'"  class="viewfileitem r2 p5 tc" data-fileid="'+n.fileId+'"><div class=" b-ico b-ico-style ',n.ico,'"></div>'),r.push('<div  class="lh18">',n.name,"</div></li>"));r.length==0&&(r.push('<li style="float:none;" >'),r.push("<span>该目录下没有文件（夹）</span>"),r.push("</li>")),a.html(r.join("")),e.notify({type:"fileview-sharetm-hidemenu",data:""}),e.notify({type:"fileview-sharetm-showdefaultmenu",data:""}),a.find(".viewfileitem img").lazyload({event:"scrollstop",width:100,height:100}),e.notify({type:"loading_close",data:""})}function E(){e.notify({type:"loading_open",data:""}),e.request(d+"&l=user&u="+f.userId,"get","json","",function(t){var n=0,r,i=t||[],s=i.length,o,u,a,f;h={},o=e.splitArrayWithKV(i,"type","folder"),u=o[0],a=o[1],u=e.sortObjectWith(u,"modTime","des"),a=e.sortObjectWith(a,"modTime","des"),f=u.concat(a);for(;n<s;n++)r=f[n],r.size?"folder"==r.type?r.formatsize="":r.formatsize=e.convertByteToMB(r.size):r.formatsize="",h[r.fileId]=r;y()})}function S(t){e.notify({type:"loading_open",data:""}),e.request(d+"&l=dir&fileid="+t,"get","json","",function(t){var n=0,r,i=t||[],s=i.length,o,u,a,f;h={},o=e.splitArrayWithKV(i,"type","folder"),u=o[0],a=o[1],u=e.sortObjectWith(u,"modTime","des"),a=e.sortObjectWith(a,"modTime","des"),f=u.concat(a);for(;n<s;n++)r=f[n],r.size?"folder"==r.type?r.formatsize="":r.formatsize=e.convertByteToMB(r.size):r.formatsize="",h[r.fileId]=r;y()})}function x(e){var t=f.email,n=f.userId,r=['<a href="#sh|0|0">协作管理</a>','<a href="#sh|user_'+n+"_"+t+'|0" class="dib">'+t+"</a>"];e?$.ajax({url:"/index.php?ac=home&op=getpath&fileId="+e,dataType:"json",success:function(e){var i=e.xLive.parents||[],o=[],u,a=i.length,f=a;if(a>=1)while(a--)u=i[a],o.push('<a href="#sh|dir_'+u.fileId+"_"+n+"_"+t+'|0" class="dib">'+u.name+"</a>");r=r.concat(o),s.html(r.join('<span class="lgray plr5">&gt;</span>'))}}):s.html(r.join('<span class="lgray plr5">&gt;</span>'))}function T(t){var n=c=="list"?i:a,r=n.find(".ui-selected");n.find(".selected").removeClass("selected");var s=e.getSelectedFiles("TM");if(r.length==1&&s.length==1&&s[0]["fileId"]==r.attr("data-fileid"))e.setSelectedFiles("TM",[]),r.removeClass("ui-selected");else{e.setSelectedFiles("TM",[]);var o=[];r.each(function(e){var t=$(this);t.addClass("selected"),p=t.attr("data-fileid"),p&&o.push(h[p])}),e.setSelectedFiles("TM",o)}e.notify({type:"fileview-sharetm-hidemenu",data:""}),e.notify({type:"fileview-share-topmenu",data:t})}function N(n){$(n.target).closest("tr",t).toggleClass("ui-selected").toggleClass("selected");var r=[],s=i,o=s.find(".ui-selected");e.setSelectedFiles("TM",[]);var r=[];o.each(function(e){var t=$(this);t.addClass("selected"),p=t.attr("data-fileid"),p&&r.push(h[p])}),e.setSelectedFiles("TM",r),e.notify({type:"fileview-sharetm-hidemenu",data:""}),e.notify({type:"fileview-share-topmenu",data:n})}function C(n){var r=$(n.target).closest("li",t);r.toggleClass("ui-selected").toggleClass("selected");var s=c=="list"?i:a,o=[];n.ctrlKey||s.find(".ui-selected").not(r).removeClass("ui-selected").removeClass("selected"),e.setSelectedFiles("TM",[]);var u=s.find(".ui-selected");return u.each(function(e){var t=$(this);t.addClass("selected");var n=t.attr("data-fileid");n&&o.push(h[n])}),e.setSelectedFiles("TM",o),l=window.setTimeout(function(){e.notify({type:"fileview-sharetm-hidemenu",data:""}),e.notify({type:"fileview-share-topmenu",data:n})},200),!1}function k(n){window.clearTimeout(l);var r=$(n.target).closest("li",t),i=h[r.attr("data-fileid")];if(i.type=="folder"){var s=r.attr("dirHash");location.hash=s}else e.notify({type:"onlineview",data:{file:i,records:h}})}function L(t){r.find(".ui-selected").removeClass("selected").removeClass("ui-selected"),e.setSelectedFiles("TM",[]),e.notify({type:"fileview-sharetm-hidemenu",data:""}),e.notify({type:"fileview-sharetm-showdefaultmenu",data:""})}function A(e){var t=$(e.currentTarget).find(".sort"),n=t.attr("sortkey"),r=t.attr("sorttype");"asc"==r?t.attr("sorttype","des").html("▲"):t.attr("sorttype","asc").html("▼");var i=[],s,o,u,a=0,f=!1;for(s in h)o=h[s],i.push(o);u=i.length,h={};for(;a<u;a++)o=i[a],h[o.userId]=o;m()}function O(n){var r=$(n.currentTarget);r.closest("tr",t).find(".sort").not(r).hide();var i=r.find(".sort").show(),s=i.attr("sortkey"),o=i.attr("sorttype");"asc"==o?i.attr("sorttype","des").html("▲"):i.attr("sorttype","asc").html("▼");var u,a=[],f=[],l,c,p,d=0,v=!1;for(l in h)c=h[l],"folder"==c.type?f.push(c):a.push(c);v="size"==s?!0:!1,v?f=f.reverse():f=e.sortObjectWith(f,s,o,v),a=e.sortObjectWith(a,s,o,v),u=f.concat(a),p=u.length,h={},e.setSelectedFiles("TM",[]);for(;d<p;d++)c=u[d],h[c.fileId]=c;y()}function M(t){var n=$(t.currentTarget),r=n.attr("dataview");c=r||"list",e.setViewStyle(c),_(),y()}function _(){e.getViewStyle()=="list"?($(".imitate-list").addClass("active-list"),$(".imitate-thumb").removeClass("active-thumb"),c="list"):($(".imitate-list").removeClass("active-list"),$(".imitate-thumb").addClass("active-thumb"),c="preview")}function D(t){var n,i,s=[],o=c=="list"?"tr":"li";return n=$(t.target).closest(o,r),i=n.not(".ui-selected"),n.length!=0?i.length!=0&&(e.setSelectedFiles("TM",[]),r.find(".selected").removeClass("selected").removeClass("ui-selected"),i.addClass("selected ui-selected"),s.push(h[i.attr("data-fileid")]),e.setSelectedFiles("TM",s)):(r.find(".selected").removeClass("selected").removeClass("ui-selected"),e.setSelectedFiles("TM",[])),e.notify({type:"fileview-sharetm-showdefaultmenu",data:""}),e.notify({type:"fileview-sharetm-contentmenu",data:{e:t,view:c}}),!1}function P(t){var n=$(t.target).closest("tr",r),i=h[n.attr("data-fileid")];if(i.iscanconvert)return e.notify({type:"onlineview",data:{file:i,records:h}}),!1}function H(){i.selectable({cancel:"a,td.select-file",filter:"tr",stop:$.proxy(T,this)}),a.selectable({cancel:"a",filter:"li",distance:40,stop:$.proxy(T,this)}),r.delegate("a.filelink","click",$.proxy(P,this)),t.delegate("th:has(.sort)","click",$.proxy(A,this)),r.delegate("th:has(.sort)","click",$.proxy(O,this)),r.delegate("td.select-file","click",$.proxy(N,this)),r.delegate(".viewstyle","click",$.proxy(M,this)),r.delegate("li.viewfileitem","dblclick",$.proxy(k,this)).delegate("li.viewfileitem","click",$.proxy(C,this)),r.delegate("#sharetmthumblist","click",$.proxy(L,this)),r.bind("contextmenu",$.proxy(D,this))}function B(e){_();var n=e.split("|"),i=n[1]||"0",s=i.split("_");switch(s[0]){case"user":r.show(),t.hide(),f={email:s[2],userId:s[1]},x(),E();break;case"dir":r.show(),t.hide(),f={email:s[3],userId:s[2]},x(s[1]),S(s[1]);break;default:t.show(),r.hide(),g()}}var t=$("#sharemanagebox"),n=$("#sharefilelist"),r=$("#sharemanagefilebox"),i=$("#fileBoxfileList"),s=$("#sharetmnavbox"),o=$("#sharetmlistview"),u=$("#shareshowtitle"),a=$("#sharetmthumblist"),f={},l="",c=e.getViewStyle()||"list",h={},p,d="/index.php?ac=home&op=tome",v="/index.php?ac=home&op=out";return{init:function(){H(),e.listen("location-hash-isshare",B,this),e.listen("location-hash-issearch",this.hidePanel,this),e.listen("location-hash-shareout",this.hidePanel,this),e.listen("location-hash-islink",this.hidePanel,this),e.listen("location-hash-isfilemanage",this.hidePanel,this),e.listen("location-hash-isrecycle",this.hidePanel,this),e.listen("exitshare-ok",B,this)},destroy:function(){},hidePanel:function(){t.hide(),r.hide()}}})}),"use strict",define("module/fileview/linklist",["lib/jquery/ui.custom","common/core/core","lib/tab/tab"],function(e){KP.Core.register("fileview-linklist",function(e){function l(){y(),t.show()}function c(){var t,r,i="";for(t in u){r=u[t];var s={type:r.ftype,ext:Util.getFileExt(r.fname)};i+='<tr data-fileid="'+r.fileId+'">',i+='<td class="col_cbox select-file"><span value="'+r.fileId+'" class="checkbox"></span>',i+='<td class="col_fname file-name"><i class="i ifl '+Util.getFileIconClassName(s)+'"></i><a href="'+e.getOutLinkUrl(r.fileId)+'" target="_blank" class="browseShareLink">'+r.fname+"</a>",i+='<td class="col_status">'+e.getLang(r.status),r.pickupCode=="no"||!r.pickupCode?i+='<td class="col_pwd pwdalera">无</td>':i+='<td class="col_pwd pwdalera"><a href="javascript:void(0)" data-fileid="'+r.fileId+'" class="getPickupCode">访问密码</a>',i+='<td class="col_fsize">'+r.formatsize,i+='<td class="col_date">'+r.createTS}""==i&&(i+="<tr>",i+='<td colspan="6" class="pl10 w320">该目录下没有文件（夹）'),n.html(i),b(),e.notify({type:"fileview-link-showdefaultmenu",data:""}),e.notify({type:"loading_close",data:""})}function h(t){var n=t.split("|");e.notify({type:"loading_open",data:""}),e.request(a,"get","json","",function(t){var n=0,r,i=t.outlinks||[],s=i.length,a,f,l,h;o=s,u={},e.setSelectedFiles("LI",[]),a=e.splitArrayWithKV(i,"ftype","folder"),l=e.sortObjectWith(a[1],"size","des",!0),f=e.sortObjectWith(a[0],"size","des",!0),h=f.concat(l);for(;n<s;n++)r=h[n],r.size?"folder"==r.type?r.formatsize="":r.formatsize=e.convertByteToMB(r.size):r.formatsize="",u[r.fileId]=r;c()})}function p(t){var r=n,i=r.find(".ui-selected");r.find("tr.selected").removeClass("selected");var s=e.getSelectedFiles("LI");if(i.length==1&&s.length==1&&s[0]["fileId"]==i.attr("data-fileid"))e.setSelectedFiles("LI",[]),i.removeClass("ui-selected");else{e.setSelectedFiles("LI",[]);var o=[];i.each(function(e){var t=$(this).addClass("selected"),n=t.attr("data-fileid");n&&o.push(u[n])}),e.setSelectedFiles("LI",o)}b(),e.notify({type:"fileview-linkmenuhide",data:t}),e.notify({type:"fileview-linkmange-menuopen",data:t})}function d(n){var r,i=[];return r=$(n.target).closest("tr",t).not(".ui-selected"),r.length!==0?(e.setSelectedFiles("LI",[]),t.find("tr.selected").removeClass("selected").removeClass("ui-selected"),r.addClass("selected ui-selected"),i.push(u[r.attr("data-fileid")]),e.setSelectedFiles("LI",i)):(e.setSelectedFiles("LI",[]),t.find("tr.selected").removeClass("selected").removeClass("ui-selected")),b(),e.notify({type:"fileview-link-showdefaultmenu",data:""}),e.notify({type:"fileview-link-contentmenu",data:{e:n,view:"list"}}),!1}function v(e){var t=$(e.target),n=t.attr("data-fileid");$.ajax({url:f,type:"post",dataType:"json",data:{olid:n},success:function(e){var n=e.xLive.pickupCode;n&&t.parent("td").html(n)}})}function m(t){$(t.target).closest("tr",n).toggleClass("ui-selected").toggleClass("selected");var r=n,i=r.find(".ui-selected");e.setSelectedFiles("LI",[]);var s=[];i.each(function(e){var t=$(this);t.addClass("selected");var n=t.attr("data-fileid");n&&s.push(u[n])}),e.setSelectedFiles("LI",s),b(),e.notify({type:"fileview-linkmenuhide",data:t}),e.notify({type:"fileview-linkmange-menuopen",data:t})}function g(n){var r=$(n.currentTarget);r.closest("tr",t).find(".sort").not(r).hide();var i=r.find(".sort").show(),s=i.attr("sortkey"),o=i.attr("sorttype");"asc"==o?i.attr("sorttype","des").html("▲"):i.attr("sorttype","asc").html("▼");var a,f=[],l=[],h,p,d,v=0,m=!1;for(h in u)p=u[h],"folder"==p.ftype?l.push(p):f.push(p);m="size"==s?!0:!1,m?l=l.reverse():l=e.sortObjectWith(l,s,o,m),f=e.sortObjectWith(f,s,o,m),a=l.concat(f),d=a.length,u={},e.setSelectedFiles("LI",[]);for(;v<d;v++)p=a[v],u[p.fileId]=p;c()}function y(){if(r=="0"){var e='<iframe src="'+CONST.linkssourl+'" width="0" height="0"  class="dn" name="loginsite"></iframe>';$(document.body).append(e),r="1"}}function b(){var t=e.getSelectedFiles("LI").length;t==0||o!=0&&t!=o?(s.removeClass("selected"),i.removeClass("selected")):(s.addClass("selected"),i.addClass("selected"))}function w(){s.hasClass("selected")?(s.removeClass("selected"),i.removeClass("selected"),t.find("tr").removeClass("ui-selected")):(s.addClass("selected"),i.addClass("selected"),t.find("tr").addClass("ui-selected")),p()}function E(){n.selectable({cancel:"a,td.select-file",filter:"tr",stop:$.proxy(p,this)}),t.delegate("th:has(.sort)","click",$.proxy(g,this)).delegate(".chkall","click",$.proxy(w,this)),t.delegate(".getPickupCode","click",$.proxy(v,this)).delegate("td.select-file","click",$.proxy(m,this)),t.bind("contextmenu",$.proxy(d,this))}var t=$("#linkmanagebox"),n=$("#linkfilelist"),r="0",i=$("#linktopdefault"),s=$("#linktopmenu"),o=0,u={},a="/index.php?ac=home&op=share",f="/index.php?ac=home&op=filepickupcode";return{init:function(){E(),e.listen("location-hash-islink",this.updateFileListData,this),e.listen("location-hash-issearch",this.hidePanel,this),e.listen("location-hash-isfilemanage",this.hidePanel,this),e.listen("location-hash-shareout",this.hidePanel,this),e.listen("location-hash-isshare",this.hidePanel,this),e.listen("location-hash-isrecycle",this.hidePanel,this),e.listen("deloutlink-ok",this.updateFileListData,this)},destroy:function(){},updateFileListData:function(e){l(),h(e)},hidePanel:function(){t.hide()}}})}),"use strict",define("module/fileview/opmenu",["common/core/core"],function(){KP.Core.register("fileview-opmenu",function(e){function b(){var t=[],n=e.getSelectedFiles("KP"),r=n.length;switch(r){case 1:var i=n[0];i.type=="file"?t.push('<a href="'+e.getDownloadUrl(i.fileId)+'">'+Resources.download+"</a>"):t.push('<a menu-style="openfolder" href="#kp|'+i.fileId+'|0">'+Resources.openfolder+"</a>"),"folder"===i.type&&(i.fileId==i.shared||"0"==i.shared)&&t.push('<a menu-style="sharefile" href="javascript:;">共享给好友</a>'),t.push('<a menu-style="shareLink" href="javascript:;">'+Resources.generatesharelink+"</a>"),t.push('<a menu-style="rename" href="javascript:;">'+Resources.rename+"</a>"),t.push('<a menu-style="movefile" href="javascript:;">'+Resources.move+"</a>"),t.push('<a menu-style="deletefile" href="javascript:;">'+Resources["delete"]+"</a>"),i.iscanwow&&t.push('<a target="_blank" href="'+e.createEditUrl(i.fileId)+'">'+Resources.editonline+"</a>"),i.iscanconvert&&t.push('<a target="_blank" href="'+e.getOnlineViewUrl(i,1)+'">'+Resources.viewonline+"</a>");break;case 0:break;default:t.push('<span class="blue" style="border:0 none;" >'+Resources.seleted+r+Resources.item+"</span>",'<a menu-style="movefile" href="javascript:;">'+Resources.move+"</a>",'<a menu-style="deletefile" href="javascript:;">'+Resources["delete"]+"</a>")}""==t.join("")?(f.hide(),l.show()):(l.hide(),f.show().find("#kptopmenuwrap").html(t.join("")),e.notify({type:"newuser-manage-guide",data:""}))}function w(n){var r=e.getSelectedFiles("KP"),i=r.length,s=[];if(i==0)s=[];else if(i==1){var o=r[0];o.type=="file"?s.push('<li><a menu-style="download" href="'+e.getDownloadUrl(o.fileId)+'">'+Resources.download+"</a>"):s.push('<li><a menu-style="openfolder" href="#kp|'+o.fileId+'|0">'+Resources.openfolder+"</a>"),"folder"===o.type&&(o.fileId==o.shared||"0"==o.shared)&&s.push('<li><a menu-style="sharefile" href="javascript:;">共享给好友</a>','<li><a menu-style="shareLink" href="javascript:;">'+Resources.generatesharelink+"</a>"),o.iscanwow&&s.push('<li><a target="_blank" href="'+e.createEditUrl(o.fileId)+'">'+Resources.editonline+"</a>"),o.iscanconvert&&s.push('<li><a target="_blank" href="'+e.getOnlineViewUrl(o,1)+'">'+Resources.viewonline+"</a>"),s.push('<li><a menu-style="rename" href="javascript:;">'+Resources.rename+"</a>",'<li><a menu-style="movefile" href="javascript:;">'+Resources.move+"</a>",'<li><a menu-style="deletefile" href="javascript:;">'+Resources["delete"]+"</a>")}else s.push('<li class="ti14 blue" style="border:0 none;"><span>'+Resources.seleted+i+Resources.item+"</span>",'<li class="SplitLine">','<li><a menu-style="movefile" href="javascript:;">'+Resources.move+"</a>",'<li><a menu-style="deletefile" href="javascript:;">'+Resources["delete"]+"</a>");j(n.e,s.join(""),t,n.view)}function E(){f.hide(),l.removeClass("selected").show()}function S(){var t=[],n=e.getSelectedFiles("TM"),r=n.length;switch(r){case 1:var i=n[0];i.fileId==i.shared||i.shareId?(i.type=="file"&&t.push('<li class="operate"><a class="btn" href="'+e.getDownloadUrl(i.fileId)+'">'+Resources.download+"</a>"),t.push('<li data-ca="operate-configshare" class="operate"><button class="btn" menu-style="sharefile">协作设置</button>'),t.push('<li data-ca="operate-exitshare" class="operate"><button class="btn" menu-style="exitshare">'+e.getLang("exitShareTm")+"</button>")):i.type=="file"?t.push('<li class="operate"><a class="btn" menu-style="download" href="'+e.getDownloadUrl(i.fileId)+'">'+Resources.download+"</a>"):t=[],i.iscanconvert&&t.push('<a target="_blank" href="'+e.getOnlineViewUrl(i,1)+'">'+Resources.viewonline+"</a>");break;case 0:break;default:var i=n[0];if(i.fileId==i.shared||i.shareId)t.push('<li class="operate"><span class="selected-file-number">'+Resources.seleted+r+Resources.item+"</span>"),t.push('<li class="operate"><button data-ca="operate-exitshare" class="btn" menu-style="exitshare">'+e.getLang("exitShareTm")+"</button>")}""==t.join("")?d.hide():d.show().html(t.join(""))}function x(t){var n=e.getSelectedFiles("TM"),i=n.length,s=[];if(i==0)s=[];else if(i==1){var o=n[0];if(!o)return;o.fileId==(o.shared||o.shareId)?(o.type=="file"&&(s.push('<li><a menu-style="download" href="'+e.getDownloadUrl(o.fileId)+'">'+Resources.download+"</a>"),o.iscanconvert&&s.push('<li><a target="_blank" href="'+e.getOnlineViewUrl(o,1)+'">'+Resources.viewonline+"</a>")),s.push('<li><a data-ca="contextmenu-configshare" menu-style="sharefile" href="javascript:;">协作设置</a>'),s.push('<li><a data-ca="contextmenu-exitshare" menu-style="exitshare" href="javascript:;">'+e.getLang("exitShareTm")+"</a>")):o.type=="file"?(s.push('<li><a menu-style="download" href="'+e.getDownloadUrl(o.fileId)+'">'+Resources.download+"</a>"),o.iscanconvert&&s.push('<li><a target="_blank" href="'+e.getOnlineViewUrl(o,1)+'">'+Resources.viewonline+"</a>")):s=[]}else o=n[0],(o.fileId==o.shared||o.shareId)&&s.push('<li><a menu-style="cancleShare" href="javascript:;">'+Resources.cancelsharelink+"</a>");j(t.e,s.join(""),r,t.view)}function T(){d.hide()}function N(){var t=e.getSelectedFiles("OU"),n=t.length,r=[];if(n==0)r=[];else if(n==1){var i=t[0];r.push('<li class="operate"><button class="btn" menu-style="sharefile">'+e.getLang("sharetofriend")+"</a>"),r.push('<li class="operate"><button class="btn" menu-style="cancelshare">'+e.getLang("cancelsharetofriend")+"</a>"),i.type=="file"&&r.push('<li class="operate"><a class="btn" menu-style="download" href="'+e.getDownloadUrl(i.fileId)+'">'+Resources.download+"</a>")}else r=[];""==r.join("")?(m.hide(),v.show()):(v.hide(),m.show().html(r.join("")))}function C(t){var n=e.getSelectedFiles("OU"),r=n.length,s=[];if(r==0)s=[];else if(r==1){var o=n[0];s.push('<li><a menu-style="sharefile" href="javascript:;">'+e.getLang("sharetofriend")+"</a>"),o.type=="file"&&s.push('<li><a menu-style="download" href="'+e.getDownloadUrl(o.fileId)+'">'+Resources.download+"</a>")}else s=[];j(t.e,s.join(""),i,t.view)}function k(){m.hide(),v.show()}function L(){var t=[],n=e.getSelectedFiles("LI"),r=n.length;switch(r){case 1:var i=n[0];t.push('<li class="operate"><button data-ca="operate-deloutlink" class="btn" menu-style="deloutlink">'+Resources.cancelsharelink+"</button>");break;case 0:break;default:t.push('<li class="operate"><em class="total">'+Resources.seleted+'<span class="selected-file-number">'+r+"</span>"+Resources.item+"</em>",'<li class="operate"><button data-ca="operate-deloutlink" class="btn" menu-style="deloutlink">'+Resources.cancelsharelink+"</button>")}""==t.join("")?y.hide():y.show().html(t.join(""))}function A(t){var r=e.getSelectedFiles("LI"),i=r.length,s=[];if(i==0)s=[];else if(i==1){var o=r[0];s.push('<li><a data-ca="contextmenu-deloutlink" menu-style="deloutlink" href="javascript:void(0)">'+Resources.cancelsharelink+"</a>")}else s.push('<li><a data-ca="contextmenu-deloutlink" menu-style="deloutlink" href="javascript:void(0)">'+Resources.cancelsharelink+"</a>");j(t.e,s.join(""),n,t.view)}function O(){y.hide(),g.show()}function M(){var t=e.getSelectedFiles("RC"),n=t.length,r=[];n==0?r=[]:r.push('<a menu-style="recover" href="javascript:;">'+Resources.recoverFile+"</a>",'<a menu-style="cleanfile" href="javascript:;">'+Resources.deleteFileFromTrash+"</a>"),""==r.join("")?(o.hide(),u.show()):(u.hide(),o.show().find("#recycletopmenuwrap").html(r.join("")))}function _(t){var n=e.getSelectedFiles("RC"),r=n.length,i=[];r==0?i=[]:i.push('<li class="SplitLine">','<li><a menu-style="recover" href="javascript:;">'+Resources.recoverFile+"</a>",'<li><a menu-style="cleanfile" href="javascript:;">'+Resources.deleteFileFromTrash+"</a>"),j(t.e,i.join(""),s,t.view)}function D(){o.hide(),u.show()}function P(){var t=[],n=e.getSelectedFiles("SE"),r=n.length;switch(r){case 1:var i=n[0];i.ftype=="file"&&t.push('<li class="operate"><a class="btn" target="_blank" href="'+e.getDownloadUrl(i.fileId)+'">'+Resources.download+"</a>"),t.push('<li class="operate"><button class="btn" menu-style="openfolder" href="#kp|'+i.parent+'|0">'+e.getLang("openfolder")+"</button>"),i.iscanconvert&&t.push('<li class="operate"><a class="btn" target="_blank" href="'+e.getOnlineViewUrl(i,1)+'">'+Resources.viewonline+"</a>");break;case 0:break;default:t.push('<span class="blue" style="border:0 none;">'+Resources.seleted+r+Resources.item+"</span>",'<a menu-style="deletefile" href="javascript:void(0)">'+Resources["delete"]+"</a>")}""==t.join("")?(h.hide(),c.show()):h.show().html(t.join(""))}function H(t){var n=e.getSelectedFiles("SE"),r=n.length,i=[];switch(r){case 1:file=n[0],file.ftype=="file"?(i.push('<li><a menu-style="download" href="'+e.getDownloadUrl(file.fileid)+'">'+Resources.download+"</a>"),file.iscanconvert&&i.push('<li><a target="_blank" href="'+e.getOnlineViewUrl(file,1)+'">'+Resources.viewonline+"</a>"),i.push('<li><a menu-style="openfolder" href="#kp|'+file.parent+'|0">'+Resources.openfolder+"</a>")):i.push('<li ><a menu-style="openfolder" href="#kp|'+file.fileId+'|0">'+Resources.openfolder+"</a>");break;case 0:break;default:i.push('<li><a menu-style="deletefile" href="javascript:;">'+Resources["delete"]+"</a>")}j(t.e,i.join(""),a,t.view)}function B(){h.hide(),c.show()}function j(e,t,n,r){var i=Util.getRealPosition(e,n.closest(".content")),s=4,o=n.width(),u=n.height(),a=i.width-o-s,f=i.height-u-s,l=i.evtX,c=i.evtY;l=l<a?l:l-o-s,c=c<f?i.relativeY:i.relativeY-u-s,t!==""?typeof r=="undefined"?n.html(t).css({display:"block",top:c,left:l}):n.html(t).css({display:"block",top:c,left:l}):n.css({display:"none"})}function F(n){var r=$(n.target),i=r.attr("menu-style"),s=e.getSelectedFiles("KP");i&&e.notify({type:i,data:{fileList:s}}),t.css({display:"none"})}function I(t){var n=$(t.target),i=n.attr("menu-style"),s=e.getSelectedFiles("TM");i&&e.notify({type:i,data:{fileList:s}}),r.css({display:"none"})}function q(t){var r=$(t.target),i=r.attr("menu-style");i&&e.notify({type:i,data:""}),n.css({display:"none"})}function R(t){var n=$(t.target),r=n.attr("menu-style");r&&e.notify({type:r,data:""}),s.css({display:"none"})}function U(t){var n=$(t.target),r=n.attr("menu-style"),s=e.getSelectedFiles("OU");r&&e.notify({type:r,data:{fileList:s}}),i.css({display:"none"})}function z(){r.css({display:"none"})}function W(){i.css({display:"none"})}function X(){t.css({display:"none"})}function V(){n.css({display:"none"})}function J(){s.css({display:"none"})}function K(){a.css({display:"none"})}function Q(){t.delegate(".dropMenu a","click",$.proxy(F,this)),f.delegate("button","click",$.proxy(F,this)),r.delegate(".dropMenu a","click",$.proxy(I,this)),d.delegate("button","click",$.proxy(I,this)),n.delegate(".dropMenu a","click",$.proxy(q,this)),y.delegate("button","click",$.proxy(q,this)),s.delegate(".dropMenu a","click",$.proxy(R,this)),o.delegate("button","click",$.proxy(R,this)),i.delegate(".dropMenu a","click",$.proxy(U,this)),m.delegate("button","click",$.proxy(U,this))}var t=$("#filemagemenubar"),n=$("#linkmagemenubar"),r=$("#sharemagemenubar"),i=$("#shareoutmenubar"),s=$("#recyclemanagemenubar"),o=$("#recycletopmenu"),u=$("#recycletopdefault"),a=$("#searchmanagemenubar"),f=$("#kptopmenu"),l=$("#kptopdefault"),c=$("#searchtopdefault"),h=$("#searchtopmenu"),p=$("#sharetmtopdefault"),d=$("#sharetmtopmenu"),v=$("#shareouttopdefault"),m=$("#shareouttopmenu"),g=$("#linktopdefault"),y=$("#linktopmenu");return{init:function(){Q(),e.listen("fileview-kp-contectmenu",w),e.listen("fileview-kp-topmenu",b),e.listen("fileview-kp-showdefaultmenu",E),e.listen("fileview-menuhide",X),e.listen("fileview-linkmange-menuopen",L),e.listen("fileview-link-contentmenu",A),e.listen("fileview-linkmenuhide",V),e.listen("fileview-link-showdefaultmenu",O),e.listen("fileview-share-topmenu",S),e.listen("fileview-sharetm-contentmenu",x),e.listen("fileview-sharetm-hidemenu",z),e.listen("fileview-sharetm-showdefaultmenu",T),e.listen("fileview-shareOut-topmenu",N),e.listen("fileview-shareout-contentmenu",C),e.listen("fileview-shareout-hiedemenu",W),e.listen("fileview-shareout-showdefaultmenu",k),e.listen("fileview-recycle-topmenu",M),e.listen("fileview-recycle-contentmenu",_),e.listen("fileview-recyclemenuhide",J),e.listen("fileview-recycle-showdefaultmenu",D),e.listen("fileview-search-contentmenu",H),e.listen("fileview-search-topmenu",P),e.listen("fileview-searchmenuhide",K),e.listen("fileview-search-showdefaultmenu",B)},destroy:function(){}}})}),"use strict",define("module/fileview/share",["common/core/core"],function(){KP.Core.register("fileview-share",function(e){function v(){t.delegate("nav li","click",m),t.delegate("#get-share-link","click",T),t.delegate("#share-email-input","focusin",M),t.delegate("#share-email-input","focusout",_),t.delegate("#share-email-input","keyup",D),t.delegate(".add-sharer","click",A),t.delegate(".select-sharer","click",E),t.delegate(".share-member-list button","click",q),t.delegate(".more","click",W)}function m(e){"share-friends-tab"===e.target.id?y():(g(),b())}function g(){var e=$("#share-friends-tab"),t=$("#share-trends-tab"),n=$("#share-friends"),r=$("#share-trends");t.addClass("selected"),e.removeClass("selected"),n.hide(),r.show()}function y(){var e=$("#share-friends-tab"),t=$("#share-trends-tab"),n=$("#share-friends"),r=$("#share-trends");e.addClass("selected"),t.removeClass("selected"),r.hide(),n.show()}function b(){$("#share-trends-tab span").hide()}function w(e){$("#share-trends-tab span").text(e).show()}function E(){selectUserAndShare.init({file:a,sharers:r,panel:u,callback:N})}function S(){if($("#share:visible").length===0){var t=[];p===u&&t.push({id:"close-share","class":"btn",text:"解散协作",click:function(){U()}}),t.push({text:"关闭","class":"btn",click:function(){p===u&&e.notify({type:"share-ok",data:e.getHashStatus()}),$(this).dialog("close")}}),$("#share").dialog({dialogClass:"shareDialog",title:'和好友协作 <em class="em">'+Util.formateSubStr(Util.getFileObj(a).name,35,6)+"</em>",modal:!0,open:function(){$("#share-link").blur()},beforeClose:x,buttons:t})}}function x(){y(),$("#share-link").val(""),$("#copy-share-link").remove(),$("#get-share-link").remove(),$("#copy-plugin").remove(),t.find(".share-member-list").html(""),j(),$(".share-history-container > ul").empty(),o=0}function T(){var e=$("#get-share-link");p===u&&$.post("http://www.kuaipan.cn/share_createshareref.htm",{fileId:Util.getFileObj(a).fileId},function(t){var n=t.result.shareRef,r;if("ok"===t.status){r="http://www.kuaipan.cn/share.htm?s="+n;var i='<button id="copy-share-link" class="copy-share-link btn btn2">复制</button>';$("#share-link").val(r),e.replaceWith(i),z(r),KP.fileManagement.fileList&&KP.fileManagement.fileThumbnail&&(KP.fileManagement.fileList.addCooperateSuccess(Util.getFileObj(a).fileId),KP.fileManagement.fileThumbnail.addCooperateSuccess(Util.getFileObj(a).fileId)),Model.updateCooperateInfo(Util.getFileObj(a).fileId,!0)}},"json")}function N(e){var t="http://www.kuaipan.cn/share_getsharerbyfileid.htm";$.post(t,{fileId:Util.getFileObj(a).fileId},function(t){if("ok"===t.status||d===u){if(!t.result.file)return;C(t.result.file.sharer),e&&(S(),W(),k(t.result.shareRef),r=t.result.file.sharer)}else B()},"json")}function C(e){var n=0,r,s,o,a,f=[];L(e),i=[],e=$.isArray(e)?e:[e],r=e.length;for(;n<r;n++)s=e[n],s.nickname!==""&&!$.isArray(s.nickname)?o=s.nickname:s.email!==""&&!$.isArray(s.email)?o=s.email:s.mobile!==""&&!$.isArray(s.mobile)?o=s.mobile:o=s.passport,s.email!==""&&!$.isArray(s.email)?a=s.email:s.mobile!==""&&!$.isArray(s.mobile)&&(a=s.mobile),f.push('<li title="'+o+'">'),p===u&&f.push('<button data-email="'+a+'"></button>'),f.push("<p>"+Util.formateSubStr(o,60,6)),i.push(a);t.find(".share-member-number").text(e.length),t.find(".share-member-list").html(f.join(""))}function k(e){var n=$('<button id="get-share-link" class="btn btn2">获取链接</button>'),r=$('<button id="copy-share-link" class="copy-share-link btn btn2">复制</button>');t.find(".copy-share-link").length===0&&(""===e?($("#share-link").val("点击右侧按钮获取协作链接").click(function(){$(this).val("")}).blur(function(){$(this).val()===""&&$(this).val("点击右侧按钮获取协作链接")}),t.find(".share-link-form").append(n),d===u&&($("#share-link").val("链接未开启，请联系文件夹主人"),n.addClass("btn_disable").attr("disabled",!0))):(e="http://www.kuaipan.cn/share.htm?s="+e,$("#share-link").val(e),t.find(".share-link-form").append(r),z(e)))}function L(e){0===e.length?$("#close-share").button({disabled:!0}):$("#close-share").button({disabled:!1})}function A(){var e="http://www.kuaipan.cn/share_sharefile.htm",t=$("#share-email-input").val();P(t)&&n.length>0&&$.post(e,{fileId:Util.getFileObj(a).fileId,acttype:"add",sharers:n,msg:""},function(e){"ok"===e.status?(N(),O(e.result.users)):"shared"===e.status&&B()},"json")}function O(e){var t=0,r,i=[];e=$.isArray(e)?e:[e],r=e.length;for(;t<r;t++)if("ok"!==e[t].result){var s="";switch(e[t].result){case"accountNotMatch":s="您的帐号未注册";break;case"forbidden":s="不能共享给自己";break;case"overSpace":s="被邀请人空间不足。";break;default:s="邀请失败"}H(s),i.push(e[t].userName)}0===i.length?j():($("#share-email-input").val(i.join(";")).css({color:"red"}),n=[])}function M(){var e=$(this).val();$(this).css({color:"#666"}),l===e&&$(this).val("")}function _(){var e=$(this).val();""===e?$(this).val(l):P(e)}function D(e){var t=$(this).val();if(13===e.which)return t.slice(-1)!==";"&&$(this).val(t+";"),!1}function P(e){var t=e.replace(/;$/,"").split(";"),r=0,o=t.length;s=[];if(l===e)return n=[],!1;for(;r<o;r++){if(!/^1[3|4|5|8][0-9]{9}$/i.test(t[r])){if(!/^[\w\-\.]+@[\w\-\.]+(\.\w+)+$/i.test(t[r]))return H("您输入的格式有误"),!1;if(t[r].length>64)return H("邮箱超过64个字符"),!1}if(-1!==$.inArray(t[r],i))return H("好友已在列表中"),!1;n.push(t[r])}return!0}function H(e){$("#error-input-tip").text(e).show(),setTimeout(function(){$("#error-input-tip").hide()},5e3)}function B(){var e="<p>该文件夹的子目录或父目录已经协作给好友，请重新修改协作目录。</p>";$(e).dialog({title:"协作操作失败",width:280,buttons:[{text:"确定","class":"btn-blue small-btn",click:function(){$(this).dialog("close")}}]})}function j(){n=[],$("#share-email-input").val(l).css({color:"#666"}),$("#error-input-tip").hide()}function F(){var e="http://www.kuaipan.cn/share_sharefile.htm";$.post(e,{fileId:Util.getFileObj(a).fileId,acttype:"empty",sharers:"",msg:""},function(e){"ok"===e.status&&$("#share").dialog("close")},"json")}function I(){var t="http://www.kuaipan.cn/share_closeshareref.htm";$.post(t,{fileId:Util.getFileObj(a).fileId},function(t){"ok"===t.status&&(p===u&&e.notify({type:"share-ok",data:e.getHashStatus()}),$("#share").dialog("close"),KP.fileManagement.fileList&&KP.fileManagement.fileThumbnail&&(KP.fileManagement.fileList.cancelCooperateSuccess(Util.getFileObj(a).fileId),KP.fileManagement.fileThumbnail.cancelCooperateSuccess(Util.getFileObj(a).fileId)),Model.updateCooperateInfo(Util.getFileObj(a).fileId,!1))},"json")}function q(e){var t=$(this).attr("data-email"),n='<h2 class="delete-sharer-h2 mt10">确定要取消对“'+Util.formateSubStr(t,20,6)+"”的共享？</h2>"+'<p class="delete-sharer-p">取消共享后，您和好友无法接收来自对方的更新</p>';$("#dialog-message").html(n),$("#dialog-message").dialog({title:"取消共享",width:420,height:240,buttons:[{text:"确定","class":"btn btn_primary dialog-button-light",click:function(){R(t),$(this).dialog("close")}},{text:"取消","class":"btn dialog-button-dark",click:function(){$(this).dialog("close")}}]})}function R(e){var t="http://www.kuaipan.cn/share_sharefile.htm";$.post(t,{fileId:Util.getFileObj(a).fileId,acttype:"minus",sharers:[e],msg:""},function(e){"ok"===e.status&&N()},"json")}function U(){var e=['<div class="IxMsg IxMsgAsk">','<p class="IxMsgI">','<p class="IxMsgT">确定要解散对好友的共享？','<p class="IxMsgC">解散共享后，您和好友将无法接受来自对方的更新，您仍然可以再次共享给其他好友',"</div>"].join("");$("#dialog-message").html(e),$("#dialog-message").dialog({dialogClass:"prompt",title:"解散共享",buttons:[{text:"取消","class":"btn",click:function(){$(this).dialog("close")}},{text:"确定","class":"btn btn_primary",click:function(){F(),I(),$(this).dialog("close")}}]})}function z(e){var t,n;if(!window.clipboardData){t=new ZeroClipboard.Client,ZeroClipboard.setMoviePath(CONST.StaticSrcHost+"javascript/extends/zeroclipboard/zeroclipboard.swf"),t.setText(e);var r=$("#copy-share-link"),i=r.position();n='<div id="copy-plugin" style="position: absolute; left:'+i.left+"px; top:"+i.top+'px">'+t.getHTML(56,32)+"</div>",$(".share-link-form").append(n),t.addEventListener("onMouseOver",function(){$("#copy-share-link").text("复制")}),t.addEventListener("onComplete",function(){$("#copy-share-link").text("复制成功")})}else $("#copy-share-link").click(function(){window.clipboardData.clearData(),window.clipboardData.setData("Text",e),$(this).text("复制成功")}).mouseover(function(){$(this).text("复制")})}function W(){var e="http://www.kuaipan.cn/share_getsinglesharehistory.htm";$.post(e,{fileId:Util.getFileObj(a).fileId,timestamp:"",size:o+h},function(e){var t=e.result.shares.ops;"ok"===e.status&&(Q(t),G(t),X(t))},"json")}function X(e){var n=[],r=0,i,s,u,a=t.find(".share-history-container > ul");e=e.slice(o),o+=e.length,J(e),a.find("li").length>0&&(e=V(e)),s=e.length;for(;r<s;r++){i=0,n.push('<li class="share-history-time">'),n.push('<h3 data-date="'+e[r][0].modTime+'" data-number="'+e[r].length+'">'+Z(e[r][0].modTime)+'(<span class="record-number">'+e[r].length+"</span>)</h3>"),n.push("<ul>");for(;i<e[r].length;i++)n.push('<li class="share-history-record">'),n.push('<span class="time">'+Y(e[r][i].modTime)+"</span>"),n.push('<span class="username">'+e[r][i].nickname+"</span>"),n.push('<span class="operate">'+et(e[r][i].operation,e[r][i].name)+"</span>"),n.push("</li>");n.push("</ul>"),n.push("</li>")}a.append(n.join(""))}function V(e){var n=t.find(".share-history-time:last"),r=n.find("h3").attr("data-date"),i=n.find("h3").attr("data-number"),s=0,o=e[0].length,u=[];if(Z(e[0][0].modTime)===Z(r)){for(;s<o;s++)u.push('<li class="share-history-record">'),u.push('<span class="time">'+Y(e[0][s].modTime)+"</span>"),u.push('<span class="username">'+e[0][s].nickname+"</span>"),u.push('<span class="operate">'+et(e[0][s].operation,e[0][s].name)+"</span>"),u.push("</li>");n.find("ul").append(u.join("")),n.find("h3 span").text(parseInt(i,10)+o),n.find("h3").attr("data-number",parseInt(i,10)+o),e=e.slice(1)}return e}function J(e){var t=0,n,r;if(e&&$.isArray(e)){r=e.length;for(;t<r;t++){e[t]=[e[t]],n=t+1;for(;n<r;n++)K(e[t][0].modTime,e[n].modTime)&&(e[t].push(e[n]),e.splice(n,1),r=e.length,n-=1)}}}function K(e,t){return e.split(" ")[0]===t.split(" ")[0]?!0:!1}function Q(e){var t,n;$.isArray(e)&&(t=e.length,t===o+h?n=t+"+":n=t,$("#share-trends h2 span").text(n))}function G(e){e.length===o+h?t.find(".more").show():t.find(".more").hide()}function Y(e){return e.match(/\d\d:\d\d/)[0]}function Z(e){return e.split(" ")[0]}function et(e,t){var n={};return n.add="增加了文件",n.join="加入协作",n.cancel="被取消了协作",n["delete"]="删除了文件",n.exit="退出了协作",n.modify="修改了文件",n[e]}function tt(){var t=e.getCommonDialog();t.html('<span class="ico-type info-alert b">'+e.getLang("sharebindemailnotice")+"</span>"),t.dialog({width:400,title:e.getLang("shareyoushouldbindemail"),buttons:[{text:e.getLang("绑定账号"),"class":"small-btn btn-blue",click:function(){location.href="/personal.htm?merge=1",$(this).dialog("close")}},{text:e.getLang("取消"),"class":"small-btn",click:function(){$(this).dialog("close")}}]})}function nt(){var t=e.getHashStatus();t.search(/kp/)!==-1||""===t||t==="#"?u=p:u=d}function rt(e){a=e,nt(),!$.isArray(CONST.umail)&&CONST.umail!==""||!$.isArray(CONST.umobi)&&CONST.umobi!==""?N(!0):tt()}var t=$("#share"),n=[],r=[],i=[],s=[],o=0,u,a,f,l="多个邮箱或手机号用;隔开",c="",h=200,p="MAIN_PANEL",d="SHARED_TO_ME_PANEL";return v(),{init:function(){e.listen("sharefile",rt,this)},start:rt,destroy:function(){}}}),function(){function t(){e.dialog({title:'您共有<em class="em3">0</em>条协作动态',width:535,modal:!0,buttons:[{text:"关闭","class":"btn",click:function(){$(this).dialog("close")}}]})}function n(){}function r(){var e="http://www.kuaipan.cn/share_getallsharehistory.htm";$.post(e,{size:10},function(e){var t=[],n=0,r;if("ok"===e.status){r=e.result.shares;for(;n<r.length;n++)t=t.concat(r[n].ops);c(t.length),o(t),i(t),u(t)}},"json")}function i(e){var t=0,n,r;if(e&&$.isArray(e)){r=e.length;for(;t<r;t++){e[t]=[e[t]],n=t+1;for(;n<r;n++)s(e[t][0].modTime,e[n].modTime)&&(e[t].push(e[n]),e.splice(n,1),r=e.length,n-=1)}}}function s(e,t){return e.split(" ")[0]===t.split(" ")[0]?!0:!1}function o(e){var t=0,n,r,i=e.length;for(;t<i;t++){n=t+1;for(;n<i;n++)e[t].modTime<e[n].modTime&&(r=e[n],e[n]=e[t],e[t]=r)}}function u(e){var t=$("#all-share-file-trends .container > ul"),n=a(e);t.html(n)}function a(e){var t=0,n,r=e.length,i=[];for(;t<r;t++){n=0,i.push('<li class="time-range">'),i.push('<h3><i class="i i8"></i>'+l(e[t][0].modTime)+"（<span>"+e[t].length+"</span>）</h3>"),i.push('<ul class="time-range-container">');for(;n<e[t].length;n++)i.push("<li>"),i.push('<span class="time">'+f(e[t][n].modTime)+"</span>"),i.push('<span class="username">'+Util.formateSubStr(e[t][n].nickname,22,0)+"</span>"),i.push('<span class="operate">'+h(e[t][n].operation)+"</span>"),i.push('<span class="fileName" title="'+e[t][n].name+'">'+Util.formateSubStr(e[t][n].name,26,0)+"</span>"),i.push("</li>");i.push("</ul>"),i.push("</li>")}return i.join("")}function f(e){return e.match(/\d\d:\d\d/)[0]}function l(e){return e.split(" ")[0]}function c(t){e.prev(".ui-dialog-titlebar").find(".ui-dialog-title .em3").text(t)}function h(e,t){var n={};return n.add="增加了文件",n.join="加入协作",n.cancel="被取消了协作",n["delete"]="删除了文件",n.exit="退出了协作",n.modify="修改了文件",n[e]}function p(){r(),t()}var e=$("#all-share-file-trends");$(".check-all-trends").click(p)}()}),"use strict",define("module/fileview/exitshare",["common/core/core"],function(){KP.Core.register("fileview-exitshare",function(e){function o(){n=e.getHashStatus();var r=e.getSelectedFiles("TM"),i=r.length,o=[];for(var u=0;u<i;u++)o.push(r[u].fileId);$.ajax({url:s,dataType:"json",type:"post",data:{fileId:o},success:function(t){e.notify({type:"loading_showstatus",data:{type:"ok",msg:e.getLang("ExitShareOk")}}),e.notify({type:"exitshare-ok",data:n})}}),t.dialog("close")}function u(){var n=e.getSelectedFiles("TM"),r=n.length,i=e.getLang("ExitShareMsg");t.html(['<div class="IxMsg IxMsgAsk">','<p class="IxMsgI">','<p class="IxMsgT">'+i.replace("$1",'<em class="em2"> '+r+" </em>"),"</div>"].join("")).dialog({width:400,title:e.getLang("exitShareTm"),modal:!0,buttons:[{text:e.getLang("cancel"),"class":"btn",click:function(){$(this).dialog("close")}},{text:e.getLang("confirm"),"class":"btn btn_primary",click:$.proxy(o,this)}]})}function a(){n=e.getHashStatus(),$.ajax({url:i,dataType:"json",type:"post",data:{fileId:r.fileId},success:function(t){e.notify({type:"loading_showstatus",data:{type:"ok",msg:e.getLang("cancelallshareok")}}),e.notify({type:"cancelshare-ok",data:n})}}),t.dialog("close")}function f(n){r=n;var i=e.getLang("cancelShareMsg");t.html('<span class="ico-type info-ask">'+i.replace("$1",n.name)+"</span>").dialog({width:"400",title:e.getLang("cancelsharetofriend"),modal:!0,buttons:[{text:e.getLang("confirm"),"class":"small-btn btn-blue",click:$.proxy(a,this)},{text:e.getLang("cancel"),"class":"small-btn",click:function(){$(this).dialog("close")}}]})}var t=e.getCommonDialog(),n="#rc|0|0",r={},i="/index.php?ac=home&op=cancelshare",s="/index.php?ac=home&op=exitshare";return{init:function(){e.listen("exitshare",u,this),e.listen("cancelshare",f,this)},destroy:function(){}}})}),"use strict",define("module/fileview/sharemove",["common/core/core"],function(){KP.Core.register("fileview-sharemove",function(e){function s(){var t=$("#treeroot").tree("getSelected"),i=t.id;e.notify({type:"loading_showstatus",data:{type:"ok",msg:"共享迁移处理中……"}}),$.ajax({url:n,data:{fileIdList:r,destId:i},dataType:"json",type:"post",success:function(t){t&&"ok"===t.status?e.notify({type:"loading_showstatus",data:{type:"ok",msg:"共享迁移处理成功"}}):e.notify({type:"loading_showstatus",data:{type:"alert",msg:"共享迁移处理失败"}}),e.notify({type:"location-hash-isshare",data:e.getHashStatus()})}}),$("#movebox").dialog("close")}function o(){$("#sharemovewrap").dialog("close"),$("#treeroot").tree({animate:!1,url:"/index.php?ac=fileview_handler&op=getdir",onClick:function(e){$("#treeroot").tree("toggle",e.target),$("#movebtn").button("enable").addClass("btn-blue")}}),$("#movebox").dialog({width:550,title:"请选择保存位置",modal:!0,buttons:[{id:"movebtn",text:e.getLang("confirm"),"class":"small-btn",disabled:!0,click:$.proxy(s,this)},{text:e.getLang("cancel"),"class":"small-btn",click:function(){$(this).dialog("close")}}]})}function u(){$("#sharemovewrap").dialog({title:"共享升级提示",modal:!0,width:"550",height:"400",buttons:[{text:"立即保存","class":"btn-blue",click:$.proxy(o,this)}]})}function a(){r=[],$.ajax({url:t,dataType:"json",success:function(e){if(e&&"ok"===e.status){var t=e.result.users,n=t.length;if(n>0){var i=0,s,o,a=['<p class="mb10 b">为提供更好的共享服务，快盘2.0对共享规则做了优化，单个文件将不支持共享</p>'];a.push("<p>以下为您接收到的单个共享文件，为了避免数据丢失，请您保存到您的快盘</p>"),a.push('<div class="save-sharelist"><h2 class="f12"><span class="dib" style="width:320px;">文件名</span><span >共享人</span></h2><ul>');for(;i<n;i++){s=t[i],o=s.file;for(var f=0,l=o.length;f<l;f++)r.push(o[f].fileId),a.push('<li><span class="dib" style="width:313px;">',o[f].name,'</span><span class="dib">',s.email,"</span></li>")}$("#sharemovewrap").html(a.join("")),a.push("</ul></div>"),u()}}}})}function f(){var e='<div class="dn" id="sharemovewrap"></div>';$(document.body).append(e)}var t="/share_listlegacyshare.htm",n="/share_migratelegacyshare.htm",r=[],i="";return{init:function(){f(),e.listen("location-hash-isshare",a,this)}}})}),"use strict",define("module/fileview/outlinkfile",["common/core/core"],function(){KP.Core.register("fileview-outlinkfile",function(e){function b(){e.request("/index.php?ac=outlink&op=deleteOutlink","post","json",{fileId:[g.fileId]},function(t){var n=t[0].result||"error",r;r='<span class="ico-type info-yes b">'+e.getLang("cancelsharelinkSuccess")+"</span>",y.html(r).dialog({width:"400",title:e.getLang("cancelsharelink"),modal:!0,buttons:[{text:e.getLang("close"),"class":"small-btn btn-blue",click:function(){$(this).dialog("close")}}]})})}function w(t){var n=$("#"+t.id),r=n.outerWidth(),i=n.outerHeight(),s=n.parent(),o=$("<div></div>");ZeroClipboard.setMoviePath(e.getStaticSrcHost()+"javascript/extends/zeroclipboard/zeroclipboard.swf");var u=new ZeroClipboard.Client;u.setText(t.text),html=u.getHTML(r,i),o.html(html).css({position:"absolute",top:t.top,left:t.left}),s.append(o),u.addEventListener("complete",function(e,t){alert("复制地址成功")})}function E(n){var r=n.result,i=n.apiresult,s=n.pickupcode,o=n.fileId,d=n.code,v="文件名："+g.name+", 访问地址："+e.getOutLinkUrl(o);if(r&&"CheckCodeError"!=r)t.dialog("close"),h.val(e.getOutLinkUrl(o)),p.attr("href",e.getOutLinkUrl(o)),i=="ok"&&"no"==s?(f.html(""),a.hide(),c.show(),l.hide(),u.dialog({title:e.getLang("generatesharelink"),width:520,modal:!0,buttons:[{text:e.getLang("outlinkmange"),"class":"small-btn",width:"100px",click:function(){location.hash="#li|0|0",$(this).dialog("close")}},{text:e.getLang("cancelsharelink"),"class":"small-btn",click:function(){b(),$(this).dialog("close")}},{text:e.getLang("close"),"class":"small-btn btn-blue",click:function(){$(this).dialog("close")}}],open:function(){w({id:"copyShareLink",text:v,top:"0px",left:"340px"}),$(this).parent().find('.ui-dialog-buttonpane button:contains("'+e.getLang("outlinkmange")+'")').css({"margin-right":"190px"})},close:function(){clip.destroy()}})):(v+=",访问密码："+d,f.html(d),a.show(),l.show(),c.hide(),u.dialog({title:e.getLang("generatesharelink"),width:520,modal:!0,buttons:[{text:e.getLang("outlinkmange"),"class":"small-btn",width:"100px",click:function(){location.hash="#li|0|0",$(this).dialog("close")}},{text:e.getLang("cancelsharelink"),"class":"small-btn",click:function(){b(),$(this).dialog("close")}},{text:e.getLang("close"),"class":"small-btn btn-blue",click:function(){$(this).dialog("close")}}],open:function(){w({id:"copyShareLink",text:v,top:"0px",left:"340px"}),$(this).parent().find('.ui-dialog-buttonpane button:contains("'+e.getLang("outlinkmange")+'")').css({"margin-right":"190px"})}}));else{t.dialog("close");var m='<span class="ico-type info-alert b">'+e.getLang(i)+"</span>";y.html(m).dialog({width:"400",title:"生成分享链接失败",modal:!0,buttons:[{text:e.getLang("close"),"class":"small-btn btn-blue",click:function(){$(this).dialog("close")}}]})}}function S(){var e=g,t=i.val(),n=s.attr("checked")?"yes":"no";$.ajax({url:"/index.php?ac=home&op=publishoutlink",type:"post",dataType:"json",data:{fileId:e.fileId,fileType:e.type,pickupcode:n,checkcode:t},success:function(e){E(e)}})}function x(e){g=e,$.ajax({url:m,dataType:"json",type:"post",data:{olid:g.fileId},success:function(e){T(e)}})}function T(n){var s=n.xLive_attr.result,u,a=g.fileId,f,l="文件名："+g.name+", 访问地址："+e.getOutLinkUrl(a),c=e.getLang("generatesharelink")+" — "+e.formatFileName(g.name,25,3);switch(s){case"ok":u=n.xLive.pickupCode,u.length>0?(l+=", 访问密码:"+u,$("#sharelinkspwd").show(),$("#accesspwd").html(u),$("#cancelPwd").show(),$("#genPwd").hide()):($("#sharelinkspwd").hide(),$("#cancelPwd").hide(),$("#genPwd").show()),f=e.getOutLinkUrl(a),o.attr("href",f),d.val(f),r.dialog({title:c,width:500,modal:!0,buttons:[{text:e.getLang("cancelsharelink"),"class":"small-btn",click:function(){b(),$(this).dialog("close")}},{text:e.getLang("close"),"class":"small-btn btn-blue",click:function(){$(this).dialog("close")}}],open:function(){w({id:"copylink",text:l,top:"0px",left:"340px"}),$(this).parent().find(".ui-dialog-buttonpane button").addClass("small-btn")}});break;case"PSA_DB_OUTLINKS_NOT_EXISTS":default:n&&n.needcheckcode?$("#needcheckcodewrap").hide():($("#needcheckcodewrap").show(),N(),i.val("")),t.dialog({width:500,title:c,modal:!0,buttons:[{text:e.getLang("generatesharelink"),width:"100px","class":"small-btn btn-blue",click:$.proxy(S,this)},{text:e.getLang("cancel"),"class":"small-btn",click:function(){$(this).dialog("close")}}]})}}function N(){window.setTimeout(function(){n.attr("src","/index.php?ac=checkcode&t="+(new Date).getTime())},0)}function C(e){e&&e.result&&e.apiresult=="ok"&&(f.html(e.pickupcode),a.show(),l.show(),c.hide())}function k(e){e&&e.result&&e.apiresult=="ok"&&e.pickupcode=="no"&&(f.html(""),a.hide(),c.show(),l.hide())}function L(){var e=g,t="yes";$.ajax({url:"/index.php?ac=home&op=republishoutlink",type:"post",dataType:"json",data:{fileId:e.fileId,pickupcode:t,fileType:e.type},success:C})}function A(){var e=g,t="no";$.ajax({url:"/index.php?ac=home&op=republishoutlink",type:"post",dataType:"json",data:{fileId:e.fileId,pickupcode:t,fileType:e.type},success:k})}function O(){var e=g,t="no";$.ajax({url:"/index.php?ac=home&op=republishoutlink",type:"post",dataType:"json",data:{fileId:e.fileId,pickupcode:t,fileType:e.type},success:function(e){e&&e.result&&e.apiresult=="ok"&&e.pickupcode=="no"&&($("#sharelinkspwd").hide(),$("#cancelPwd").hide(),$("#genPwd").show())}})}function M(){var e=g,t="yes";$.ajax({url:"/index.php?ac=home&op=republishoutlink",type:"post",dataType:"json",data:{fileId:e.fileId,pickupcode:t,fileType:e.type},success:function(e){e&&e.result&&e.apiresult=="ok"&&($("#accesspwd").html(e.pickupcode),$("#sharelinkspwd").show(),$("#cancelPwd").show(),$("#genPwd").hide())}})}function _(){t.delegate("#changePinCode","click",N),u.delegate("#generatePwd","click",$.proxy(L,this)),u.delegate("#canclePwd","click",$.proxy(A,this)),r.delegate("#cancelPwd","click",$.proxy(O,this)),r.delegate("#genPwd","click",$.proxy(M,this))}var t=$("#sharebox"),n=$("#pinCodeImg"),r=$("#sharelinkbox"),i=$("#pinCode"),s=$("#pwdRequired"),o=$("#viewsharelinks"),u=$("#shareResultBox"),a=$("#pwd-mod-b"),f=$("#shareAccessPwd"),l=$("#canclePwd"),c=$("#generatePwd"),h=$("#sharelink"),p=$("#viewthislink"),d=$("#sharelinks"),v=$("#copyShareLink"),m="/index.php?ac=home&op=filepickupcode",g,y=e.getCommonDialog();return{init:function(){_()},start:x,destroy:function(){},hidePanel:function(){boxWrapObj.hide()}}})}),"use strict",define("module/fileview/deloutlink",["common/core/core"],function(){KP.Core.register("fileview-deloutlink",function(e){function t(){var t=$("#linkmanagebox").data("delOutLinkDialog"),n=e.getSelectedFiles("LI"),r=0,i,s=n.length,o=[];for(;r<s;r++)i=n[r],o.push(i.fileId);e.request("/index.php?ac=outlink&op=deleteOutlink","post","json",{fileId:o},function(n){t.hide(),t.element.find(".btn_primary").removeClass("btn_pending").prop("disabled",!1),e.notify({type:"loading_showstatus",data:{type:"ok",msg:e.getLang("cancelsharelinkSuccess")}}),e.notify({type:"deloutlink-ok",data:e.getHashStatus()})})}function n(){var t=['<div class="dialogT">提示</div>','<div class="dialogC">','<div class="IxMsg IxMsgAsk">','<p class="IxMsgI">','<p class="IxMsgT">您确定要取消这 '+e.getSelectedFiles("LI").length+" 个分享链接吗？","</div>","</div>",'<div class="dialogB btns2">','<button class="btn btn_cancel">取消</button><button class="btn btn_primary dialog-button-light">确定</button>',"</div>"].join("");return t}function r(){var e=$("#linkmanagebox").data("delOutLinkDialog");if(e){e.show();return}e=new Dialog({html:n()}),e.element.on("click",".btn_primary",function(e){$(e.currentTarget).addClass("btn_pending").prop("disabled",!0),t()}),e.element.on("click",".btn_cancel",function(){e.hide()}),$("#linkmanagebox").data("delOutLinkDialog",e)}return{init:function(){e.listen("deloutlink",r,this)},destroy:function(){},deloutlink:function(){t()}}})}),"use strict",define("module/fileview/onlineview",["common/core/core"],function(){KP.Core.register("fileview-onlineview",function(e){function t(e,t){var n=Common.getImages(t),r=Common.getFileIndexById(n,e.fileId);-1!==r&&ImageViewer.show(r,n)}function n(t){window.open(e.getOnlineViewUrl(t,!0))}function r(r,i){r.isimage?t(r,i):r.iscanconvert?n(r):r.fileId?window.open(e.getDownloadUrl(r.fileId),"downloadiframe"):window.open(e.getDownloadUrl(r.file.fileId),"downloadiframe")}return{init:function(){e.listen("onlineview",r,this)},start:r,destroy:function(){}}})}),"use strict",define("module/fileview/newuser",["common/core/core"],function(){KP.Core.register("fileview-newuser",function(e){function n(){$("#newuserbox").removeClass("tour-thumb").removeClass("tour-mana").addClass("tour-upload").fadeIn("fast"),t="1|0|0",o(t)}function r(){var e=t.split("|");if(e.length==3&&e[1]=="0"){$("#newuserbox").removeClass("tour-upload").removeClass("tour-mana").addClass("tour-thumb").fadeIn("fast");var n=e[2]||"1";t="1|1|"+n,o(t)}}function i(){var e=t.split("|");if(e.length==3&&e[2]=="0"){$("#newuserbox").removeClass("tour-thumb").removeClass("tour-upload").addClass("tour-mana").fadeIn("fast");var n=e[1]||"1";t="1|"+n+"|1",o(t)}}function s(){$.ajax({url:"/index.php?ac=home&op=prop",dataType:"json",data:{action:"get",key:"isnewuser"},type:"post",success:function(e){var r=e.xLive_attr||{result:"ok"},i=r.result||"ok";switch(i){case"targetNotExist":t="0|0|0",n();break;default:var s=e.xLive||{value:"1|1|1"},o=s.value||"1|1|1";t=o}}})}function o(e){$.ajax({url:"/index.php?ac=home&op=prop",dataType:"json",data:{action:"set",key:"isnewuser",value:e},type:"post",success:function(e){}})}function u(){$("#newuserbox").fadeOut("fast")}function a(){window.setTimeout(function(){s()},1e3),$("#newuserclose").click(function(){u()})}var t="1|1|1";return{init:function(){a(),e.listen("location-hash-isfilemanage",u,this),e.listen("location-hash-issearch",u,this),e.listen("location-hash-islink",u,this),e.listen("location-hash-isshare",u,this),e.listen("location-hash-shareout",u,this),e.listen("location-hash-isrecycle",u,this),e.listen("newuser-upload-close",u,this),e.listen("newuser-thumb-guide",r,this),e.listen("newuser-manage-guide",i,this)},destroy:function(){}}})}),"use strict",define("module/fileview/recycle",["common/core/core","common/core/common"],function(e){e.register("fileview-recycle",function(e){function i(){var e;if(!CONST.umail){e=new Dialog({width:300,html:['<div class="dialogT">提示</div>','<div class="dialogC">','<div class="form ep">',"<p>您还没有绑定邮箱，绑定邮箱后即可通过邮箱找回密码。",'<p>您可以去 <a href="http://www.kuaipan.cn/home/personal">账户管理</a> 绑定邮箱。',"</div>","</div>"].join(""),beforeClose:function(){e.destory()}});return}var t=function(){return['<div class="dialogT">忘记密码</div>','<div class="dialogC">','<div class="form ep">',"<p>通过绑定邮箱即可取消回收站密码；点击“确定”发送邮件。","</div>","</div>",'<div class="dialogB btns2">','<button class="btn dialog-button-dark">取消</button><button class="btn btn_primary dialog-button-light">确定</button>',"</div>"].join("")};this.getLoginDialog().hide(),e=new Dialog({width:300,html:t(),beforeClose:function(){e.destory()}});var n=e.element;n.on("click",".dialog-button-light",function(){$.ajax({url:"http://www.kuaipan.cn/recyclebins/sendResetPasswordEmail",type:"POST",success:function(){n.find(".form.ep").append("<p>发送邮件成功，请查收您的邮件即可。"),setTimeout(function(){e.hide()},500)},error:function(){}})}),n.on("click",".dialog-button-dark",function(){e.hide()})}function g(){m=new s(t),n.on("loaded",$.proxy(m.render,m)),n.on("hasSetPassword",a.switchPasswordButton),n.on("needPassword",$.proxy(m.showLogin,m)),n.on("sortFinished",$.proxy(m.updateRender,m)),n.on("recoverFinished",$.proxy(m.recoverFinished,m)),n.on("removeFinished",$.proxy(m.removeFinished,m)),n.on("emptyFinished",$.proxy(m.emptyFinished,m)),n.on("validatePasswordFailed",$.proxy(m.validatePasswordFailed,m)),n.on("validatePasswordSuccess",$.proxy(m.validatePasswordSuccess,m)),n.on("setPasswordSuccess",h.setPasswordSuccess),n.on("setPasswordSuccess",a.switchPasswordButton),n.on("setPasswordFailed",h.setPasswordFailed),n.on("editPasswordFinished",p.editPasswordFinished),n.on("cancelPasswordSuccess",a.switchPasswordButton),n.on("cancelPasswordSuccess",d.cancelPasswordSuccess),n.on("cancelPasswordFailed",d.cancelPasswordFailed),n.on("operateMessage",$.proxy(o.show,o)),m.on("validatePassword",n.validatePassword),m.on("loadMore",n.loadDir),m.on("select",a.updateButton),m.on("render",a.updateEmptyButton),m.on("render",u.updateTitleBar),m.on("recover",f.confirmRecover),m.on("remove",l.confirmRemove),a.on("empty",c.confirmEmpty),a.on("recover",f.confirmRecover),a.on("remove",l.confirmRemove),a.on("setPassword",h.show),a.on("editPassword",p.show),a.on("cancelPassword",d.show),a.on("sort",n.sort),c.on("empty",n.empty),c.on("operateMessage",$.proxy(o.show,o)),l.on("remove",n.remove),l.on("operateMessage",$.proxy(o.show,o)),f.on("recover",n.recover),f.on("operateMessage",$.proxy(o.show,o)),h.on("setPassword",n.setPassword),h.on("operateMessage",$.proxy(o.show,o)),p.on("editPassword",n.editPassword),p.on("operateMessage",$.proxy(o.show,o)),d.on("cancelPassword",n.cancelPassword),d.on("operateMessage",$.proxy(o.show,o))}var t=$("#recyclebox"),n=function(){function o(t){"0"===t?e.trigger("hasSetPassword",!1):e.trigger("hasSetPassword",!0)}function u(e){var t,n=0,r,s,o;r=e.length,s=e[n],t={folderId:[],fileId:[]};for(;n<r;n++)s=e[n],o=Common.getFileByFileId(i,s),"folder"===o.type?t.folderId.push(s):t.fileId.push(s);return t}function a(e){var t=0,n=e.length,r;for(;t<n;t++)for(r=0;r<i.length;r++)i[r].fileId===e[t]&&(i.splice(r,1),delete s[e[t]])}var e={},t=0,r=100,i=[],s={};return $.extend(e,Event),e.loadDir=function(){$.post(Const.RECYCLEBIN_PAGE,{start:t,num:r},function(n){var u=0,a,f;if("ok"===n.status){t=n.data.lastLoadTag,f=n.data.files,a=f.length;var l=[];for(;u<a;u++)s[f[u].fileId]||(l.push(s[f[u].fileId]=f[u]),i.push(f[u]));a<r||"0"===t?e.trigger("loaded",l,i,!0):e.trigger("loaded",l,i,!1)}else"needPassword"===n.status&&e.trigger("needPassword");o(n.hasSetPassword)},"json")},e.sort=function(t){var n=t.direct,r=t.type;i.sort(function(e,t){var i=e[r],s=t[r];return"size"===r&&(i=parseInt(i),s=parseInt(s),e.type==="folder"&&(i=-1),t.type==="folder"&&(s=-1)),"desc"===n?i>=s?-1:1:i>=s?1:-1}),e.trigger("sortFinished")},e.recover=function(t){$.post(Const.RECOVER_RECYCLEBIN,{fileId:t},function(t){var n=0,r=t.length,i={successful:[],failed:[]},s=function(e){var t;switch(e){case"tooManyFiles":t='文件超过8000个，请<a href="mailto:kuaipan@kingsoft.com">联系客服</a>恢复';break;default:t=e}return t?"，原因："+t:""};for(;n<r;n++){var o=t[n].result.r.xLive_attr.result;"ok"===o?i.successful.push(t[n].fileId):i.failed.push({id:t[n].fileId,msg:s(o)})}0===i.failed.length?e.trigger("operateMessage",{type:"success",content:"成功的为您还原"+i.successful.length+"个文件(夹)"}):e.trigger("operateMessage",{type:"fail",content:"已还原"+i.successful.length+"个文件(夹)，失败"+i.failed.length+"个"+i.failed[0].msg,time:4e3}),a(i.successful),e.trigger("recoverFinished",i)},"json")},e.remove=function(t){t=u(t),$.post(Const.REMOVE_RECYCLEBIN,t,function(t){var n=0,r=t.length,i={successful:[],failed:[]};for(;n<r;n++)"ok"===t[n].result?i.successful.push(t[n].fileId):i.failed.push(t[n].fileId);0===i.failed.length?e.trigger("operateMessage",{type:"success",content:"成功的为您彻底删除"+i.successful.length+"个文件(夹)"}):e.trigger("operateMessage",{type:"fail",content:"成功的为您彻底删除"+i.successful.length+"个文件(夹)，失败"+i.failed.length+"个",time:4e3}),a(i.successful),e.trigger("removeFinished",i)},"json")},e.empty=function(){$.post(Const.EMPTY_RECYCLEBIN,{fileId:-1},function(n){"ok"===n.result?(i=[],s={},t=0,e.trigger("operateMessage",{type:"success",content:"成功为您清空回收站"})):e.trigger("operateMessage",{type:"fail",content:"清空回收站失败",time:4e3}),e.trigger("emptyFinished",n)},"json")},e.validatePassword=function(t){$.post(Const.VALIDATE_RECYCLEBIN_PASSWORD,{recyclePwd:t},function(t){"ok"===t.result?(n.trigger("validatePasswordSuccess"),e.loadDir()):e.trigger("validatePasswordFailed")},"json")},e.setPassword=function(t,n){$.post(Const.SET_RECYCLEBIN_PASSWORD,{KPPassword:t,recycleBinPassword:n},function(t){"ok"===t.status?e.trigger("setPasswordSuccess",!0):e.trigger("setPasswordFailed",t.status)},"json")},e.editPassword=function(t,n){$.post(Const.EDIT_RECYCLEBIN_PASSWORD,{oldPassword:t,newPassword:n},function(t){e.trigger("editPasswordFinished",t.status)},"json")},e.cancelPassword=function(t){$.post(Const.CANCEL_RECYCLEBIN_PASSWORD,{password:t},function(t){"ok"===t.status?e.trigger("cancelPasswordSuccess",!1):e.trigger("cancelPasswordFailed",t.status)},"json")},e}(),r=function(){function e(){this.loadFiles=[],this.loadFileIds=[],this.selectedIds=[],this.lastSelectedFileId=null,this.isLoading=!1,this.hasLoadFinished=!1,this.dataShowAreaHeight=null,this.dataAreaHeight=null,$.extend(this,Event)}function t(e){var t=$(e.currentTarget);t.addClass("file-hover")}function n(e){var t=$(e.currentTarget);t.removeClass("file-hover")}function r(e,t){var n=document.documentElement.clientHeight,r=document.documentElement.clientWidth,i=t.top,s=t.left,o=e.find("li").length*31+2,u=82;return i+o>real.height&&(i-=o),s+u>real.width&&(s-=u),{top:i,left:s}}return e.prototype.render=function(e,t,n){var r=this.generateDataHtml(e);this.rootEle.find(".noFile").length>0?this.rootEle.find(".show-data").html(r):this.rootEle.find(".show-data").append(r),this.rootEle.find(".load-more").hide(),this.loadFiles=t,this.loadFileIds=Common.getFileIds(this.loadFiles),this.hasLoadFinished=n,this.isLoading=!1,this.dataShowAreaHeight=this.rootEle.find(".content").height(),this.dataAreaHeight=this.rootEle.find(".data").height(),n&&0===this.loadFiles.length&&this.showEmpty(),this.updateSelectAll(),this.trigger("render",this.loadFiles,n)},e.prototype.updateRender=function(){var e=this.generateDataHtml(this.loadFiles);this.rootEle.find(".show-data").html(e),this.loadFileIds=Common.getFileIds(this.loadFiles),this.selectedIds=[]},e.prototype.showEmpty=function(){var e=this.rootEle.find("thead .checkbox");this.rootEle.find(".show-data").html('<div class="noFile"></div>'),e.removeClass("checkbox_act").addClass("checkbox-forbidden"),this.rootEle.find("thead .name").html('文件名<a class="sort dn" href="javascript:void(0)" sortkey="fname" sorttype="asc">▼</a>')},e.prototype.handleContextmenu=function(e){var t=$(e.currentTarget),n=t.data("file-id")+"",i=this.generateContextmenuHtml(),s=$(".contextmenu");s.html(i),-1===$.inArray(n,this.selectedIds)&&this.selectSingleFile(t);var o=Util.getRealPosition(e,this.rootEle.find(".content")),u=4,a=s.width(),f=s.height(),l=o.width-a-u,c=o.height-f-u,h=o.evtX,p=o.evtY;h=h<l?h:h-a-u,p=p<c?o.relativeY:o.relativeY-f-u;var d={left:h,top:p},v;return v=r(s,d),s.css(v).show(),!1},e.prototype.closeContextmenu=function(e){$(".contextmenu").hide()},e.prototype.selectSingleFile=function(e){var t=e.attr("data-file-id")+"",n=[];$.each(this.selectedIds,function(e,t){n.push(t)}),this.removeSelectedFile(n),this.addSelectedFile(t),this.lastSelectedFileId=t},e.prototype.selectMultiFile=function(e){var t=e.attr("data-file-id")+"";e.hasClass("selected")?this.removeSelectedFile(t):(this.addSelectedFile(t),this.lastSelectedFileId=t)},e.prototype.shiftSelectFile=function(e){var t=e.attr("data-file-id")+"",n=Common.queryFileIdsByRange(this.loadFiles,this.lastSelectedFileId,t);this.addSelectedFile(n)},e.prototype.selectAllFile=function(e){var t=$(e.currentTarget),n=[];t.hasClass("checkbox-forbidden")||(t.hasClass("checkbox_act")?($.each(this.selectedIds,function(e,t){n.push(t)}),this.removeSelectedFile(n),t.removeClass("checkbox_act")):(this.addSelectedFile(this.loadFileIds),t.addClass("checkbox_act")))},e.prototype.updateSelectAll=function(){this.loadFileIds.length===this.selectedIds.length&&this.selectedIds.length!==0?this.rootEle.find("thead .checkbox").addClass("checkbox_act"):this.rootEle.find("thead .checkbox").removeClass("checkbox_act")},e.prototype.updateSelectedFileNumber=function(){var e=this.selectedIds.length,t=this.rootEle.find("thead .name");e>1?t.html('已选择<span class="selected-file-number">'+e+"</span>项"):t.html('文件名<a class="sort dn" href="javascript:void(0)" sortkey="fname" sorttype="asc">▼</a>')},e.prototype.addSelectedFile=function(e){var t=this.selectedIds;e=$.isArray(e)?e:[e],t=t.concat(e),this.selectedIds=Util.unique(t),$.each(e,function(e,t){$("#"+t+"_0").addClass("selected")}),this.updateSelectedFileNumber(),this.trigger("select",this.selectedIds)},e.prototype.removeSelectedFile=function(e){var t=this.selectedIds;e=$.isArray(e)?e:[e],$.each(e,function(e,n){Util.deleteArrayItem(t,n),$("#"+n+"_0").removeClass("selected")}),this.updateSelectedFileNumber(),this.trigger("select",t)},e.prototype.removeFiles=function(e){var t=0,n=e.length,r;this.lastSelectedFileId=null;for(;t<n;t++)r=e[t],Util.deleteArrayItem(this.loadFileIds,r),Util.deleteArrayItem(this.selectedIds,r),$("#"+r+"_0").remove();0===this.loadFiles.length&&this.hasLoadFinished&&this.showEmpty(),this.hasLoadFinished||(this.dataAreaHeight=this.rootEle.find(".data").height(),this.trigger("loadMore")),this.updateSelectedFileNumber(),this.updateSelectAll(),this.trigger("select",this.selectedIds),this.trigger("render",this.loadFiles,this.hasLoadFinished)},e.prototype.emptyAllFile=function(){var e=this.rootEle.find(".show-data");this.loadFiles=[],this.loadFileIds=[],this.selectedIds=[],this.lastSelectedFileId=null,this.hasLoadFinished=!1,e.empty(),this.showEmpty(),this.trigger("select",this.selectedIds),this.trigger("render",[],!0)},e.prototype.handleScroll=function(e){var t=$(e.currentTarget),n=t.scrollTop();!this.hasLoadFinished&&!this.isLoading&&this.dataAreaHeight-n-this.dataShowAreaHeight<=0&&(this.rootEle.find(".load-more").show(),this.trigger("loadMore"),this.isLoading=!0)},e.prototype.bindEvent=function(){this.rootEle.find(".content").on("scroll",$.proxy(this.handleScroll,this)),this.rootEle.on("click","thead .checkbox",$.proxy(this.selectAllFile,this)),this.rootEle.on("mouseenter",".show-data tr",t),this.rootEle.on("mouseleave",".show-data tr",n),this.rootEle.on("contextmenu",".show-data tr",$.proxy(this.handleContextmenu,this)),this.rootEle.on("dblclick",".show-data tr",n)},e}(),s=function(){function e(t){e.superClass.constructor.call(this),this.rootEle=t,e.superClass.bindEvent.call(this),this.bindEvent()}function t(){var e=document.documentElement.clientHeight-207;this.dataShowAreaHeight=e,$(".data-wrap").height(e)}function n(e){var t=e.srcElement||e.target,n=t.nodeName.toLocaleLowerCase(),r=$(e.currentTarget);e.ctrlKey||e.metaKey?this.selectMultiFile(r):e.shiftKey?this.lastSelectedFileId&&this.shiftSelectFile(r):"span"!==n?this.selectSingleFile(r):this.selectMultiFile(r),this.updateSelectAll(),$(".contextmenu").hide()}function s(){this.trigger("recover",this.selectedIds),$(".contextmenu").hide()}function o(){this.trigger("remove",this.selectedIds),$(".contextmenu").hide()}function u(e){var t=this.getLoginDialog().element,n=t.find("input[type=password]"),r=n.val();r.length>=6&&r.length<=32?(this.trigger("validatePassword",r),t.find(".dialog-button-light").val("登录中...")):t.find(".msg").text("请输入6-32位密码")}return Common.inherit(e,r),e.prototype.getLoginDialog=function(){function t(){return['<div class="dialogT">密码提示</div>','<div class="dialogC">','<div class="form ep">','<div class="frm">','<p class="frmT">回收站密码：','<div class="frmC"><input type="password" class="txt"></div>',"</div>",'<div class="frm">','<p class="frmT noVis">忘记密码','<div class="frmC"><button class="forgot-password">忘记密码？</button></div>',"</div>",'<div class="frm"><div class="frmC msg"></div></div>',"</div>","</div>",'<div class="dialogB btns2">','<button class="btn btn_primary dialog-button-light">登录</button>',"</div>"].join("")}var e;return function(){if(!e){e=new Dialog({width:300,html:t()});var n=e.element;n.on("click",".dialog-button-light",$.proxy(u,this)),n.on("click",".forgot-password",$.proxy(i,this))}return e}}(),e.prototype.showLogin=function(){$("#loading").hide(),this.getLoginDialog().show()},e.prototype.loginFinished=function(){},e.prototype.render=function(t,n,r){$("#loading").hide(),$("#login").hide(),this.rootEle.show(),e.superClass.render.call(this,t,n,r)},e.prototype.generateDataHtml=function(e){var t=0,n=e.length,r,r,i,s,o,u=[];for(;t<n;t++)r=e[t],i=Util.getFileIcon(r),s=Util.getFileSize(r),o=Util.formateSubStr(r.name,40,-6),u.push('<tr data-file-id="'+r.fileId+'" id="'+r.fileId+'_0">'),u.push(' <td class="col_cbox select-file"><span class="dib checkbox"></span></td>'),u.push(' <td class="col_fname file-name '+i+'"><i class="i ifl '+Util.getFileIconClassName(r)+'"></i><a href="javascript:void(0)" class="name" title="'+o+'">'+o+"</a></td>"),u.push(' <td class="col_fsize">'+s+"</td>"),u.push(' <td class="col_date">'+r.modTime+"</td>"),u.push("</tr>");return u.join("")},e.prototype.generateContextmenuHtml=function(){var e=[];return e.push('<li><a data-ca="contextmenu-recover" href="javascript:;" class="recover">还原</a></li>'),e.push('<li><a data-ca="contextmenu-remove" href="javascript:;" class="remove">彻底删除</a></li>'),e.join("")},e.prototype.removeFinished=function(e){var t=e.successful;this.removeFiles(t)},e.prototype.emptyFinished=function(e){e&&"ok"===e.result&&this.emptyAllFile()},e.prototype.recoverFinished=function(e){var t=e.successful;this.removeFiles(t)},e.prototype.validatePasswordSuccess=function(){this.getLoginDialog().destory()},e.prototype.validatePasswordFailed=function(){var e=this.getLoginDialog().element;e.find(".msg").text("回收站密码错误，请重新输入"),e.find(".dialog-button-light").val("登录")},e.prototype.bindEvent=function(){this.rootEle.on("click",".show-data tr",$.proxy(n,this)),$("body").on("click",".contextmenu .recover",$.proxy(s,this)),$("body").on("click",".contextmenu .remove",$.proxy(o,this)),$("body").on("click",$.proxy(this.closeContextmenu,this)),$(window).on("resize",$.proxy(t,this))},e}(),o=function(){function i(){r&&clearTimeout(r),e.hide().removeClass("operate-successful-message operate-failed-message operate-loading-message")}function s(){var t=document.documentElement.clientWidth,n=e.width();return(t-n)/2}var e=$("#operate-message"),t={},n={success:"operate-successful-message",fail:"operate-failed-message",loading:"operate-loading-message"},r;return t.show=function(t){var o,u;u=t.time=t.time||2e3,e.css("display")!=="none"&&i(),e.html(t.content).addClass(n[t.type]),o=s(),e.css({left:o}).show(),-1!==u&&(r=setTimeout(function(){e.fadeOut("slow",function(){i()})},u))},t}(),u=function(){var e={},t=$(".title-bar");return e.updateTitleBar=function(e,n){var r=t.find(".loaded");n?r.text("已全部加载，共"+e.length+"个"):r.text("已加载"+e.length+"个")},e}(),a=function(){function s(){$(".sort .dropDown2").show()}function o(){$(".sort .dropDown2").hide()}function a(e){var t,n=[],r={modTime:'<li><a data-ca="sortby-time" href="javascript:void(0)" class="date $sortBy">时间<i class="i $sortIco"></i></a>',size:'<li><a data-ca="sortby-size" href="javascript:void(0)" class="size $sortBy">大小<i class="i $sortIco"></i></a>',name:'<li><a data-ca="sortby-name" href="javascript:void(0)" class="name $sortBy">名称<i class="i $sortIco"></i></a>'};for(t in r){if(e.type==t)continue;n.push(r[t].replace("$sortBy","desc").replace("$sortIco","i2"))}i.find(".sort ul").html(r[e.type].replace("$sortBy",e.direct).replace("$sortIco",u(e.direct))+n.join(""))}function f(t){var n=$(t.currentTarget),r=n.closest(".dropMenu").find("a").get(0),i=n.get(0)==r,s=$(".sort h2"),o=s.find("b"),u=s.find("i.i"),f={};i?n.hasClass("asc")?(f.direct="desc",n.removeClass("asc").addClass("desc"),s.removeClass("desc asc").addClass("desc"),u.removeClass("i2 i3").addClass("i2")):(f.direct="asc",n.removeClass("desc").addClass("asc"),s.removeClass("desc asc").addClass("asc"),u.removeClass("i2 i3").addClass("i3")):(f.direct="desc",s.removeClass("desc asc").addClass("desc"),u.removeClass("i2 i3").addClass("i2")),n.hasClass("name")&&(f.type="name",o.text("名称")),n.hasClass("size")&&(f.type="size",o.text("大小")),n.hasClass("date")&&(f.type="modTime",o.text("时间")),$.proxy(a,e)(f),e.trigger("sort",f),i||$(".sort > .dropDown2").hide()}function l(t){var n=$(t.currentTarget);n.hasClass("btn-fbd")||e.trigger("recover",r)}function c(t){var n=$(t.currentTarget);n.hasClass("btn-fbd")||e.trigger("remove",r)}function h(t){var n=$(t.currentTarget);n.hasClass("btn-fbd")||e.trigger("empty")}function p(){e.trigger("setPassword")}function d(){e.trigger("editPassword")}function v(){e.trigger("cancelPassword")}function m(n){if(t.find(".show-data .noFile").length)return;var r=$(n.currentTarget),i=r.find(".sort").show(),s=i.attr("sorttype");"asc"==s?i.attr("sorttype","desc").html("▲"):i.attr("sorttype","asc").html("▼"),e.trigger("sort",{type:"name",direct:s})}function g(){i.on("click",".recover",l),i.on("click",".remove",c),i.on("click",".empty",h),i.on("click",".set-password",p),i.on("click",".edit-password",d),i.on("click",".cancel-password",v),t.on("click",".mainH2 th:has(.sort)",m),i.on("mouseenter",".sort h2 em",s),i.on("mouseleave",".sort .dropDown2",o),i.on("click",".sort ul a",f)}var e={},n=[],r=[],i=$("#recycle-operatebar");$.extend(e,Event),g(),e.updateButton=function(e){var t=i.find(".remove"),n=i.find(".recover");e.length>0?(t.removeClass("btn-fbd"),n.removeClass("btn-fbd")):(t.addClass("btn-fbd"),n.addClass("btn-fbd")),r=e},e.updateEmptyButton=function(e){var t=i.find(".empty");e.length>0?t.removeClass("btn-fbd"):t.addClass("btn-fbd"),n=e},e.switchPasswordButton=function(e){e?(i.find(".set-password").addClass("noDis"),i.find(".edit-password").removeClass("noDis"),i.find(".cancel-password").removeClass("noDis")):(i.find(".set-password").removeClass("noDis"),i.find(".edit-password").addClass("noDis"),i.find(".cancel-password").addClass("noDis"))};var u=function(e){return e=="asc"?"i3":"i2"};return e}(),f=function(){function i(){t?(t.element.find(".file-number").text(r),t.show()):(t=new Dialog({width:300,html:s()}),o())}function s(){var e=['<div class="dialogT">提示</div>','<div class="dialogC">','<div class="IxMsg IxMsgAsk">','<p class="IxMsgI">','<p class="IxMsgT">您确定要还原这<strong class="file-number">'+r+"</strong>个文件(夹)吗？","</div>","</div>",'<div class="dialogB btns2">','<button class="btn dialog-button-dark">取消</button><button class="btn btn_primary dialog-button-light">确定</button>',"</div>"].join("");return e}function o(){var i=t.element;i.on("click",".dialog-button-dark",function(){t.hide()}),i.on("click",".dialog-button-light",function(){e.trigger("recover",n),e.trigger("operateMessage",{type:"loading",content:'正在努力为您还原<span class="file-number">'+r+"</span>个文件",time:-1}),t.hide()})}var e={},t,n=[],r=0;return $.extend(e,Event),e.confirmRecover=function(e){n=e,r=e.length,i()},e}(),l=function(){function i(){t?(t.element.find(".file-number").text(n),t.show()):(t=new Dialog({width:300,html:s()}),o())}function s(){var e=['<div class="dialogT">删除提示</div>','<div class="dialogC">','<div class="IxMsg IxMsgAsk">','<p class="IxMsgI">','<p class="IxMsgT">您确定要彻底删除这<strong class="file-number">'+n+"</strong>个文件(夹)吗？",'<div class="IxMsgC">删除后将无法找回</div>',"</div>","</div>",'<div class="dialogB btns2">','<button class="btn dialog-button-dark">取消</button><button class="btn btn_primary dialog-button-light">确定</button>',"</div>"].join("");return e}function o(){var i=t.element;i.on("click",".dialog-button-dark",function(){t.hide()}),i.on("click",".dialog-button-light",function(){e.trigger("remove",r),e.trigger("operateMessage",{type:"loading",content:'正在努力为您彻底删除<span class="file-number">'+n+"</span>个文件",time:-1}),t.hide()})}var e={},t,n=0,r=[];return $.extend(e,Event),e.confirmRemove=function(e){n=e.length,r=e,i()},e}(),c=function(){function n(){t?t.show():(t=new Dialog({width:300,html:r()}),i())}function r(){var e=['<div class="dialogT">清空提示</div>','<div class="dialogC">','<div class="IxMsg IxMsgAsk">','<p class="IxMsgI">','<p class="IxMsgT">您确定要清空回收站吗？',"</div>","</div>",'<div class="dialogB btns2">','<button class="btn dialog-button-dark">取消</button><button class="btn btn_primary dialog-button-light">确定</button>',"</div>"].join("");return e}function i(){var n=t.element;n.on("click",".dialog-button-dark",function(){t.hide()}),n.on("click",".dialog-button-light",function(){e.trigger("empty"),e.trigger("operateMessage",{type:"loading",content:"正在努力为您清空回收站",time:-1}),t.hide()})}var e={},t;return $.extend(e,Event),e.confirmEmpty=function(){n()},e}(),h=function(){function n(){var e=r();t=new Dialog({width:300,html:e})}function r(){var e=['<div class="dialogT">设置密码</div>','<div class="dialogC">','<div class="form ep">','<div class="frm">','<p class="frmT">快盘登录密码：','<div class="frmC"><input type="password" class="txt"></div>',"</div>",'<div class="frm">','<p class="frmT">回收站密码：','<div class="frmC"><input type="password" class="txt"></div>',"</div>",'<div class="frm">','<p class="frmT">重复回收站密码：','<div class="frmC"><input type="password" class="txt"></div>',"</div>",'<div class="frm"><div class="frmC msg"></div></div>',"</div>","</div>",'<div class="dialogB btns2">','<button class="btn dialog-button-dark">取消</button><button class="btn btn_primary dialog-button-light">确定</button>',"</div>"].join("");return e}function i(){var e={},n=t.element,r=n.find('input[type="password"]:eq(0)').val(),i=n.find('input[type="password"]:eq(1)').val(),s=n.find('input[type="password"]:eq(2)').val();return e.validate=!0,r.length<6||r.length>32?(e.validate=!1,e.errMsg="请输入6-32位快盘密码",e):i.length<6||i.length>32?(e.validate=!1,e.errMsg="请输入6-32位回收站密码",e):s.length<6||s.length>32?(e.validate=!1,e.errMsg="请重复输入6-32位回收站密码",e):i!==s?(e.validate=!1,e.errMsg="两次输入密码不一致",e):(e.data={},e.data.KPPassword=r,e.data.recycleBinPassword=i,e.data.repeatRecycleBinPassword=s,e)}function s(){var n=i(),r=t.element,s=n.data;n.validate?(e.trigger("setPassword",s.KPPassword,s.recycleBinPassword),r.find(".dialog-button-light").text("正在设置...")):r.find(".msg").text(n.errMsg)}function o(e){s(),e.preventDefault()}function u(){var e=t.element;e.on("click",".dialog-button-dark",function(){t.hide()}),e.on("click",".dialog-button-light",s)}var e={},t;return $.extend(e,Event),e.show=function(){n(),u()},e.hide=function(){},e.setPasswordSuccess=function(){e.trigger("operateMessage",{type:"success",content:"成功为您设置回收站密码"}),t.destory()},e.setPasswordFailed=function(e){var n=t.element;"KPPasswordError"===e&&(n.find(".msg").text("快盘登录密码错误"),n.find(".dialog-button-light").text("确定"))},e}(),p=function(){function n(){var e=r();t=new Dialog({width:300,html:e})}function r(){var e=['<div class="dialogT">修改密码</div>','<div class="dialogC">','<div class="form ep">','<div class="frm">','<p class="frmT">旧回收站密码：','<div class="frmC"><input type="password" class="txt"></div>',"</div>",'<div class="frm">','<p class="frmT">新回收站密码：','<div class="frmC"><input type="password" class="txt"></div>',"</div>",'<div class="frm">','<p class="frmT">重复新密码：','<div class="frmC"><input type="password" class="txt"></div>',"</div>",'<div class="frm"><div class="frmC msg"></div></div>',"</div>","</div>",'<div class="dialogB btns2">','<button class="btn dialog-button-dark">取消</button><button class="btn btn_primary dialog-button-light">确定</button>',"</div>"].join("");return e}function i(){var e={},n=t.element,r=n.find('input[type="password"]:eq(0)').val(),i=n.find('input[type="password"]:eq(1)').val(),s=n.find('input[type="password"]:eq(2)').val();return e.validate=!0,r.length<6||r.length>32?(e.validate=!1,e.errMsg="请输入6-32位旧回收站密码",e):i.length<6||i.length>32?(e.validate=!1,e.errMsg="请输入6-32位新回收站密码",e):s.length<6||s.length>32?(e.validate=!1,e.errMsg="请重复输入6-32位新回收站密码",e):i!==s?(e.validate=!1,e.errMsg="两次输入新密码不一致",e):(e.data={},e.data.oldPassword=r,e.data.newPassword=i,e.data.repeatPassword=s,e)}function s(){var n=i(),r=t.element;n.validate?(e.trigger("editPassword",n.data.oldPassword,n.data.newPassword),r.find(".dialog-button-light").text("正在修改...")):r.find(".msg").text(n.errMsg)}function o(){var e=t.element;e.on("click",".dialog-button-dark",function(){t.hide()}),e.on("click",".dialog-button-light",s)}var e={},t;return $.extend(e,Event),e.show=function(){n(),o()},e.hide=function(){},e.editPasswordFinished=function(n){var r=t.element;"ok"===n?(e.trigger("operateMessage",{type:"success",content:"成功为您修改回收站密码"}),t.destory()):"oldPasswordError"===n&&(r.find(".msg").text("旧回收站密码错误"),r.find(".dialog-button-light").text("确定"))},e}(),d=function(){function n(){var e=r();t=new Dialog({width:300,html:e})}function r(){var e=['<div class="dialogT">取消密码</div>','<div class="dialogC">','<div class="form ep">','<div class="frm">','<p class="frmT">回收站密码：','<div class="frmC"><input type="password" class="txt"></div>',"</div>",'<div class="frm">','<p class="frmT noVis">忘记密码','<div class="frmC"><button class="forgot-password">忘记密码？</button></div>',"</div>",'<div class="frm"><div class="frmC msg"></div></div>',"</div>","</div>",'<div class="dialogB btns2">','<button class="btn dialog-button-dark">取消</button><button class="btn btn_primary dialog-button-light">确定</button>',"</div>"].join("");return e}function s(){var e={},n=t.element,r=n.find('input[type="password"]').val();return e.validate=!0,""===r?(e.validate=!1,e.errMsg="回收站密码不能为空",e):r.length<6||r.length>32?(e.validate=!1,e.errMsg="请输入6-32位新回收站密码",e):(e.data={},e.data.password=r,e)}function o(){var n=s(),r=t.element;n.validate?(e.trigger("cancelPassword",n.data.password),r.find(".dialog-button-light").text("正在取消...")):r.find(".msg").text(n.errMsg)}function u(e){o(),e.preventDefault()}function a(){var e=t.element;e.on("click",".dialog-button-dark",function(){t.hide()}),e.on("click",".dialog-button-light",o),e.on("click",".forgot-password",$.proxy(i,{getLoginDialog:function(){return t}}))}var e={},t;return $.extend(e,Event),e.show=function(){n(),a()},e.hide=function(){},e.cancelPasswordSuccess=function(){e.trigger("operateMessage",{type:"success",content:"成功为您取消回收站密码"}),t.destory()},e.cancelPasswordFailed=function(e){var n=t.element;"passwordError"===e&&(n.find(".msg").text("回收站密码错误"),n.find(".dialog-button-light").text("确定"))},e}(),v=function(){function r(){$.getJSON(Const.GET_USER_INFO_URL,function(t){var n;"ok"===t.xLive_attr.result&&(n=t.xLive,$("#user-name").text(n.nickname),e=n)})}function i(){$.getJSON(Const.GET_USER_SPACE_URL,function(e){var n,r;"ok"===e.xLive_attr.result&&(n=e.xLive,r=n.used/n.total*100,$("#user-space").text(Util.convertByteToMB(n.used)+"/"+Util.convertByteToMB(n.total)),t=n,s(r))})}function s(e){var t=[],n,r=document.getElementById("user-space");t.push("background: -moz-linear-gradient(left,  #b2d9fb 0%, #b2d9fb "+e+"%, #d4e8f6 "+e+"%, #d4e8f6 100%);"),t.push("background: -webkit-gradient(linear, left top, right top, color-stop(0%,#b2d9fb), color-stop("+e+"%,#b2d9fb), color-stop("+e+"%,#d4e8f6), color-stop(100%,#d4e8f6));"),t.push("background: -o-linear-gradient(left,  #b2d9fb 0%,#b2d9fb "+e+"%,#d4e8f6 "+e+"%,#d4e8f6 100%);"),t.push("background: -ms-linear-gradient(left,  #b2d9fb 0%,#b2d9fb "+e+"%,#d4e8f6 "+e+"%,#d4e8f6 100%);"),t.push("background: linear-gradient(to right,  #b2d9fb 0%,#b2d9fb "+e+"%,#d4e8f6 "+e+"%,#d4e8f6 100%);"),n=t.join(""),r.style.cssText=n,-1===r.style.cssText.indexOf("gradient")&&o(e)}function o(){var e=[],n,r=$("#user-space");e.push('<span class="user-space-total">'),e.push('<span class="user-space-used">'),e.push("</span>"),e.push('<span class="user-space-compatible">'),e.push(Util.convertByteToMB(t.used)+"/"+Util.convertByteToMB(t.total)),e.push("</span>"),e.push("</span>"),n=e.join(""),r.replaceWith(n),$(".user-space-used").width(t.used/t.total*122)}var e,t,n={};return n.init=function(){r(),i()},n}(),m,y=!1;return{init:function(){if(y)return;y=!0,g(),e.listen("location-hash-islink",this.hidePanel,this),e.listen("location-hash-issearch",this.hidePanel,this),e.listen("location-hash-isfilemanage",this.hidePanel,this),e.listen("location-hash-shareout",this.hidePanel,this),e.listen("location-hash-isshare",this.hidePanel,this),e.listen("location-hash-isrecycle",this.show,this)},hidePanel:function(){t.hide()},show:function(){n.loadDir(),t.show()},destroy:function(){}}})}),"use strict",define("module/share",["common/core/common"],function(){return window.share=function(){function o(){n.hasPassword.hide(),n.linkInput.val(""),n.createPassword.show(),n.publishSuccess.hide(),n.publishFail.hide(),n.loadingPublish.show()}function u(e){t?(o(),t.show()):(t=new Dialog({width:556,html:l(),beforeClose:U}),a(),z(),ZeroClipboard.setMoviePath(Const.ZERO_CLIPBOARD_URL),U())}function a(){var e=n.rootEle=$("#new-share");n.newShareLink=n.rootEle.find(".new-share-link"),n.loadingPublish=e.find(".new-share-waitting"),n.publishSuccess=e.find(".new-share-successfull"),n.linkInput=e.find(".txt_url"),n.openLink=e.find(".open-link"),n.password=e.find(".new-share-password"),n.hasPassword=e.find(".has-password"),n.noPassword=e.find(".no-password"),n.createPassword=e.find(".create-password"),n.cancelPassword=e.find(".cancel-password"),n.loadingCreatePassword=e.find(".loading-create-password"),n.loadingCancelPassword=e.find(".loading-cancel-password"),n.linkContainer=e.find(".link-container"),n.copySuccess=e.find(".copy-success"),n.publishFail=e.find(".new-share-failed"),n.publishNetworkError=e.find(".network-error"),n.publishRepeatError=e.find(".repeat-error"),n.newShareEmail=e.find(".new-share-email"),n.newShareWeixin=e.find(".new-share-weixin"),n.emailInput=n.newShareEmail.find("input"),n.emailShareContent=n.newShareEmail.find("textarea"),n.shareByEmailButton=n.newShareEmail.find(".share-by-email-button"),n.newShareWeibo=e.find(".new-share-weibo"),n.weiboShareContent=$("#weibo-content"),n.shareByWeiboButton=n.newShareWeibo.find(".share-by-weibo-button")}function f(e){var t=$(e.target),r=t.attr("class").replace(/selected/,"");n.rootEle.find(".new-share-nav a").removeClass("selected"),t.addClass("selected"),n.rootEle.find(".new-share-weixin, .new-share-email, .new-share-weibo").hide(),n.rootEle.find(".new-share-"+r).show()}function l(){var e=['<div class="dialogT">分享给好友</div>','<div class="dialogC" id="new-share">',c(),'<div class="new-share-content noVis">','<p class="ttl">分享到：','<ul class="new-share-nav">','<li><a href="javascript:void(0)" class="weixin">微信</a></li>','<li><a href="javascript:void(0)" class="weibo">微博</a></li>','<li class="noDis"><a href="javascript:void(0)" class="email">邮件</a></li>',"</ul>",h(),d(),"</div>","</div>",'<div class="dialogB">禁止分享包含任何反动、色情、暴力、侵权著作权等违反法律法规内容的文件及副本</div>'].join("");return e}function c(){var e=['<div class="new-share-link">','<p class="ttl new-share-successfull dn">成功获取链接，复制后发送给好友就可以啦！','<p class="ttl new-share-failed dn">获取分享链接失败：<span class="dn network-error">可能遇到网络问题，请点击<a href="javascript:void(0)" class="retry">重试</a></span><span class="dn repeat-error">该文件的父目录（或子目录）已被发布为外链。</span>','<p class="new-share-waitting">正在为您获取链接，请稍候......','<div class="link-container">','<p class="t1">复制链接，分享给好友吧。 <span class="copy-success">复制成功</span>','<p class="t2"><input class="txt txt_url" type="text" value=""><button data-ca="copy-outlink" class="btn btn2 copy-button dialog-button-light">复制</button><a href="javascript:void(0)" class="fuc open-link" target="_blank">查看</a><a data-ca="cancel-outlink" href="javascript:;" class="fuc cancel-sharelink-button">取消外链</a></p>','<p class="t3"><a href="javascript:;" class="fuc create-password">生成访问密码</a><span class="dn loading-create-password">正在为您生成密码...</span><span class="dn loading-cancel-password">正在为您取消密码...</span><span class="dn has-password">访问密码：<span class="new-share-password"></span><a href="javascript:void(0)" class="fuc cancel-password">取消密码</a></span>',"</div>","</div>"].join("");return e}function h(){return['<div class="new-shareC new-share-weixin dn"></div>'].join("")}function p(){var e=['<div class="new-shareC new-share-email dn">','<p class="ttl2">请输入好友邮箱地址： <span class="em2 email-format-error"></span>','<p><input type="text" name="emails" class="txt emails" value="'+Const.DEFAULT_INPUT_TEXT+'">','<p class="ttl2">邮件内容： <span class="em2 email-content-error"></span>','<div class="tarea"><textarea class="email-content" readonly="true"></textarea></div>','<p class="btns2"><button class="btn btn2 share-by-email-button btn_disable" disabled>分享</button>',"</div>"].join("");return e}function d(){var e=['<div class="new-shareC new-share-weibo dn">','<p class="ttl2">将链接分享到新浪微博','<div class="tarea"><textarea id="weibo-content"></textarea></div>','<p class="btns2"><button disabled class="btn btn2 btn_disable share-by-weibo-button">分享到微博</button>',"</div>"].join("");return e}function v(e){$("#new-share .new-share-content").removeClass("noVis"),m(e),x(),N(),k()}function m(e){var t=y(e);e.length>0&&n.password.text(e),n.openLink.attr("href",t),n.linkInput.val(t),w(t)}function g(e){var t=y(e);n.password.text(e),n.linkInput.val(t),n.copySuccess.hide(),s&&s.setText(t)}function y(e){var t="http://www.kuaipan.cn/file/id_"+i.fileId+".htm";return e.length>0&&"no"!==e&&(t=t+" 访问密码："+e),t}function b(e){setTimeout(function(){$(e).hide()},600)}function w(e){var t,r,i=n.rootEle.find(".copy-button");$(".copy-success").hide(),window.clipboardData?i.click(function(){window.clipboardData.clearData(),window.clipboardData.setData("Text",n.linkInput.val()),b($(".copy-success").show())}):(s=new ZeroClipboard.Client,s.setText(e),t=s.getHTML(82,35),r=$(t),r.addClass("sharelink-swf"),i.append(r),s.addEventListener("complete",function(e,t){b($(".copy-success").show())}))}function E(){n.loadingPublish.show(),n.publishSuccess.hide(),n.hasPassword.hide(),n.noPassword.hide(),n.loadingCreatePassword.hide(),n.loadingCancelPassword.hide(),n.createPassword.hide(),n.copySuccess.hide(),n.publishFail.hide(),n.publishNetworkError.hide(),n.publishRepeatError.hide()}function S(){return"http://www.kuaipan.cn/file/id_"+i.fileId+".htm"}function x(){require(["qrcode"],function(){n.newShareWeixin.qrcode({render:window.HTMLCanvasElement?"canvas":"table",width:120,height:120,text:S()})})}function T(){n.newShareWeixin.empty()}function N(){var e=S(),t=Const.WEIBO_SHARE_CONTENT.replace(/\[\]/,i.name)+e;n.weiboShareContent.text(t),n.shareByWeiboButton.removeAttr("disabled").removeClass("btn_disable")}function C(){n.weiboShareContent.text(""),n.shareByWeiboButton.attr("disabled",!0).addClass("btn_disable")}function k(){var e=S(),t=Const.EMAIL_SHARE_CONTENT.replace(/\[\]/,i.name).replace(/<>/,CONST.uname)+e;n.emailShareContent.val(t)}function L(){n.emailInput.val(Const.DEFAULT_INPUT_TEXT),n.emailShareContent.val(""),n.shareByEmailButton.attr("disabled",!0).addClass("btn_disable")}function A(){e.trigger("publishShareLink",{fileId:i.fileId,fileType:i.type,pickupcode:"no"})}function O(){n.publishNetworkError.hide(),n.publishFail.hide(),n.loadingPublish.show(),A()}function M(){n.noPassword.hide(),n.loadingCreatePassword.show(),n.createPassword.hide(),e.trigger("createPassword",{fileId:i.fileId,fileType:i.type,pickupcode:"yes"})}function _(){n.hasPassword.hide(),n.loadingCancelPassword.show(),e.trigger("createPassword",{fileId:i.fileId,fileType:i.type,pickupcode:"no"})}function D(){e.trigger("cancelSharelink",i.fileId),t.hide(),e.trigger("operateMessage",{type:"loading",content:"正在为您取消分享链接...",time:-1})}function P(){var e=n.weiboShareContent.val(),t="";window.open("http://v.t.sina.com.cn/share/share.php?title="+encodeURIComponent(e))}function H(t){var n=$(t.target),r=R(),s=I();n.hasClass("dialog-button-light-forbidden")||s&&r&&e.trigger("sendEmail",{emailAddress:s,nickName:CONST.uname,fileName:i.name,fileId:i.fileId})}function B(e){var t=$(e.target),n=t.val();Const.DEFAULT_INPUT_TEXT===n&&t.val("")}function j(e){I()}function F(e){var t=$(e.target),r=n.shareByEmailButton,i=t.val(),s=i.length;13===e.keyCode&&0!==s&&";"!==i.charAt(s-1)&&t.val(i+";"),r.hasClass("btn_disable")&&(r.removeAttr("disabled").removeClass("btn_disable"),n.newShareEmail.find(".email-format-error").text(""))}function I(){var e=n.emailInput,t=n.shareByEmailButton,r=e.val(),i=[],s=!0;return""===r||Const.DEFAULT_INPUT_TEXT===r?(e.val(Const.DEFAULT_INPUT_TEXT),t.attr("disable",!0).addClass("btn_disable"),!1):(";"===r.slice(-1)&&(r=r.slice(0,-1)),i=r.split(";"),$.each(i,function(e,r){if(!Const.EMAIL_REG.test(r))return t.attr("disable",!0).addClass("btn_disable"),n.newShareEmail.find(".email-format-error").text("（邮箱格式错误，"+Const.DEFAULT_INPUT_TEXT+"）"),s=!1,!1}),s?i:!1)}function q(){n.newShareEmail.find(".email-content-error").text("")}function R(){var e=n.emailShareContent,t=e.val();return""===t?(n.newShareEmail.find(".email-content-error").text("请输入邮件内容"),!1):t}function U(){T(),n.rootEle.find(".weixin").addClass("selected"),n.newShareWeixin.show(),L(),n.rootEle.find(".email").removeClass("selected"),n.newShareEmail.hide(),C(),n.rootEle.find(".weibo").removeClass("selected"),n.newShareWeibo.hide()}function z(){n.rootEle.on("click",".new-share-nav a",f),n.rootEle.on("click",".retry",O),n.rootEle.on("click",".create-password",M),n.rootEle.on("click",".cancel-password",_),n.rootEle.on("click",".cancel-sharelink-button",D),n.rootEle.on("focusin",".emails",B),n.rootEle.on("focusout",".emails",j),n.rootEle.on("keydown",".emails",F),n.rootEle.on("keydown",".email-content",q),n.rootEle.on("click",".share-by-email-button",H),n.rootEle.on("click",".share-by-weibo-button",P)}var e={},t,n={},r=new StateMachine,i,s;return $.extend(e,Event),e.checkHasPublicLink=function(e){e?(e.length>0?(n.hasPassword.show(),n.createPassword.hide(),n.noPassword.hide()):(n.hasPassword.hide(),n.createPassword.show(),n.noPassword.show()),v(e),n.loadingPublish.hide(),n.publishFail.hide(),n.publishSuccess.show(),n.linkContainer.show()):A()},e.publishShareLinkFinished=function(e){var t;"ok"===e.apiresult?(t=e.pickupcode,"no"===t?(t=[],n.noPassword.show()):n.hasPassword.show(),v(t),n.loadingPublish.hide(),n.publishSuccess.show(),n.linkContainer.show()):"PSA_CLAN_EXIST"===e.apiresult?(n.loadingPublish.hide(),n.publishRepeatError.show(),n.publishFail.show(),n.linkContainer.hide()):(n.loadingPublish.hide(),n.publishNetworkError.show(),n.publishFail.show(),n.linkContainer.hide())},e.republishShareLinkFinished=function(e){var t;"ok"===e.apiresult&&(n.loadingCreatePassword.hide(),n.loadingCancelPassword.hide(),t=e.pickupcode,g(t),"no"===t?(n.noPassword.show(),n.createPassword.show()):n.hasPassword.show())},e.sendEmailFinished=function(e){alert("邮件已成功发送"),n.emailInput.val(Const.DEFAULT_INPUT_TEXT),n.shareByEmailButton.attr("disable",!0).addClass("btn_disable")},e.show=function(e){u(),i=e,this.trigger("checkHasPublicLink",e.fileId)},e}(),share}),"use strict",define("module/download_file",[],function(){return window.downloadFile=function(){function t(e){var t=[];return t.push(Const.DOWNLOAD_URL),t.push(e.fileId),t.push("&c=0"),t.join("")}var e={};return e.show=function(e){var n=t(e);window.open(n)},e}(),downloadFile}),"use strict",define("module/file_list",["jquery","sandbox/sandbox"],function(){KP.FileList=function(){function o(){var e;this.elements={},e=this.elements,e.containerEle=$("#file-list"),e.contentEle=e.containerEle.closest(".content"),e.listDataContainer=e.containerEle.find(".list-data-container"),e.listDataHeaderEle=e.containerEle.find("thead"),e.selectAllCheckbox=e.containerEle.find("thead .checkbox")}function u(){var e=['<tr id="createListFolder" class="selected">','<td><span class="checkbox"></span>','<td class="file-name folder-icon"><input type="text" value="'+Common.generateCommonFolderName(this.loadedFiles)+'" class="txt new-folder-input">',"<td>","<td>","<td>","<td>","</tr>"].join("");return e}function a(e){13===e.keyCode&&e.target.blur()}function f(e){var t=$("#createListFolder"),n=$(e.currentTarget),r=n.val();if(n.attr("outed"))return;n.attr("outed",!0),""!==r?(this.trigger("operateMessage",{type:"loading",content:"正在为您新建文件夹",time:-1}),this.trigger("createFolder",{newFolderName:r,parentFileId:this.parentFileId})):(this.trigger("cancelCreateFolder"),t.remove())}function l(e){13===e.keyCode&&e.target.blur()}function c(e){var t=$(e.target),n=t.parent(),r=n.parent(),i=r.attr("data-file-id"),s=Common.getFileByFileId(this.loadedFiles,i),o=t.val();""===o?n.find("input").val(s.name).end().removeClass("rename-status"):s.name===o?n.removeClass("rename-status"):(this.trigger("operateMessage",{type:"loading",content:"正在为您重命名文件",time:-1}),this.trigger("renameFileSubmit",{fileId:i,newFileName:o}))}function h(e){var t=0,n=e.length,r,i=[],s;for(;t<n;t++)r=e[t],i.push("#"+r+"_0"),Util.deleteArrayItem(this.selectedIds,r);s=i.join(","),$(s).remove(),0===this.loadedFiles.length&&$.proxy(v,this)(this.loadedFiles)}function p(){this.parentFileId=undefined,this.selectedIds=[],this.loadedFiles=[],this.lastClickFileId=undefined,this.isDrag=!1,this.isMove=!1,this.dragObj={}}function d(){$.each(this.selectedIds,function(e,t){$("#"+t+"_0").removeClass("selected")}),this.selectedIds=[],$.proxy(M,this)(),this.activateStatus&&$.proxy(L,this)()}function v(e){var t,n=this.elements.listDataContainer,r=this.elements.listDataHeaderEle;e?0===e.length?(t=w(),r.hide()):(t=m(e,this.options),r.show()):t="",n.html(t)}function m(e,t){var n=0,r=e.length,i,s=[],o="";for(;n<r;n++)i=e[n],t.hide_col_oper||(o=y(i,t)),s.push('<tr id="'+i.fileId+'_0" data-file-id="'+i.fileId+'" class="">'),s.push('<td><span class="checkbox"></span>'),s.push('<td class="file-name '+Util.getFileIconClass(i)+'"><i class="i ifl '+Util.getFileIconClassName(i)+'"></i><a data-ca="listView-see-'+(i.ext||i.type)+'" href="javascript:void(0)" class="name" title="'+i.name+'">'+Util.formateSubStr(i.name,40,-6)+'</a><input type="text" value="'+i.name+'" class="txt rename-file-input">'),o&&s.push("<td>"+o),s.push("<td>"+Util.getFileSize(i)),t.hide_col_ftype||s.push("<td>"+Util.getObjectType(i)),s.push("<td>"+i.modTime);return s.join("")}function y(e,t){var n=[];return n.push('<ul class="inline-operatebar">'),n.push('<li class="operate"><a data-ca="hoveroper-download" href="javascript:void(0)" class="operate download" title="下载"></a>'),t.onlyShowOperDownload||(n.push('<li class="operate"><a data-ca="hoveroper-outlink" href="javascript:void(0)" class="operate outlink" title="分享"></a>'),"folder"===e.type&&n.push('<li class="operate"><a data-ca="hoveroper-share" href="javascript:void(0)" class="operate share" title="协作"></a>'),e.iscanconvert&&n.push('<li class="operate"><a data-ca="hoveroper-look" href="javascript:void(0)" class="operate view-online" title="在线查看"></a>'),n.push('<li class="operate"><a data-ca="hoveroper-more" href="javascript:void(0)" class="operate more" title="更多"></a>'),n.push('<div class="dropDown2 dn inline-operatebar-more"><ul class="dropMenu">'),e.iscanwow&&n.push('<li><a data-ca="hoveroper-edit" href="javascript:void(0)" class="edit-online">在线编辑</a>'),n.push('<li><a data-ca="hoveroper-rename" href="javascript:void(0)" class="rename">重命名</a>'),n.push('<li><a data-ca="hoveroper-move" href="javascript:void(0)" class="move">移动</a>'),n.push('<li><a data-ca="hoveroper-delete" href="javascript:void(0)" class="delete">删除</a>'),n.push("</ul></div>")),n.push("</ul>"),n.join("")}function b(e){var t,n=[];return e.length>1?(n.push('<li><a data-ca="contextmenu-move" href="javascript:void(0)" class="move" title="移动">移动</a>'),n.push('<li><a data-ca="contextmenu-delete" href="javascript:void(0)" class="delete" title="删除">删除</a>')):(t=Common.getFileByFileId(this.loadedFiles,e[0]),t&&"folder"===t.type&&n.push('<li><a data-ca="contextmenu-share" href="javascript:void(0)" class="share" title="协作">协作</a>'),n.push('<li><a data-ca="contextmenu-download" href="javascript:void(0)" class="download" title="下载">下载</a>'),n.push('<li><a data-ca="contextmenu-outlink" href="javascript:void(0)" class="outlink" title="分享">分享</a>'),n.push('<li><a data-ca="contextmenu-rename" href="javascript:void(0)" class="rename" title="重命名">重命名</a></li>'),n.push('<li><a data-ca="contextmenu-move" href="javascript:void(0)" class="move" title="移动">移动</a>'),n.push('<li><a data-ca="contextmenu-delete" href="javascript:void(0)" class="delete" title="删除">删除</a>'),t.iscanconvert&&n.push('<li><a data-ca="contextmenu-look" href="javascript:void(0)" class="view-online" title="在线查看">在线查看</a>'),t.iscanwow&&n.push('<li><a data-ca="contextmenu-edit" href="javascript:void(0)" class="edit-online" title="在线编辑">在线编辑</a>')),n.join("")}function w(){return'<div class="noFile"></div>'}function E(e){var t=e.srcElement||e.target;if(65===e.keyCode&&(e.ctrlKey||e.metaKey)&&t.nodeName.toLocaleUpperCase()!=="INPUT")return $.proxy(k,this)(),!1}function S(e){var t=[];return $.each(this.dragObj.itemOffset,function(n,r){Common.checkIntersection(e,r)&&t.push(r.fileId)}),t}function x(e){var t=$(e.currentTarget),n=t.attr("data-file-id"),r=this.elements.selectAllCheckbox,i=this.selectedIds,s=this.loadedFiles,o=[],u=e.srcElement||e.target,a=$(u),f=u.nodeName.toLocaleUpperCase();n&&(this.elements.containerEle.find(".contextmenu").hide(),"A"!==f?(e.ctrlKey||e.metaKey||"SPAN"===f&&a.hasClass("checkbox")&&!e.shiftKey?t.hasClass("selected")?$.proxy(N,this)([n]):$.proxy(T,this)([n]):e.shiftKey&&this.lastClickFileId?(shiftSelectedFileIds=Common.queryFileIdsByRange(s,this.lastClickFileId,n),$.proxy(T,this)(shiftSelectedFileIds)):$.proxy(C,this)(t,n),$.proxy(M,this)(),this.lastClickFileId=n):a.hasClass("name")?$.proxy(j,this)(n):a.hasClass("more")?(K(t),$.proxy(C,this)(t,n)):a.hasClass("download")?($.proxy(C,this)(t,n),this.trigger("downloadFile",Common.subFileArray(this.loadedFiles,this.selectedIds)[0])):a.hasClass("share")?($.proxy(C,this)(t,n),this.trigger("share",Common.subFileArray(this.loadedFiles,this.selectedIds)[0])):a.hasClass("outlink")?($.proxy(C,this)(t,n),this.trigger("outlink",Common.subFileArray(this.loadedFiles,this.selectedIds)[0])):a.hasClass("rename")?($.proxy(C,this)(t,n),$.proxy(this.renameFile,this)(Common.subFileArray(this.loadedFiles,this.selectedIds)[0])):a.hasClass("move")?($.proxy(C,this)(t,n),this.trigger("moveFileDialog",Common.subFileArray(this.loadedFiles,this.selectedIds))):a.hasClass("delete")?($.proxy(C,this)(t,n),this.trigger("deleteFile",Common.subFileArray(this.loadedFiles,this.selectedIds))):a.hasClass("view-online")?($.proxy(C,this)(t,n),this.trigger("viewOnline",Common.subFileArray(this.loadedFiles,this.selectedIds)[0],this.loadedFiles)):a.hasClass("edit-online")&&($.proxy(C,this)(t,n),this.trigger("editOnline",Common.subFileArray(this.loadedFiles,this.selectedIds)[0])))}function T(e){var t=this.selectedIds;t=t.concat(e),t=this.selectedIds=Util.unique(t),$.each(e,function(e,t){$("#"+t+"_0").addClass("selected").removeClass("tbl-hover")}),$.proxy(L,this)()}function N(e){var t=this.selectedIds;$.each(e,function(e,n){Util.deleteArrayItem(t,n),$("#"+n+"_0").removeClass("selected")}),$.proxy(L,this)()}function C(e,t){var n=this.selectedIds;$.each(n,function(e,t){$("#"+t+"_0").removeClass("selected")}),e.addClass("selected"),this.selectedIds=[t],$.proxy(L,this)()}function k(e){var t=this.elements.selectAllCheckbox,n=this.elements.listDataContainer.find("tr"),r=[];t.hasClass("checkbox_act")?(n.removeClass("selected"),this.selectedIds=[]):(n.addClass("selected").removeClass("tbl-hover"),$.each(this.loadedFiles,function(e,t){r.push(t.fileId)}),this.selectedIds=r),$.proxy(M,this)(),$.proxy(L,this)()}function L(){var e=this.elements.listDataHeaderEle.find(".name");O(e,this.selectedIds.length,this.options.sortFileName),this.trigger("select",Common.subFileArray(this.loadedFiles,this.selectedIds),this.loadedFiles)}function O(e,t,n){t<2?A!==undefined&&(n?e.html('文件名<a class="sort dn" href="javascript:void(0)" sortkey="fname" sorttype="asc">▼</a>'):e.html("文件名")):(A=e.html(),e.html('已选择<span class="selected-file-number">'+t+"</span>项"))}function M(){var e=this.elements.selectAllCheckbox;this.selectedIds.length===this.loadedFiles.length&&0!==this.loadedFiles.length?e.addClass("checkbox_act"):e.removeClass("checkbox_act")}function _(e){var t=$(e.target);t.parents(".selected-operate").length===0&&!t.hasClass("checkbox")&&$.proxy(d,this)(),this.elements.containerEle.find(".contextmenu").hide()}function D(e){var t=$(e.currentTarget),n=t.attr("data-file-id");$.proxy(j,this)(n)}function P(e){var t=$(e.currentTarget),n=t.attr("data-file-id"),r=".contextmenu",i=this.elements.containerEle.find(r);t.hasClass("selected")||$.proxy(C,this)(t,n);var s=$.proxy(b,this)(this.selectedIds);i.html(s);var o=Util.getRealPosition(e,this.elements.contentEle),u=4,a=i.width(),f=i.height(),l=o.width-a-u,c=o.height-f-u,h=o.evtX,p=o.evtY;h=h<l?h:h-a-u,p=p<c?o.relativeY:o.relativeY-f-u;var d={left:h,top:p},v;return v=H(i,d,o),i.css(v).show(),!1}function H(e,t,n){var r=document.documentElement.clientHeight,i=document.documentElement.clientWidth,s=n.relativeY,o=t.left,u=e.find("li").length*31+2,a=82;return s+u>n.height&&(s-=u),o+a>n.width&&(o-=a),{top:s,left:o}}function B(e){var t=$(e.target);t.hasClass("download")?this.trigger("downloadFile",Common.subFileArray(this.loadedFiles,this.selectedIds)[0]):t.hasClass("share")?this.trigger("share",Common.subFileArray(this.loadedFiles,this.selectedIds)[0]):t.hasClass("outlink")?this.trigger("outlink",Common.subFileArray(this.loadedFiles,this.selectedIds)[0]):t.hasClass("rename")?$.proxy(this.renameFile,this)(Common.subFileArray(this.loadedFiles,this.selectedIds)[0]):t.hasClass("move")?this.trigger("moveFileDialog",Common.subFileArray(this.loadedFiles,this.selectedIds)):t.hasClass("delete")?this.trigger("deleteFile",Common.subFileArray(this.loadedFiles,this.selectedIds)):t.hasClass("view-online")?this.trigger("viewOnline",Common.subFileArray(this.loadedFiles,this.selectedIds)[0],this.loadedFiles):t.hasClass("edit-online")&&this.trigger("editOnline",Common.subFileArray(this.loadedFiles,this.selectedIds)[0]),this.elements.containerEle.find(".contextmenu").hide()}function j(e){var t=Common.getFileByFileId(this.loadedFiles,e);t&&("folder"===t.type?$.proxy(F,this)(e):this.trigger("viewOnline",t,this.loadedFiles))}function F(e){this.trigger("openFolder",e,"list"),$.proxy(v,this)()}function R(e){var t=$(e.currentTarget),n=t.attr("data-file-id"),r=Common.getFileByFileId(this.loadedFiles,n);this.isDrag&&this.isSelectedFile&&-1===$.inArray(n,this.dragObj.fileIds)&&"folder"===r.type&&t.addClass("tbl-highlight")}function U(e){var t=$(e.currentTarget),n=t.attr("data-file-id"),r=Common.getFileByFileId(this.loadedFiles,n),i=t.offset(),s=this.elements.containerEle.scrollTop(),o,u;this.isDrag&&this.isSelectedFile&&-1===$.inArray(n,this.dragObj.fileIds)&&"folder"===r.type&&t.removeClass("tbl-highlight"),t.find(".inline-operatebar-more").hide()}function z(e){var t=[],n=Util.getRealPosition(e,this.elements.contentEle),r=$(e.target),i=e.srcElement||e.target,s=n.scrollTop;if("input"!==i.nodeName.toLocaleLowerCase()){this.isDrag=!0,r=r.closest("tr[data-file-id]");if(r.length&&r.attr("data-file-id")&&r.hasClass("selected")&&r.find(".rename-status").length===0){this.isSelectedFile=!0;var o=n.relativeY+Const.SPLIT_SPACE,u=n.evtX+Const.SPLIT_SPACE;$("#drag-files").css({top:o,left:u}),this.dragObj.fileIds=this.selectedIds}else this.isSelectedFile=!1,$("#drag-area").css({top:n.relativeY,left:n.evtX}),$.each(this.elements.containerEle.find("tbody tr"),function(e,r){var i=$(r),o={top:i.offset().top-n.top,left:i.offset().left-n.left};t.push({topLeftX:o.left,topLeftY:o.top+s,bottomRightX:o.left+99999,bottomRightY:o.top+s+41,fileId:i.attr("data-file-id")})}),this.dragObj.itemOffset=t;this.dragObj.pageX=n.evtX,this.dragObj.pageY=n.relativeY}}function W(e){var t=Util.getRealPosition(e,this.elements.contentEle),n,r,i,s,o;if(this.isDrag){i=t.evtX-this.dragObj.pageX,s=t.relativeY-this.dragObj.pageY,s>0&&i>0&&(n=this.dragObj.pageY,r=this.dragObj.pageX,i-=Const.SPLIT_SPACE,s-=Const.SPLIT_SPACE),s>0&&i<0&&(n=this.dragObj.pageY,r=this.dragObj.pageX-Math.abs(i)+Const.SPLIT_SPACE,i=Math.abs(i)-Const.SPLIT_SPACE,s-=Const.SPLIT_SPACE),s<0&&i>0&&(n=this.dragObj.pageY-Math.abs(s)+Const.SPLIT_SPACE,r=this.dragObj.pageX,i-=Const.SPLIT_SPACE,s=Math.abs(s)-Const.SPLIT_SPACE),s<0&&i<0&&(n=this.dragObj.pageY-Math.abs(s)+Const.SPLIT_SPACE,r=this.dragObj.pageX-Math.abs(i)+Const.SPLIT_SPACE,i=Math.abs(i)-Const.SPLIT_SPACE,s=Math.abs(s)-Const.SPLIT_SPACE);if(this.isSelectedFile){var u=Util.fit_in_content(e,$("#drag-files"),this.elements.contentEle);$("#drag-files").css({top:u.top,left:u.left+5}),!this.dragObj.dragStart&&i*s>2&&($("#drag-files").text(this.selectedIds.length).show(),this.dragObj.dragStart=!0)}else i*s>0&&($("#drag-area").addClass("ui-selectable-helper").css({top:n,left:r,width:i,height:s}).show(),o=$.proxy(S,this)({topLeftX:r,topLeftY:n,bottomRightX:r+i,bottomRightY:n+s}),$.proxy(d,this)(),$.proxy(T,this)(o),$.proxy(M,this)())}return!1}function X(e){var t=$(e.currentTarget),n=t.attr("data-file-id"),r=Common.getFileByFileId(this.loadedFiles,n);this.isDrag&&(this.isSelectedFile?(-1===$.inArray(n,this.dragObj.fileIds)&&"folder"===r.type&&(this.trigger("moveFile",{fileIds:this.dragObj.fileIds,moveTo:n}),this.trigger("operateMessage",{type:"loading",content:"正在努力为您移动"+this.dragObj.fileIds.length+"个文件",time:-1}),t.removeClass("tbl-highlight")),this.isSelectedFile=!1,this.dragObj={},$("#drag-files").hide()):$("#drag-area").hide(),this.isDrag=!1)}function V(e){var t=e.target,n=$(t);this.isDrag&&(this.isDrag=!1,this.isSelectedFile=!1,this.dragObj={},$("#drag-files").hide(),$("#drag-area").hide()),this.isMove&&(this.isMove=!1)}function J(e){var t=e.srcElement||e.target,n=$(t);n.hasClass("checkbox")||n.parents("#file-list tbody").length===0&&t.nodeName.toLocaleLowerCase()!=="tbody"&&$.proxy(d,this)()}function K(e){var t=e.find(".inline-operatebar-more:visible"),n=e.find(".inline-operatebar-more"),r=n.find("li").length,i=e.get(0).offsetTop-$("#file-list").get(0).scrollTop,s=$("#file-list").height(),o=s-i;0===t.length?(s>(r+2)*31&&o<(r+1)*31&&e.find(".inline-operatebar-more").css({top:"-"+r*31+"px"}),e.find(".inline-operatebar-more").show()):n.hide()}function Q(){var e;e=this.elements.containerEle,e.on("click","thead .checkbox",$.proxy(k,this)),e.on("mouseenter","tbody tr",$.proxy(R,this)),e.on("mouseleave","tbody tr",$.proxy(U,this)),e.on("mousemove","tbody tr",$.proxy(q,this)),e.on("click","tbody tr",$.proxy(x,this)),this.options.disDblclick||e.on("dblclick","tbody tr",$.proxy(D,this)),this.options.disContextmenu||(e.on("contextmenu","tbody tr",$.proxy(P,this)),e.on("click",".contextmenu a",$.proxy(B,this))),e.on("focusout",".new-folder-input",$.proxy(f,this)),e.on("focusout",".rename-file-input",$.proxy(c,this)),e.on("keydown",".rename-file-input",$.proxy(l,this)),e.on("keydown",".new-folder-input",$.proxy(a,this)),e.on("mousedown",$.proxy(z,this)),e.on("mouseup","tbody tr",$.proxy(X,this)),e.on("mousedown","td.file-name a.name",g),$(document).on("mousemove",$.proxy(W,this)),$(document).on("mouseup",$.proxy(V,this)),$(document).on("keydown",$.proxy(E,this)),$(".header, #aside, #file-operatebar, #file-search-bar, #file-list thead").click($.proxy(_,this))}var e,t=!1,n=[],r={ele:$(document)},i={ele:$(document)},s=function(e){this.options=e||{},this.parentFileId=undefined,this.selectedIds=[],this.loadedFiles=[],this.lastClickFileId=undefined,this.activateStatus=!0,this.isMove=!1,this.isDrag=!1,this.mutiSelecteFile=!1,this.dragObj={},$.proxy(o,this)(),$.proxy(Q,this)()};$.extend(s.prototype,Event),s.prototype.activate=function(){this.activateStatus=!0,this.elements.containerEle.show()},s.prototype.deactivate=function(){this.activateStatus=!1,this.elements.containerEle.hide()},s.prototype.loadDir=function(e){var t=this.loadedFiles,n=this.elements.listDataHeaderEle,r;"ok"===e.xLive_attr.result&&(r=e.xLive.file,$.proxy(p,this)(),Util.sortArray(r,function(e,t){return e.type===t.type?e.modTime<t.modTime?!0:!1:"folder"===t.type?!0:!1}),Common.group(r),this.loadedFiles=r,this.parentFileId=e.xLive.parentFileId,$.proxy(d,this)(),$.proxy(v,this)(r))},s.prototype.loadData=function(){$.proxy(v,this)()},s.prototype.newFolder=function(){if(this.activateStatus){var e=this.elements.containerEle,t=$("#createListFolder"),n=$.proxy(u,this)(),r=$(n),i=r.find(".new-folder-input"),s;$.proxy(d,this)(),0!==e.scrollTop()&&(s=setInterval(function(){var t=e.scrollTop()-50;t>0?e.scrollTop(t):(e.scrollTop(0),clearInterval(s))},10)),0===t.length?this.loadedFiles.length>0?r.insertBefore($("#"+this.loadedFiles[0].fileId+"_0")):(this.elements.listDataHeaderEle.show(),this.elements.listDataContainer.empty().append(r)):r=t,i.select()}},s.prototype.createFolderFinished=function(e){var t,n,r=$("#createListFolder");e?(n=e,$.proxy(v,this)(this.loadedFiles),$.proxy(C,this)($("#"+n.fileId+"_0"),n.fileId),$.proxy(M,this)()):r.find(".new-folder-input").select()},s.prototype.renameFile=function(e){var t=e.name,n=$("#"+e.fileId+"_0"),r=n.find(".file-name"),i=r.find("input");this.activateStatus&&(r.addClass("rename-status"),i.select(),"file"===e.type&&Common.selectRenamePart(i.get(0),t))},s.prototype.renameFileFinished=function(e){var t,n,r,i,s,o,u;"ok"===e.result?(t=e.fileId,i=e.newFile,n=e.newFile.fileId,$.proxy(v,this)(this.loadedFiles),$.proxy(C,this)($("#"+n+"_0"),n)):(t=e.fileId,s=$("#"+t+"_0"),s.find("input").select(),s.find(".file-name").removeClass("waitting-status").addClass("error-status"))},s.prototype.moveFileFinished=function(e){var t=e.success,n=e.failed,r=0,i=t.length,s,o=[],u;$.proxy(h,this)(Common.getFileIds(t)),this.activateStatus&&$.proxy(L,this)()},s.prototype.deleteFileFinished=function(e){var t=e.success,n=e.failed,r=0,i=t.length,s,o=[],u;$.proxy(h,this)(Common.getFileIds(t)),this.activateStatus&&$.proxy(L,this)()},s.prototype.addCooperateSuccess=function(e){var t=$("#"+e+"_0");t.find(".file-name").removeClass("folder-icon").addClass("team-folder-icon")},s.prototype.cancelCooperateSuccess=function(e){var t=$("#"+e+"_0");t.find(".file-name").removeClass("team-folder-icon").addClass("folder-icon")},s.prototype.sort=function(e){Util.sortArray(this.loadedFiles,function(t,n){return t.type===n.type?"desc"===e.direct?"size"===e.type?parseInt(t[e.type])<parseInt(n[e.type])?!0:!1:t[e.type]<n[e.type]?!0:!1:"size"===e.type?parseInt(t[e.type])>parseInt(n[e.type])?!0:!1:t[e.type]>n[e.type]?!0:!1:"folder"===n.type?!0:!1}),Common.group(this.loadedFiles),$.proxy(v,this)(this.loadedFiles),$.proxy(d,this)()};var g=function(){},A,I=function(){var s=r.x-i.x,o=r.y-i.y,u=Math.sqrt(Math.pow(s,2)+Math.pow(o,2)),a=s/u,f=Math.acos(a),l=180/(Math.PI/f);o<0?l=-l:o==0&&s<0&&(l=180),l=Math.abs(l);if(l>165||l<15){i.ele.removeClass("tbl-hover");return}t=!1,clearTimeout(e),r.ele.removeClass("tbl-hover");for(var c in n)n[c].removeClass("tbl-hover");n=[];if(this.selectedIds.length>1&&i.ele.hasClass("selected"))return;i.ele.addClass("tbl-hover")},q=function(s){var o=$(s.currentTarget);r.ele.get(0)!=o.get(0)&&(i={ele:o,x:s.clientX,y:s.clientY},I.call(this)),clearTimeout(e),e=setTimeout(function(){t=!1},500);if(t)return;t=!0,r={ele:o,x:s.clientX,y:s.clientY};if(this.selectedIds.length>1&&r.ele.hasClass("selected"))return;r.ele.addClass("tbl-hover");for(var u in n){if(n[u].get(0)==r.ele.get(0))continue;n[u].removeClass("tbl-hover")}n.push(o)};return s}()}),"use strict",define("module/file_thumbnail",["jquery","sandbox/sandbox"],function(){KP.FileThumbnail=function(){function t(){var e;this.elements={},e=this.elements,e.containerEle=$("#file-thumbnail")}function n(e){var t=['<li class="file icon-view-selected" id="createIconFolder"><i class="i i21 ifl2"></i><input type="text" value="'+Common.generateCommonFolderName(this.loadedFiles)+'" class="txt new-folder-input">'];return e&&(t=['<div class="group">',"<h3>文件夹</h3>","<ul>"].concat(t),t=t.concat(["</ul>","</div>"])),t.join("")}function r(e){13===e.keyCode&&e.target.blur()}function i(e){var t=$("#createIconFolder"),n=$(e.currentTarget),r=n.val();""!==r?(this.trigger("operateMessage",{type:"loading",content:"正在为您新建文件夹",time:-1}),this.trigger("createFolder",{newFolderName:r,parentFileId:this.parentFileId})):(this.trigger("cancelCreateFolder"),t.remove())}function s(e){13===e.keyCode&&e.target.blur()}function o(e){var t=$(e.currentTarget),n=t.parent(),r=n.attr("data-file-id"),i=Common.getFileByFileId(this.loadedFiles,r),s=t.val();""===s?t.val(i.name).select():i.name===s?n.removeClass("rename-status"):(this.trigger("operateMessage",{type:"loading",content:"正在为您重命名文件",time:-1}),this.trigger("renameFileSubmit",{fileId:r,newFileName:s}))}function u(e){var t=0,n=e.length,r,i=[],s;for(;t<n;t++)r=e[t],i.push("#"+r+"_1"),Util.deleteArrayItem(this.selectedIds,r);s=i.join(","),$(s).remove(),0===this.loadedFiles.length&&$.proxy(a,this)(this.loadedFiles)}function a(e){var t,n=this.elements.containerEle;e?0===e.length?t=c():t=f(e):t="",n.html(t)}function f(e){var t=[],n=[],r=[],i=[],s=0,o=e.length,u;for(;s<o;s++)u=e[s],"folder"===u.type?n.push('<li class="file" id="'+u.fileId+'_1" data-file-id="'+u.fileId+'"><i class="i ifl2 '+Util.getFileIconClassName(u)+'"></i><a data-ca="iconView-see-'+(u.ext||u.type)+'" href="javascript:void(0)" class="name" title="'+u.name+'">'+Util.formateSubStr(u.name,15,0)+'</a><input type="text" value="'+u.name+'" class="txt rename-input">'):(i.push('<li class="file'),u.isimage&&i.push(" file_image"),i.push('" id="'+u.fileId+'_1" data-file-id="'+u.fileId+'"><i class="i ifl2 '+Util.getFileIconClassName(u)+'"></i><a data-ca="iconView-see-'+(u.ext||u.type)+'" href="javascript:void(0)" class="name" title="'+u.name+'">'+Util.formateSubStr(u.name,10,-5)+'</a><input type="text" value="'+u.name+'" class="txt rename-input">'));var a=['<div class="group"><ul>',n.concat(i).join(""),"</ul></div>"];return a.push('<ul class="dropMenu dropMenuAbs contextmenu"></ul>'),a.join("")}function l(e){var t=[];return t.push('<li class="dib-inline file" id="'+e.fileId+'_1" data-file-id="'+e.fileId+'">'),t.push('	<span class="icon folder-icon"></span>'),t.push('	<a href="javascript:;" class="name" title="'+e.name+'">'+Util.formateSubStr(e.name,15,0)+"</a>"),t.push('	<input type="text" value="'+e.name+'" class="txt rename-input" />'),t.push("</li>"),t.join("")}function c(){return'<div class="noFile"></div>'}function h(e){var t,n=[];return e.length>1?(n.push('<li><a href="javascript:;" class="move" title="移动">移动</a></li>'),n.push('<li><a href="javascript:;" class="delete" title="删除">删除</a></li>')):(t=Common.getFileByFileId(this.loadedFiles,e[0]),t&&"folder"===t.type&&n.push('<li><a href="javascript:;" class="share" title="协作">协作</a></li>'),n.push('<li><a href="javascript:;" class="download" title="下载">下载</a></li>'),n.push('<li><a href="javascript:;" class="outlink" title="分享">分享</a></li>'),n.push('<li><a href="javascript:;" class="rename" title="重命名">重命名</a></li>'),n.push('<li><a href="javascript:;" class="move" title="移动">移动</a></li>'),n.push('<li><a href="javascript:;" class="delete" title="删除">删除</a></li>'),t.iscanconvert&&n.push('<li><a href="javascript:;" class="view-online" title="在线查看">在线查看</a></li>'),t.iscanwow&&n.push('<li><a href="javascript:;" class="edit-online" title="在线编辑">在线编辑</a></li>')),n.join("")}function p(){var e=this.elements.containerEle.find("li.file_image"),t=this.loadedFiles;e.each(function(e,n){var r=$(this),i=r.attr("data-file-id"),s=Common.getFileByFileId(t,i),o=Common.getImageThumbnail(s.fileId,s.fileVer);r.find(".ifl2").addClass("thumbnail").css({"background-image":"url("+o+")","background-size":"auto 85px","background-position":"center"}).attr("title",s.name)}),this.hasLoadThumbnail=!0}function d(e){var t=[];return $.each(this.dragObj.itemOffset,function(n,r){Common.checkIntersection(e,r)&&t.push(r.fileId)}),t}function v(e){var t=$(e.currentTarget),n=t.attr("data-file-id"),r=this.selectedIds,i=this.loadedFiles,s=[],o=e.srcElement||e.target,u=$(o),a=o.nodeName.toLocaleUpperCase();$.proxy(N,this)(),e.ctrlKey||e.metaKey?t.hasClass("icon-view-selected")?$.proxy(y,this)([n]):$.proxy(g,this)([n]):e.shiftKey?(s=Common.shiftSelectFileIds({allFiles:this.loadedFiles,beginFileId:this.lastClickFileId,endFileId:n}),$.proxy(g,this)(s)):"A"!==a?$.proxy(m,this)(t,n):$.proxy(S,this)(n),this.lastClickFileId=n}function m(e,t){var n=this.selectedIds;if(n.length>1)$.each(n,function(e,t){$("#"+t+"_1").removeClass("icon-view-selected")}),e.addClass("icon-view-selected"),this.selectedIds=[t];else if(1===n.length){if(!e.hasClass("icon-view-selected")){var r=$("#"+n[0]+"_1");r.removeClass("icon-view-selected"),this.selectedIds=[t],e.addClass("icon-view-selected")}}else this.selectedIds=[t],e.addClass("icon-view-selected");this.trigger("select",Common.subFileArray(this.loadedFiles,this.selectedIds))}function g(e){var t=this.selectedIds;t=t.concat(e),this.selectedIds=Util.unique(t),$.each(e,function(e,t){$("#"+t+"_1").addClass("icon-view-selected")}),this.trigger("select",Common.subFileArray(this.loadedFiles,this.selectedIds))}function y(e){var t=this.selectedIds;$.each(e,function(e,n){Util.deleteArrayItem(t,n),$("#"+n+"_1").removeClass("icon-view-selected")}),this.trigger("select",Common.subFileArray(this.loadedFiles,this.selectedIds))}function b(e){var t=this.elements.containerEle.find("li"),n=[];this.loadedFiles.length===this.selectedIds.length?(t.removeClass("icon-view-selected"),this.selectedIds=[]):(t.addClass("icon-view-selected"),$.each(this.loadedFiles,function(e,t){n.push(t.fileId)}),this.selectedIds=n)}function w(){$.each(this.selectedIds,function(e,t){$("#"+t+"_1").removeClass("icon-view-selected")}),this.selectedIds=[],this.activateStatus&&this.trigger("select",Common.subFileArray(this.loadedFiles,this.selectedIds))}function E(){this.hasLoadThumbnail=!1,this.parentFileId=undefined,this.selectedIds=[],this.loadedFiles=[],this.lastClickFileId=undefined,this.isDrag=!1,this.dragObj={}}function S(e){var t=Common.getFileByFileId(this.loadedFiles,e);t&&"folder"===t.type?$.proxy(x,this)(e):this.trigger("viewOnline",t,this.loadedFiles)}function x(e){this.trigger("openFolder",e,"icon"),$.proxy(a,this)()}function T(e){var t=$(e.currentTarget),n=t.attr("data-file-id"),r=this.elements.containerEle.find(".contextmenu"),i=Util.getRealPosition(e,this.elements.containerEle),s=4,o=r.width(),u=r.height(),a=i.width-o-s,f=i.height-u-s,l=i.evtX,c=i.evtY;l=l<a?l:l-o-s,c=c<f?i.relativeY:i.relativeY-u-s;var p={top:c,left:l},d,v;return t.hasClass("icon-view-selected")||$.proxy(m,this)(t,n),v=$.proxy(h,this)(this.selectedIds),r.html(v),d=C(r,p),r.css(d).show(),!1}function N(){this.elements.containerEle.find(".contextmenu").hide()}function C(e,t){var n=document.documentElement.clientHeight,r=document.documentElement.clientWidth,i=t.top,s=t.left,o=e.find("li").length*31+2,u=82;return i+o>n&&(i-=o),s+u>r&&(s-=u),{top:i,left:s}}function k(e){var t=$(e.target);t.hasClass("download")?this.trigger("downloadFile",Common.subFileArray(this.loadedFiles,this.selectedIds)[0]):t.hasClass("share")?this.trigger("share",Common.subFileArray(this.loadedFiles,this.selectedIds)[0]):t.hasClass("outlink")?this.trigger("outlink",Common.subFileArray(this.loadedFiles,this.selectedIds)[0]):t.hasClass("rename")?$.proxy(this.renameFile,this)(Common.subFileArray(this.loadedFiles,this.selectedIds)[0]):t.hasClass("move")?this.trigger("moveFileDialog",Common.subFileArray(this.loadedFiles,this.selectedIds)):t.hasClass("delete")?this.trigger("deleteFile",Common.subFileArray(this.loadedFiles,this.selectedIds)):t.hasClass("view-online")?this.trigger("viewOnline",Common.subFileArray(this.loadedFiles,this.selectedIds)[0],this.loadedFiles):t.hasClass("edit-online")&&this.trigger("editOnline",Common.subFileArray(this.loadedFiles,this.selectedIds)[0]),this.elements.containerEle.find(".contextmenu").hide()}function L(e){var t=$(e.currentTarget),n=t.attr("data-file-id");$.proxy(S,this)(n)}function A(e){var t=$(e.target);t.parents(".selected-operate").length===0&&t.parents(".file").length===0&&$.proxy(w,this)(),this.elements.containerEle.find(".contextmenu").hide()}function O(e){65===e.keyCode&&(e.ctrlKey||e.metaKey)&&$.proxy(b,this)()}function M(e){var t=$(e.currentTarget),n=t.attr("data-file-id"),r=Common.getFileByFileId(this.loadedFiles,n);this.isDrag&&this.isSelectedFile&&-1===$.inArray(n,this.dragObj.fileIds)&&"folder"===r.type&&t.addClass("tbl-highlight"),t.addClass("icon-view-hover")}function _(e){var t=$(e.currentTarget),n=t.attr("data-file-id"),r=Common.getFileByFileId(this.loadedFiles,n);this.isDrag&&this.isSelectedFile&&-1===$.inArray(n,this.dragObj.fileIds)&&"folder"===r.type&&t.removeClass("tbl-highlight"),t.removeClass("icon-view-hover"),t.find(".inline-operatebar-more").hide()}function D(e){var t=e.target,n=$(t),r,i=[];e.preventDefault();var s=Util.getRealPosition(e,this.elements.containerEle),o=s.relativeY+Const.SPLIT_SPACE,u=s.evtX+Const.SPLIT_SPACE,a=s.scrollTop;if("input"!==t.nodeName.toLocaleLowerCase()){this.isDrag=!0;var f=n.closest(".file");n.hasClass("file")&&(r=n),f.length&&(r=f),r&&r.attr("data-file-id")&&r.hasClass("icon-view-selected")?(this.isSelectedFile=!0,$("#drag-files").css({top:o,left:u}),this.dragObj.fileIds=this.selectedIds):(this.isSelectedFile=!1,$("#drag-area").css({top:s.relativeY,left:s.evtX})),$.each(this.elements.containerEle.find(".file"),function(e,t){var n=$(t),r={top:n.offset().top-s.top,left:n.offset().left-s.left};i.push({topLeftX:r.left,topLeftY:r.top+a,bottomRightX:r.left+125,bottomRightY:r.top+a+125,fileId:n.attr("data-file-id")})}),this.dragObj.itemOffset=i,this.dragObj.pageX=s.evtX,this.dragObj.pageY=s.relativeY}}function P(e){var t=Util.getRealPosition(e,this.elements.contentEle),n,r,i,s,o;if(this.isDrag){i=t.evtX-this.dragObj.pageX,s=t.relativeY-this.dragObj.pageY,s>0&&i>0&&(n=this.dragObj.pageY,r=this.dragObj.pageX,i-=Const.SPLIT_SPACE,s-=Const.SPLIT_SPACE),s>0&&i<0&&(n=this.dragObj.pageY,r=this.dragObj.pageX-Math.abs(i)+Const.SPLIT_SPACE,i=Math.abs(i)-Const.SPLIT_SPACE,s-=Const.SPLIT_SPACE),s<0&&i>0&&(n=this.dragObj.pageY-Math.abs(s)+Const.SPLIT_SPACE,r=this.dragObj.pageX,i-=Const.SPLIT_SPACE,s=Math.abs(s)-Const.SPLIT_SPACE),s<0&&i<0&&(n=this.dragObj.pageY-Math.abs(s)+Const.SPLIT_SPACE,r=this.dragObj.pageX-Math.abs(i)+Const.SPLIT_SPACE,i=Math.abs(i)-Const.SPLIT_SPACE,s=Math.abs(s)-Const.SPLIT_SPACE),i*s>4&&(this.isMove=!0);if(this.isSelectedFile){var u=Util.fit_in_content(e,$("#drag-files"),this.elements.contentEle);!this.dragObj.dragStart&&i*s>2?($("#drag-files").css({top:u.top,left:u.left+5}).text(this.selectedIds.length).show(),this.dragObj.dragStart=!0):$("#drag-files").css({top:u.top,left:u.left+5}),$("#drag-area").hide()}else i*s>0&&($("#drag-area").addClass("ui-selectable-helper").css({top:n,left:r,width:i,height:s}).show(),o=$.proxy(d,this)({topLeftX:r,topLeftY:n,bottomRightX:r+i,bottomRightY:n+s}),$.proxy(w,this)(),$.proxy(g,this)(o))}}function H(e){var t=$(e.currentTarget),n=t.attr("data-file-id"),r=Common.getFileByFileId(this.loadedFiles,n);this.isDrag&&this.isSelectedFile&&-1===$.inArray(n,this.dragObj.fileIds)&&"folder"===r.type&&(this.trigger("moveFile",{fileIds:this.dragObj.fileIds,moveTo:n}),this.trigger("operateMessage",{type:"loading",content:"正在努力为您移动"+this.dragObj.fileIds.length+"个文件",time:-1}),t.removeClass("tbl-highlight"))}function B(e){var t=e.target,n=$(t);this.isDrag&&(this.isDrag=!1,this.isSelectedFile=!1,this.dragObj={},$("#drag-files").hide(),$("#drag-area").hide(),this.isMove&&window.ActiveXObject&&(this.hasDragClick=!0,this.isMove=!1))}function j(){var e=this.elements.containerEle;this.elements.contentEle=this.elements.containerEle.closest(".content"),e.on("click",".file",$.proxy(v,this)),e.on("dblclick",".file",$.proxy(L,this)),e.on("contextmenu",".file",$.proxy(T,this)),e.on("click",".contextmenu a",$.proxy(k,this)),e.on("mouseenter",".file",$.proxy(M,this)),e.on("mouseleave",".file",$.proxy(_,this)),e.on("focusout",".new-folder-input",$.proxy(i,this)),e.on("focusout",".rename-input",$.proxy(o,this)),e.on("keydown",".new-folder-input",$.proxy(r,this)),e.on("keydown",".rename-input",$.proxy(s,this)),e.on("mousedown",$.proxy(D,this)),e.on("mouseup",".file",$.proxy(H,this)),$("body").on("mousemove",$.proxy(P,this)),$("body").on("mouseup",$.proxy(B,this)),$("body").on("click",$.proxy(function(e){this.hasDragClick=!1},this)),$(".header, #aside, #file-operatebar, #file-search-bar").click($.proxy(A,this)),e.on("click",$.proxy(function(e){var t=$(e.target);0===t.parents(".file").length&&!t.hasClass(".file")&&!this.hasDragClick&&$.proxy(w,this)(),this.hasDragClick=!1},this)),$("body").on("keydown",$.proxy(O,this))}var e=function(){this.selectedIds=[],this.loadedFiles=[],this.parentFileId=undefined,this.activateStatus=!1,this.lastClickFileId=undefined,this.hasLoadThumbnail=!1,this.isDrag=!1,this.isMove=!1,this.hasDragClick=!1,this.dragObj={},$.proxy(t,this)(),$.proxy(j,this)(),$.extend(this,Event)};return e.prototype.activate=function(){this.activateStatus=!0,this.elements.containerEle.show(),this.hasLoadThumbnail||$.proxy(p,this)()},e.prototype.deactivate=function(){this.activateStatus=!1,this.elements.containerEle.hide()},e.prototype.loadDir=function(e){var t=this.loadedFiles,n;"ok"===e.xLive_attr.result&&(n=e.xLive.file,$.proxy(E,this)(),Util.sortArray(n,function(e,t){return e.type===t.type?e.modTime<t.modTime?!0:!1:"folder"===t.type?!0:!1}),Common.group(n),this.loadedFiles=n,this.parentFileId=e.xLive.parentFileId,$.proxy(w,this)(),$.proxy(a,this)(n),this.activateStatus&&$.proxy(p,this)())},e.prototype.loadData=function(){$.proxy(a,this)()},e.prototype.newFolder=function(){var e=$("#createIconFolder"),t=this.elements.containerEle,r=$.proxy(n,this)(!1),i=$.proxy(n,this)(!0),s,o,u;this.activateStatus&&($.proxy(w,this)(),0!==t.scrollTop()&&(u=setInterval(function(){var e=t.scrollTop()-50;e>0?t.scrollTop(e):(t.scrollTop(0),clearInterval(u))},10)),0===e.length?(t.find(".file").length>0?(s=$(r),s.insertBefore($("#"+this.loadedFiles[0].fileId+"_1"))):(s=$(i),t.children().replaceWith(s)),o=s.find(".new-folder-input")):o=e.find(".new-folder-input"),o.select())},e.prototype.createFolderFinished=function(e){var t=$("#createIconFolder"),n,r;e?(r=e,$.proxy(a,this)(this.loadedFiles),$.proxy(m,this)($("#"+r.fileId+"_1"),r.fileId)):t.find(".new-folder-input").select()},e.prototype.renameFile=function(e){var t=e.name,n=$("#"+e.fileId+"_1"),r=n.find("input");this.activateStatus&&(n.addClass("rename-status"),r.select(),"file"===e.type&&Common.selectRenamePart(r.get(0),t))},e.prototype.renameFileFinished=function(e){var t,n,r,i,s,o;"ok"===e.result?(t=e.fileId,i=e.newFile,n=e.newFile.fileId,$.proxy(a,this)(this.loadedFiles),$.proxy(m,this)($("#"+n+"_1"),n)):(s=$("#"+e.fileId+"_1"),s.find("input").select())},e.prototype.moveFileFinished=function(e){var t=e.success,n=e.failed,r=0,i=t.length,s,o=[],a;$.proxy(u,this)(Common.getFileIds(t)),this.activateStatus&&this.trigger("select",Common.subFileArray(this.loadedFiles,this.selectedIds))},e.prototype.deleteFileFinished=function(e){var t=e.success,n=e.failed,r=0,i=t.length,s,o=[],a;$.proxy(u,this)(Common.getFileIds(t)),this.activateStatus&&this.trigger("select",Common.subFileArray(this.loadedFiles,this.selectedIds))},e.prototype.addCooperateSuccess=function(e){var t=$("#"+e+"_1");t.find(".fl2").removeClass("i21").addClass("i23")},e.prototype.cancelCooperateSuccess=function(e){var t=$("#"+e+"_1");t.find(".fl2").removeClass("i23").addClass("i21")},e.prototype.sort=function(e){Util.sortArray(this.loadedFiles,function(t,n){return t.type===n.type?"desc"===e.direct?"size"===e.type?parseInt(t[e.type])<parseInt(n[e.type])?!0:!1:t[e.type]<n[e.type]?!0:!1:"size"===e.type?parseInt(t[e.type])>parseInt(n[e.type])?!0:!1:t[e.type]>n[e.type]?!0:!1:"folder"===n.type?!0:!1}),Common.group(this.loadedFiles),$.proxy(a,this)(this.loadedFiles),$.proxy(p,this)(),$.proxy(w,this)()},e}()}),"use strict",define("module/operatebar",["jquery","sandbox/sandbox"],function(){KP.OperateBar=function(){function e(){var e=this.elements={},t=e.containerEle=$("#file-operatebar");e.selectedOperateEle=t.find(".selected-operate"),e.switchViewContainerEle=t.find(".switch-view"),e.backButtonEle=t.find(".back"),e.sortEle=t.find(".sort")}function t(){$.proxy(e,this)(),$.proxy(y,this)(),this.parentDirFileId=undefined,this.files=null}function n(e){var t=[],n=e.length,r=Const.OPERATE,i;return n>0&&(1===n?(i=e[0],"folder"===i.type?(t.push(r.DOWNLOAD),t.push(r.OUTLINK),t.push(r.SHARE),t.push(r.RENAME),t.push(r.MOVE),t.push(r.DELETE)):(t.push(r.DOWNLOAD),t.push(r.OUTLINK),t.push(r.DELETE),t.push(r.RENAME),t.push(r.MOVE),i.iscanwow&&t.push(r.EDIT_ONLINE),i.iscanconvert&&t.push(r.VIEW_ONLINE))):(t.push(r.MOVE),t.push(r.DELETE))),t}function r(e){var t=[],r=[],i=n(e),s=i.length,o=0,u,a=Const.OPERATE_NAME;if(2===s)for(;o<s;o++)u=i[o],t.push('<li class="operate">'),t.push('<button class="btn '+u+'">'+a[u]+"</button>");else{for(;o<s;o++){u=i[o];if(o<3){t.push('<li class="operate"><button data-ca="operatebar-'+u+'" class="btn '+u+'" title="'+a[u]+'">');switch(u){case"download":t.push('<i class="i i60"></i> ');break;case"outlink":t.push('<i class="i i61"></i> ');break;case"rename":t.push('<i class="i i19"></i> ')}t.push(a[u]+"</button>")}else r.push('<li><a data-ca="operatebar-more-'+u+'" href="javascript:void(0)" class="'+u+'">'+a[u]+"</a>")}t.push('<li class="operate more">'),t.push('<button data-ca="operatebar-more" class="btn btnDrop more-button">更多<i class="i i1"></i></button>'),t.push('<div class="dropDown dn"><ul class="dropMenu">'),t=t.concat(r),t.push("</ul></div>")}return t.join("")}function i(e){var t=$(e.currentTarget);t.hasClass("btn_disable")||this.trigger("backToParentDir",this.parentDirFileId)}function s(e){}function o(e){var t=$(e.currentTarget);t.hasClass("forbidden")||(this.trigger("newFolder"),t.addClass("forbidden"))}function u(e){this.trigger("share",this.files[0])}function a(e){this.trigger("outlink",this.files[0])}function f(e){this.trigger("downloadFile",this.files[0])}function l(e){this.trigger("viewOnline",this.files[0],this.loadedFiles)}function c(e){this.trigger("editOnline",this.files[0])}function h(e){this.trigger("moveFile",this.files)}function p(e){this.trigger("renameFile",this.files[0])}function d(e){this.trigger("deleteFile",this.files)}function m(e){var t,n=[],r={modTime:'<li><a data-ca="sortby-time" href="javascript:void(0)" class="date $sortBy">时间<i class="i $sortIco"></i></a>',size:'<li><a data-ca="sortby-size" href="javascript:void(0)" class="size $sortBy">大小<i class="i $sortIco"></i></a>',name:'<li><a data-ca="sortby-name" href="javascript:void(0)" class="name $sortBy">名称<i class="i $sortIco"></i></a>'};for(t in r){if(e.type==t)continue;n.push(r[t].replace("$sortBy","desc").replace("$sortIco","i2"))}this.elements.sortEle.find("ul").html(r[e.type].replace("$sortBy",e.direct).replace("$sortIco",v(e.direct))+n.join(""))}function g(e){var t=$(e.currentTarget),n=this.elements.switchViewContainerEle;!t.hasClass("list-selected")&&!t.hasClass("icon-selected")&&(t.hasClass("list")?(t.addClass("list-selected"),n.find(".icon").removeClass("icon-selected"),this.trigger("file-list-view")):(t.addClass("icon-selected"),n.find(".list").removeClass("list-selected"),this.trigger("file-thumbnail-view")))}function y(){var e=this.elements,t=e.containerEle;t.on("mouseenter",".operate.more",function(e){$(e.currentTarget).children(".btnDrop").addClass("btn_active"),$(e.currentTarget).find(".dropDown").show()}),t.on("mouseleave",".operate.more",function(e){$(e.currentTarget).children(".btnDrop").removeClass("btn_active"),$(e.currentTarget).find(".dropDown").hide()}),t.on("click",".back",$.proxy(i,this)),t.on("click",".upload",$.proxy(s,this)),t.on("click",".newfolder",$.proxy(o,this)),t.on("click",".share",$.proxy(u,this)),t.on("click",".outlink",$.proxy(a,this)),t.on("click",".download",$.proxy(f,this)),t.on("click",".view-online",$.proxy(l,this)),t.on("click",".edit-online",$.proxy(c,this)),t.on("click",".move",$.proxy(h,this)),t.on("click",".rename",$.proxy(p,this)),t.on("click",".delete",$.proxy(d,this)),t.on("mouseenter",".sort > h2 > em",function(e){$(".sort > .dropDown2").show()}),t.on("mouseleave",".sort > .dropDown2",function(){$(".sort > .dropDown2").hide()}),t.on("click",".sort > .dropDown2 a",$.proxy(function(e){var t=$(e.currentTarget),n=t.closest(".dropMenu").find("a").get(0),r=t.get(0)==n,i=$(".sort h2"),s=i.find("b"),o=i.find("i.i"),u={};r?t.hasClass("asc")?(u.direct="desc",t.removeClass("asc").addClass("desc"),i.removeClass("desc asc").addClass("desc"),o.removeClass("i2 i3").addClass("i2")):(u.direct="asc",t.removeClass("desc").addClass("asc"),i.removeClass("desc asc").addClass("asc"),o.removeClass("i2 i3").addClass("i3")):(u.direct="desc",i.removeClass("desc asc").addClass("desc"),o.removeClass("i2 i3").addClass("i2")),t.hasClass("name")&&(u.type="name",s.text("名称")),t.hasClass("size")&&(u.type="size",s.text("大小")),t.hasClass("date")&&(u.type="modTime",s.text("时间")),$.proxy(m,this)(u),this.trigger("sort",u),r||$(".sort > .dropDown2").hide()},this)),t.on("click",".switch-view a",$.proxy(g,this))}$.extend(t.prototype,Event),t.prototype.createOperatebar=function(e,t){var n=this.elements,i=n.selectedOperateEle,s=r(e),o=e.length;i.html(s),0!==o?i.show():i.hide(),this.files=e,this.loadedFiles=t},t.prototype.updateBackButton=function(e){var t,n;"ok"===e.xLive_attr.result&&(n=e.xLive.parents,t=n.length,t>1?(this.parentDirFileId=n[1].fileId,this.elements.backButtonEle.removeClass("btn_disable btnDis")):1===t?(this.parentDirFileId="0",this.elements.backButtonEle.removeClass("btn_disable btnDis")):this.elements.backButtonEle.addClass("btn_disable btnDis"))},t.prototype.activateNewFolderButton=function(){var e=$(".newfolder");e.removeClass("forbidden")};var v=function(e){return e=="asc"?"i3":"i2"};return t.prototype.updateSwithViewButton=function(e){var t=this.elements.switchViewContainerEle;"list"===e?(t.find(".list").addClass("list-selected"),t.find(".icon").removeClass("icon-selected")):(t.find(".list").removeClass("list-selected"),t.find(".icon").addClass("icon-selected"))},t}()}),"use strict",define("module/path",["jquery","sandbox/sandbox"],function(){KP.Path=function(){function e(){var e;this.elements={},e=this.elements,e.containerEle=$("#file-path")}function t(t){this.hideRootPath=t.hideRootPath,this.overRootPath=t.overRootPath,$.proxy(e,this)(),$.proxy(o,this)(),$.extend(this,Event)}function n(e){var t=r(e,this.hideRootPath,this.overRootPath);this.elements.containerEle.html(t)}function r(e,t,n){var r=[],s=i(e),o,u;t||(n?r.push(n):r.push('<a href="javascript:;" class="root-dir" data-file-id="0">所有文件</a>'));if(s===undefined)for(o=e.length-1;o>=0;o--)u=e[o],r.push('<a href="javascript:;" title="'+u.name+'" data-file-id="'+u.fileId+'">'+Util.formateSubStr(u.name,12,-6)+"</a>");else{r.push("<span>...</span>");for(o=s;o>=0;o--)u=e[o],r.push('<a href="javascript:;" title="'+u.name+'" data-file-id="'+u.fileId+'">'+Util.formateSubStr(u.name,12,-6)+"</a>")}return r.join("<span>&gt;</span>")}function i(e){var t=0,n=e.length,r=0,i;for(;t<n;t++){i=e[t].name,Util.getStrLen(i)>33?r=r+33+(t+1)*2:r=r+Util.getStrLen(i)+(t+1)*2;if(r>100)return t-1}}function s(e){var t=$(e.currentTarget);if(t.hasClass("root-dir")&&$("#file-list").css("display")!=="none"){var n=window.location.href,r=n.indexOf("#");r===-1?window.location.href+="#":window.location.href=n.slice(0,r+1);return}var i=t.attr("data-file-id");this.trigger("jumpToDir",i)}function o(){var e=this.elements.containerEle;e.on("click","a",$.proxy(s,this))}return t.prototype.createPath=function(e){"ok"===e.xLive_attr.result&&$.proxy(n,this)(e.xLive.parents)},t}()}),define("lib/jquery/tree",["jquery"],function(){(function(e){function t(t){var n=e(t);return n.addClass("tree"),n}function n(t){function r(t,n){n.children("li").each(function(){var n=e(this),i={};i.text=n.children("span").html(),i.text||(i.text=n.html()),i.id=n.attr("id"),i.iconCls=n.attr("iconCls")||n.attr("icon"),i.checked=n.attr("checked")=="true",i.state=n.attr("state")||"open";var s=n.children("ul");s.length&&(i.children=[],r(i.children,s)),t.push(i)})}var n=[];return r(n,e(t)),n}function r(t){var n=e.data(t,"tree").options,r=e.data(t,"tree").tree;e("div.tree-node",r).unbind(".tree").bind("dblclick.tree",function(){A(t,this),n.onDblClick.call(t,E(t))}).bind("click.tree",function(){A(t,this),n.onClick.call(t,E(t))}).bind("mouseenter.tree",function(){return e(this).addClass("tree-node-hover"),!1}).bind("mouseleave.tree",function(){return e(this).removeClass("tree-node-hover"),!1}).bind("contextmenu.tree",function(e){n.onContextMenu.call(t,e,k(t,this))}),e("span.tree-hit",r).unbind(".tree").bind("click.tree",function(){var n=e(this).parent();return h(t,n[0]),!1}).bind("mouseenter.tree",function(){e(this).hasClass("tree-expanded")?e(this).addClass("tree-expanded-hover"):e(this).addClass("tree-collapsed-hover")}).bind("mouseleave.tree",function(){e(this).hasClass("tree-expanded")?e(this).removeClass("tree-expanded-hover"):e(this).removeClass("tree-collapsed-hover")}).bind("mousedown.tree",function(){return!1}),e("span.tree-checkbox",r).unbind(".tree").bind("click.tree",function(){var n=e(this).parent();return o(t,n[0],!e(this).hasClass("tree-checkbox1")),!1}).bind("mousedown.tree",function(){return!1})}function i(t){var n=e(t).find("div.tree-node");n.draggable("disable"),n.css("cursor","pointer")}function s(t){function i(r,i){function s(){var s=e(t).tree("pop",r);e(t).tree("append",{parent:i,data:[s]}),n.onDrop.call(t,i,s,"append")}k(t,i).state=="closed"?l(t,i,function(){s()}):s()}function s(r,i,s){var o={};s=="top"?o.before=i:o.after=i;var u=e(t).tree("pop",r);o.data=u,e(t).tree("insert",o),n.onDrop.call(t,i,u,s)}var n=e.data(t,"tree").options,r=e.data(t,"tree").tree;r.find("div.tree-node").draggable({disabled:!1,revert:!0,cursor:"pointer",proxy:function(t){var n=e('<div class="tree-node-proxy tree-dnd-no"></div>').appendTo("body");return n.html(e(t).find(".tree-title").html()),n.hide(),n},deltaX:15,deltaY:15,onBeforeDrag:function(t){if(t.which!=1)return!1;e(this).next("ul").find("div.tree-node").droppable({accept:"no-accept"})},onStartDrag:function(){e(this).draggable("proxy").css({left:-1e4,top:-1e4})},onDrag:function(t){var n=t.pageX,r=t.pageY,i=t.data.startX,s=t.data.startY,o=Math.sqrt((n-i)*(n-i)+(r-s)*(r-s));o>3&&e(this).draggable("proxy").show(),this.pageY=t.pageY},onStopDrag:function(){e(this).next("ul").find("div.tree-node").droppable({accept:"div.tree-node"})}}).droppable({accept:"div.tree-node",onDragOver:function(t,n){var r=n.pageY,i=e(this).offset().top,s=i+e(this).outerHeight();e(n).draggable("proxy").removeClass("tree-dnd-no").addClass("tree-dnd-yes"),e(this).removeClass("tree-node-append tree-node-top tree-node-bottom"),r>i+(s-i)/2?s-r<5?e(this).addClass("tree-node-bottom"):e(this).addClass("tree-node-append"):r-i<5?e(this).addClass("tree-node-top"):e(this).addClass("tree-node-append")},onDragLeave:function(t,n){e(n).draggable("proxy").removeClass("tree-dnd-yes").addClass("tree-dnd-no"),e(this).removeClass("tree-node-append tree-node-top tree-node-bottom")},onDrop:function(t,n){var r=this,o,u;e(this).hasClass("tree-node-append")?o=i:(o=s,u=e(this).hasClass("tree-node-top")?"top":"bottom"),setTimeout(function(){o(n,r,u)},0),e(this).removeClass("tree-node-append tree-node-top tree-node-bottom")}})}function o(t,n,r){function a(e){var t=e.next().find(".tree-checkbox");t.removeClass("tree-checkbox0 tree-checkbox1 tree-checkbox2"),e.find(".tree-checkbox").hasClass("tree-checkbox1")?t.addClass("tree-checkbox1"):t.addClass("tree-checkbox0")}function f(n){function s(t){var n=t.find(".tree-checkbox");if(n.hasClass("tree-checkbox0")||n.hasClass("tree-checkbox2"))return!1;var r=!0;return t.parent().siblings().each(function(){e(this).children("div.tree-node").children(".tree-checkbox").hasClass("tree-checkbox1")||(r=!1)}),r}function o(t){var n=t.find(".tree-checkbox");if(n.hasClass("tree-checkbox1")||n.hasClass("tree-checkbox2"))return!1;var r=!0;return t.parent().siblings().each(function(){e(this).children("div.tree-node").children(".tree-checkbox").hasClass("tree-checkbox0")||(r=!1)}),r}var r=b(t,n[0]);if(r){var i=e(r.target).find(".tree-checkbox");i.removeClass("tree-checkbox0 tree-checkbox1 tree-checkbox2"),s(n)?i.addClass("tree-checkbox1"):o(n)?i.addClass("tree-checkbox0"):i.addClass("tree-checkbox2"),f(e(r.target))}}var i=e.data(t,"tree").options;if(!i.checkbox)return;var s=e(n),o=s.find(".tree-checkbox");o.removeClass("tree-checkbox0 tree-checkbox1 tree-checkbox2"),r?o.addClass("tree-checkbox1"):o.addClass("tree-checkbox0"),i.cascadeCheck&&(f(s),a(s));var u=k(t,n);i.onCheck.call(t,u,r)}function u(t,n){var i=e.data(t,"tree").options,s=e(n);if(O(t,n)){var u=s.find(".tree-checkbox");u.length?u.hasClass("tree-checkbox1")?o(t,n,!0):o(t,n,!1):i.onlyLeafCheck&&(e('<span class="tree-checkbox tree-checkbox0"></span>').insertBefore(s.find(".tree-title")),r(t))}else{var u=s.find(".tree-checkbox");if(i.onlyLeafCheck)u.remove();else if(u.hasClass("tree-checkbox1"))o(t,n,!0);else if(u.hasClass("tree-checkbox2")){var a=!0,f=!0,l=y(t,n);for(var c=0;c<l.length;c++)l[c].checked?f=!1:a=!1;a&&o(t,n,!0),f&&o(t,n,!1)}}}function a(t,n,u,a){function v(t,n,r){for(var i=0;i<n.length;i++){var s=e("<li></li>").appendTo(t),o=n[i];o.state!="open"&&o.state!="closed"&&(o.state="open");var u=e('<div class="tree-node"></div>').appendTo(s);u.attr("node-id",o.id),e.data(u[0],"tree-node",{id:o.id,text:o.text,iconCls:o.iconCls,attributes:o.attributes}),e('<span class="tree-title"></span>').html(o.text).appendTo(u),f.checkbox&&(f.onlyLeafCheck?o.state=="open"&&(!o.children||!o.children.length)&&(o.checked?e('<span class="tree-checkbox tree-checkbox1"></span>').prependTo(u):e('<span class="tree-checkbox tree-checkbox0"></span>').prependTo(u)):o.checked?(e('<span class="tree-checkbox tree-checkbox1"></span>').prependTo(u),l.push(u[0])):e('<span class="tree-checkbox tree-checkbox0"></span>').prependTo(u));if(o.children&&o.children.length){var a=e("<ul></ul>").appendTo(s);o.state=="open"?(e('<span class="tree-icon tree-folder tree-folder-open"></span>').addClass(o.iconCls).prependTo(u),e('<span class="tree-hit tree-expanded"></span>').prependTo(u)):(e('<span class="tree-icon tree-folder"></span>').addClass(o.iconCls).prependTo(u),e('<span class="tree-hit tree-collapsed"></span>').prependTo(u),a.css("display","none")),v(a,o.children,r+1)}else o.state=="closed"?(e('<span class="tree-icon tree-folder"></span>').addClass(o.iconCls).prependTo(u),e('<span class="tree-hit tree-collapsed"></span>').prependTo(u)):(e('<span class="tree-icon tree-file"></span>').addClass(o.iconCls).prependTo(u),e('<span class="tree-indent"></span>').prependTo(u));for(var c=0;c<r;c++)e('<span class="tree-indent"></span>').prependTo(u)}}var f=e.data(t,"tree").options;a||e(n).empty();var l=[],c=e(n).prev("div.tree-node").find("span.tree-indent, span.tree-hit").length;v(n,u,c),r(t),f.dnd?s(t):i(t);for(var h=0;h<l.length;h++)o(t,l[h],!0);var p=null;if(t!=n){var d=e(n).prev();p=k(t,d[0])}f.onLoadSuccess.call(t,p,u)}function f(t,n,r,i){var s=e.data(t,"tree").options;r=r||{};var o=null;if(t!=n){var u=e(n).prev();o=k(t,u[0])}if(s.onBeforeLoad.call(t,o,r)==0)return;if(!s.url)return;var f=e(n).prev().children("span.tree-folder");f.addClass("tree-loading"),e.ajax({type:s.method,url:s.url,data:r,dataType:"json",success:function(e){f.removeClass("tree-loading"),a(t,n,e),i&&i()},error:function(){f.removeClass("tree-loading"),s.onLoadError.apply(t,arguments),i&&i()}})}function l(t,n,r){var i=e.data(t,"tree").options,s=e(n).children("span.tree-hit");if(s.length==0)return;if(s.hasClass("tree-expanded"))return;var o=k(t,n);if(i.onBeforeExpand.call(t,o)==0)return;s.removeClass("tree-collapsed tree-collapsed-hover").addClass("tree-expanded"),s.next().addClass("tree-folder-open");var u=e(n).next();if(u.length)i.animate?u.slideDown("normal",function(){i.onExpand.call(t,o),r&&r()}):(u.css("display","block"),i.onExpand.call(t,o),r&&r());else{var a=e('<ul style="display:none"></ul>').insertAfter(n);f(t,a[0],{id:o.id},function(){i.animate?a.slideDown("normal",function(){i.onExpand.call(t,o),r&&r()}):(a.css("display","block"),i.onExpand.call(t,o),r&&r())})}}function c(t,n){var r=e.data(t,"tree").options,i=e(n).children("span.tree-hit");if(i.length==0)return;if(i.hasClass("tree-collapsed"))return;var s=k(t,n);if(r.onBeforeCollapse.call(t,s)==0)return;i.removeClass("tree-expanded tree-expanded-hover").addClass("tree-collapsed"),i.next().removeClass("tree-folder-open");var o=e(n).next();r.animate?o.slideUp("normal",function(){r.onCollapse.call(t,s)}):(o.css("display","none"),r.onCollapse.call(t,s))}function h(t,n){var r=e(n).children("span.tree-hit");if(r.length==0)return;r.hasClass("tree-expanded")?c(t,n):l(t,n)}function p(e,t){var n=y(e,t);t&&n.unshift(k(e,t));for(var r=0;r<n.length;r++)l(e,n[r].target)}function d(e,t){var n=[],r=b(e,t);while(r)n.unshift(r),r=b(e,r.target);for(var i=0;i<n.length;i++)l(e,n[i].target)}function v(e,t){var n=y(e,t);t&&n.unshift(k(e,t));for(var r=0;r<n.length;r++)c(e,n[r].target)}function m(e){var t=g(e);return t.length?t[0]:null}function g(t){var n=[];return e(t).children("li").each(function(){var r=e(this).children("div.tree-node");n.push(k(t,r[0]))}),n}function y(t,n){function o(e){e.next().find("div.tree-node").each(function(){r.push(k(t,this))})}var r=[];if(n)o(e(n));else{var i=g(t);for(var s=0;s<i.length;s++)r.push(i[s]),o(e(i[s].target))}return r}function b(t,n){var r=e(n).parent().parent();return r[0]==t?null:k(t,r.prev()[0])}function w(t){var n=[];return e(t).find(".tree-checkbox1").each(function(){var r=e(this).parent();n.push(k(t,r[0]))}),n}function E(t){var n=e(t).find("div.tree-node-selected");return n.length?k(t,n[0]):null}function S(t,n){var r=e(n.parent),i;r.length==0?i=e(t):(i=r.next(),i.length==0&&(i=e("<ul></ul>").insertAfter(r)));if(n.data&&n.data.length){var s=r.find("span.tree-icon");if(s.hasClass("tree-file")){s.removeClass("tree-file").addClass("tree-folder");var o=e('<span class="tree-hit tree-expanded"></span>').insertBefore(s);o.prev().length&&o.prev().remove()}}a(t,i[0],n.data,!0),u(t,i.prev())}function x(t,n){var r=n.before||n.after,i=b(t,r),s;i?(S(t,{parent:i.target,data:[n.data]}),s=e(i.target).next().children("li:last")):(S(t,{parent:null,data:[n.data]}),s=e(t).children("li:last")),n.before?s.insertBefore(e(r).parent()):s.insertAfter(e(r).parent())}function T(t,n){var r=b(t,n),i=e(n),s=i.parent(),o=s.parent();s.remove();if(o.children("li").length==0){var i=o.prev();i.find(".tree-icon").removeClass("tree-folder").addClass("tree-file"),i.find(".tree-hit").remove(),e('<span class="tree-indent"></span>').prependTo(i),o[0]!=t&&o.remove()}r&&u(t,r.target)}function N(t,n){function r(n,r){r.children("li").each(function(){var r=e(this).children("div.tree-node"),i=k(t,r[0]),s=e(this).children("ul");s.length&&(i.children=[],N(i.children,s)),n.push(i)})}if(n){var i=k(t,n);return i.children=[],r(i.children,e(n).next()),i}return null}function C(t,n){var r=e(n.target),i=e.data(n.target,"tree-node");i.iconCls&&r.find(".tree-icon").removeClass(i.iconCls),e.extend(i,n),e.data(n.target,"tree-node",i),r.attr("node-id",i.id),r.find(".tree-title").html(i.text),i.iconCls&&r.find(".tree-icon").addClass(i.iconCls);var s=r.find(".tree-checkbox");s.removeClass("tree-checkbox0 tree-checkbox1 tree-checkbox2"),i.checked?o(t,n.target,!0):o(t,n.target,!1)}function k(t,n){var r=e.extend({},e.data(n,"tree-node"),{target:n,checked:e(n).find(".tree-checkbox").hasClass("tree-checkbox1")});return O(t,n)||(r.state=e(n).find(".tree-hit").hasClass("tree-expanded")?"open":"closed"),r}function L(t,n){var r=e(t).find("div.tree-node[node-id="+n+"]");return r.length?k(t,r[0]):null}function A(t,n){var r=e.data(t,"tree").options,i=k(t,n);if(r.onBeforeSelect.call(t,i)==0)return;e("div.tree-node-selected",t).removeClass("tree-node-selected"),e(n).addClass("tree-node-selected"),r.onSelect.call(t,i)}function O(t,n){var r=e(n),i=r.children("span.tree-hit");return i.length==0}function M(t,n){var r=e.data(t,"tree").options,i=k(t,n);if(r.onBeforeEdit.call(t,i)==0)return;e(n).css("position","relative");var s=e(n).find(".tree-title"),o=s.outerWidth();s.empty();var u=e('<input class="tree-editor">').appendTo(s);u.val(i.text).focus(),u.width(o+20),u.height(document.compatMode=="CSS1Compat"?18-(u.outerHeight()-u.height()):18),u.bind("click",function(e){return!1}).bind("mousedown",function(e){e.stopPropagation()}).bind("mousemove",function(e){e.stopPropagation()}).bind("keydown",function(e){if(e.keyCode==13)return _(t,n),!1;if(e.keyCode==27)return D(t,n),!1}).bind("blur",function(e){e.stopPropagation(),_(t,n)})}function _(t,n){var r=e.data(t,"tree").options;e(n).css("position","");var i=e(n).find("input.tree-editor"),s=i.val();i.remove();var o=k(t,n);o.text=s,C(t,o),r.onAfterEdit.call(t,o)}function D(t,n){var r=e.data(t,"tree").options;e(n).css("position",""),e(n).find("input.tree-editor").remove();var i=k(t,n);C(t,i),r.onCancelEdit.call(t,i)}e.fn.tree=function(r,o){if(typeof r=="string")return e.fn.tree.methods[r](this,o);var r=r||{};return this.each(function(){var o=e.data(this,"tree"),u;if(o)u=e.extend(o.options,r),o.options=u;else{u=e.extend({},e.fn.tree.defaults,e.fn.tree.parseOptions(this),r),e.data(this,"tree",{options:u,tree:t(this)});var l=n(this);l.length&&!u.data&&(u.data=l)}u.data?a(this,this,u.data):u.dnd?s(this):i(this),u.url&&f(this,this)})},e.fn.tree.methods={options:function(t){return e.data(t[0],"tree").options},loadData:function(e,t){return e.each(function(){a(this,this,t)})},getNode:function(e,t){return k(e[0],t)},getData:function(e,t){return N(e[0],t)},reload:function(t,n){return t.each(function(){if(n){var t=e(n),r=t.children("span.tree-hit");r.removeClass("tree-expanded tree-expanded-hover").addClass("tree-collapsed"),t.next().remove(),l(this,n)}else e(this).empty(),f(this,this)})},getRoot:function(e){return m(e[0])},getRoots:function(e){return g(e[0])},getParent:function(e,t){return b(e[0],t)},getChildren:function(e,t){return y(e[0],t)},getChecked:function(e){return w(e[0])},getSelected:function(e){return E(e[0])},isLeaf:function(e,t){return O(e[0],t)},find:function(e,t){return L(e[0],t)},select:function(e,t){return e.each(function(){A(this,t)})},check:function(e,t){return e.each(function(){o(this,t,!0)})},uncheck:function(e,t){return e.each(function(){o(this,t,!1)})},collapse:function(e,t){return e.each(function(){c(this,t)})},expand:function(e,t){return e.each(function(){l(this,t)})},collapseAll:function(e,t){return e.each(function(){v(this,t)})},expandAll:function(e,t){return e.each(function(){p(this,t)})},expandTo:function(e,t){return e.each(function(){d(this,t)})},toggle:function(e,t){return e.each(function(){h(this,t)})},append:function(e,t){return e.each(function(){S(this,t)})},insert:function(e,t){return e.each(function(){x(this,t)})},remove:function(e,t){return e.each(function(){T(this,t)})},pop:function(e,t){var n=e.tree("getData",t);return e.tree("remove",t),n},update:function(e,t){return e.each(function(){C(this,t)})},enableDnd:function(e){return e.each(function(){s(this)})},disableDnd:function(e){return e.each(function(){i(this)})},beginEdit:function(e,t){return e.each(function(){M(this,t)})},endEdit:function(e,t){return e.each(function(){_(this,t)})},cancelEdit:function(e,t){return e.each(function(){D(this,t)})}},e.fn.tree.parseOptions=function(t){var n=e(t);return{url:n.attr("url"),method:n.attr("method")?n.attr("method"):undefined,checkbox:n.attr("checkbox")?n.attr("checkbox")=="true":undefined,cascadeCheck:n.attr("cascadeCheck")?n.attr("cascadeCheck")=="true":undefined,onlyLeafCheck:n.attr("onlyLeafCheck")?n.attr("onlyLeafCheck")=="true":undefined,animate:n.attr("animate")?n.attr("animate")=="true":undefined,dnd:n.attr("dnd")?n.attr("dnd")=="true":undefined}},e.fn.tree.defaults={url:null,method:"post",animate:!1,checkbox:!1,cascadeCheck:!0,onlyLeafCheck:!1,dnd:!1,data:null,onBeforeLoad:function(e,t){},onLoadSuccess:function(e,t){},onLoadError:function(){},onClick:function(e){},onDblClick:function(e){},onBeforeExpand:function(e){},onExpand:function(e){},onBeforeCollapse:function(e){},onCollapse:function(e){},onCheck:function(e,t){},onBeforeSelect:function(e){},onSelect:function(e){},onContextMenu:function(e,t){},onDrop:function(e,t,n){},onBeforeEdit:function(e){},onAfterEdit:function(e){},onCancelEdit:function(e){}}})(jQuery)}),"use strict",define("module/move_file",["lib/jquery/tree"],function(e){return window.moveFile=function(){function n(){t?(i(),t.show()):(t=new Dialog({width:500,html:s()}),o()),$("#file-tree").tree({animate:!1,url:"/index.php?ac=fileview_handler&op=getdir",onClick:function(e){$("#file-tree").tree("toggle",e.target),r()}})}function r(){t.element.find(".dialog-button-light").removeAttr("disabled").removeClass("btn_disable")}function i(){t.element.find(".dialog-button-light").attr("disabled",!0).addClass("btn_disable")}function s(){var e=['<div class="dialogT">请选择您需要移动的位置</div>','<div class="dialogC">','<ul id="file-tree" class="file-tree"></ul>',"</div>",'<div class="dialogB btns2">','<button class="btn dialog-button-dark">取消</button><button class="btn btn_primary dialog-button-light btn_disable" disabled>确定</button>',"</div>"].join("");return e}function o(){var n=t.element;n.on("click",".dialog-button-dark",function(){t.hide()}),n.on("click",".dialog-button-light",function(){var n=$("#file-tree").tree("getSelected");e.trigger("moveFileMessage",{type:"loading",content:"正在努力为您移动"+e.files.length+"个文件",time:-1}),e.trigger("moveFile",{moveTo:n.id,fileIds:Common.getFileIds(e.files)}),t.hide()})}var e={},t;return $.extend(e,Event),e.show=function(t){e.files=t,n()},e}(),moveFile}),"use strict",define("module/delete_file",["jquery","common/core/common"],function(){window.deleteFile=function(){function n(){t?(t.element.find(".file-number").text(e.fileNumber),t.show()):(t=new Dialog({width:300,html:r()}),i())}function r(){var t=['<div class="dialogT">删除提示</div>','<div class="dialogC">','<div class="IxMsg IxMsgAsk">','<p class="IxMsgI">','<p class="IxMsgT">您确定要删除这<strong class="file-number">'+e.fileNumber+"</strong>个文件吗？",'<div class="IxMsgC">删除后如果您正在使用客户端，会同步删除电脑上的文件，您可以通过“回收站”来还原文件</div>',"</div>","</div>",'<div class="dialogB btns2">','<button class="btn dialog-button-dark">取消</button><button class="btn btn_primary dialog-button-light">确定</button>',"</div>"].join("");return t}function i(){var n=t.element;n.on("click",".dialog-button-dark",function(){t.hide()}),n.on("click",".dialog-button-light",function(){e.trigger("deleteFile",e.fileIds),e.trigger("deleteFileMessage",{type:"loading",content:'正在努力为您删除<span class="file-number">'+e.fileNumber+"</span>文件",time:-1}),t.hide()})}var e={},t;return $.extend(e,Event),e.confirmDelete=function(e){this.files=e,this.fileNumber=e.length,this.fileIds=Common.getFileIds(e),n()},e}()}),"use strict",define("module/file_management",["module/model","module/share","module/download_file","module/file_list","module/file_thumbnail","module/operatebar","module/path","module/move_file","module/delete_file"],function(){var e=function(){function i(r){"0"===r?(t.deactivate(),e.activate(),$.proxy(n.updateSwithViewButton,n)("list")):(e.deactivate(),t.activate(),$.proxy(n.updateSwithViewButton,n)("icon"))}function s(){var e=hash.getHash();i(e.viewType),Model.loadDir(e.fileId),Model.getPath(e.fileId)}var e=new KP.FileList({}),t=new KP.FileThumbnail({}),n=new KP.OperateBar({}),r=new KP.Path({});return hash.on("dirChange",$.proxy(Model.loadDir,Model)),hash.on("refreshDir",$.proxy(Model.loadDir,Model)),hash.on("dirChange",$.proxy(Model.getPath,Model)),hash.on("viewChange",i),Model.on("loadDir",$.proxy(e.loadDir,e)),Model.on("loadDir",$.proxy(t.loadDir,t)),Model.on("getPath",$.proxy(r.createPath,r)),Model.on("getPath",$.proxy(n.updateBackButton,n)),Model.on("createFolderFinished",$.proxy(e.createFolderFinished,e)),Model.on("createFolderFinished",$.proxy(t.createFolderFinished,t)),Model.on("createFolderFinished",$.proxy(n.activateNewFolderButton,n)),Model.on("renameFileFinished",$.proxy(e.renameFileFinished,e)),Model.on("renameFileFinished",$.proxy(t.renameFileFinished,t)),Model.on("moveFileFinished",$.proxy(e.moveFileFinished,e)),Model.on("moveFileFinished",$.proxy(t.moveFileFinished,t)),Model.on("deleteFileFinished",$.proxy(e.deleteFileFinished,e)),Model.on("deleteFileFinished",$.proxy(t.deleteFileFinished,t)),Model.on("operateMessage",$.proxy(operateMessage.show,operateMessage)),Model.on("checkHasPublicLinkFinished",$.proxy(share.checkHasPublicLink,share)),Model.on("publishShareLinkFinished",$.proxy(share.publishShareLinkFinished,share)),Model.on("republishShareLinkFinished",$.proxy(share.republishShareLinkFinished,share)),Model.on("sendEmailFinished",$.proxy(share.sendEmailFinished,share)),r.on("jumpToDir",$.proxy(t.loadData,t)),r.on("jumpToDir",$.proxy(e.loadData,e)),r.on("jumpToDir",$.proxy(hash.updateHash,hash)),e.on("select",$.proxy(n.createOperatebar,n)),e.on("openFolder",$.proxy(hash.updateHash,hash)),e.on("createFolder",$.proxy(Model.createFolder,Model)),e.on("cancelCreateFolder",$.proxy(n.activateNewFolderButton,n)),e.on("renameFileSubmit",$.proxy(Model.renameFile,Model)),e.on("moveFile",$.proxy(Model.moveFile,Model)),e.on("moveFileDialog",$.proxy(moveFile.show,moveFile)),e.on("downloadFile",$.proxy(downloadFile.show,downloadFile)),e.on("deleteFile",$.proxy(deleteFile.confirmDelete,deleteFile)),e.on("editOnline",$.proxy(editOnline.show,editOnline)),e.on("viewOnline",function(e,t){KP.Core.moduleData["fileview-onlineview"].instance.start(e,t)}),e.on("outlink",$.proxy(share.show,share)),e.on("share",function(e){KP.Core.moduleData["fileview-share"].instance.start(e)}),t.on("select",$.proxy(n.createOperatebar,n)),t.on("openFolder",$.proxy(hash.updateHash,hash)),t.on("createFolder",$.proxy(Model.createFolder,Model)),t.on("cancelCreateFolder",$.proxy(n.activateNewFolderButton,n)),t.on("moveFile",$.proxy(Model.moveFile,Model)),t.on("moveFileDialog",$.proxy(moveFile.show,moveFile)),t.on("renameFileSubmit",$.proxy(Model.renameFile,Model)),t.on("downloadFile",$.proxy(downloadFile.show,downloadFile)),t.on("deleteFile",$.proxy(deleteFile.confirmDelete,deleteFile)),t.on("editOnline",$.proxy(editOnline.show,editOnline)),t.on("viewOnline",function(e,t){KP.Core.moduleData["fileview-onlineview"].instance.start(e,t)}),t.on("outlink",$.proxy(share.show,share)),t.on("share",function(e){KP.Core.moduleData["fileview-share"].instance.start(e)}),n.on("backToParentDir",$.proxy(hash.updateHash,hash)),n.on("backToParentDir",$.proxy(e.loadData,e)),n.on("backToParentDir",$.proxy(t.loadData,t)),n.on("newFolder",$.proxy(e.newFolder,e)),n.on("newFolder",$.proxy(t.newFolder,t)),n.on("renameFile",$.proxy(e.renameFile,e)),n.on("renameFile",$.proxy(t.renameFile,t)),n.on("sort",$.proxy(e.sort,e)),n.on("sort",$.proxy(t.sort,t)),n.on("deleteFile",$.proxy(deleteFile.confirmDelete,deleteFile)),n.on("downloadFile",$.proxy(downloadFile.show,downloadFile)),n.on("moveFile",$.proxy(moveFile.show,moveFile)),n.on("viewOnline",function(e,t){KP.Core.moduleData["fileview-onlineview"].instance.start(e,t)}),n.on("editOnline",$.proxy(editOnline.show,editOnline)),n.on("share",function(e){KP.Core.moduleData["fileview-share"].instance.start(e)}),n.on("outlink",$.proxy(share.show,share)),n.on("file-list-view",function(){hash.changView("list")}),n.on("file-thumbnail-view",function(){hash.changView("icon")}),moveFile.on("moveFile",$.proxy(Model.moveFile,Model)),deleteFile.on("deleteFile",$.proxy(Model.deleteFile,Model)),share.on("checkHasPublicLink",$.proxy(Model.checkHasPublicLink,Model)),share.on("publishShareLink",$.proxy(Model.publicShareLink,Model)),share.on("createPassword",$.proxy(Model.republishShareLink,Model)),share.on("cancelSharelink",$.proxy(Model.cancelSharelink,Model)),share.on("sendEmail",$.proxy(Model.sendEmail,Model)),e.on("operateMessage",$.proxy(operateMessage.show,operateMessage)),t.on("operateMessage",$.proxy(operateMessage.show,operateMessage)),share.on("operateMessage",$.proxy(operateMessage.show,operateMessage)),deleteFile.on("deleteFileMessage",$.proxy(operateMessage.show,operateMessage)),moveFile.on("moveFileMessage",$.proxy(operateMessage.show,operateMessage)),s(),{activate:function(){$("#filemangebox").removeClass("dn")},fileList:e,fileThumbnail:t}};KP.fileManagement=e()}),"use strict",define("component/imageviewer/imageviewer",["common/core/common"],function(e){return window.ImageViewer=function(){function g(e,t){var n=t[e];s=t,a=e,w(n),ct(),N(),Y(),y()}function y(){0!==r.length?r.show():(r=$('<div id="imageviewer-overlay" class="full imageviewer-overlay"></div>'),window.XMLHttpRequest||r.css({width:n.clientWidth,height:n.clientHeight,backgroundColor:"#000"}),r.insertBefore($("#imageviewer")))}function b(){r.hide()}function w(e){var t=S(e),n=$(t),r=n.find(".show"),s=n.find(".image-container");E(),s.css({width:l.width*.618,height:l.height*.618,marginTop:l.height*.382/2+80,backgroundPosition:(l.width*.618-173)/2+"px "+(l.height*.618-131)/2+"px"}),i=n,O(e,function(t,n){s.show(),B(t,null,e.name)}),$("body").append(n)}function E(){var e=n.clientWidth,t=n.clientHeight,r=0,i=e-r,s=t-160;l.width=i,l.height=s}function S(e){var t=[],n=x();return t.push('<div id="imageviewer" class="full imageviewer">'),t.push(T(e.name)),t.push(' <div class="show">'),t.push('     <div class="image-container">'),t.push('         <button class="close"></button>'),t.push("     </div>"),t.push('     <ul class="operate-bar">'),t.push('         <li><a href="javascript:;" class="rotate-left" title="向左旋转"></a>'),t.push('         <li><a href="javascript:;" class="rotate-right" title="向右旋转"></a>'),t.push('          <li><a href="http://www.kachayu.com/ksyunlaunch" class="print" title="" target="_blank"></a>'),t.push('          <li><a href="javascript:;" class="download" title="下载"></a>'),t.push("     </ul>"),0!==a?t.push(' <a href="javascript:;" class="previous"></a>'):t.push(' <a href="javascript:;" class="previous dn"></a>'),s.length!==a+1?t.push(' <a href="javascript:;" class="next"></a>'):t.push(' <a href="javascript:;" class="next dn"></a>'),t.push(" </div>"),t.push(n),t.push("</div>"),t.join("")}function x(){var e=[];return e.push(' <div class="carousel clBottom">'),e.push('     <a href="javascript:;" class="previous-page"></a>'),e.push('     <div class="thumbnails">'),e.push("         <ul></ul>"),e.push("     </div>"),e.push('     <a href="javascript:;" class="next-page"></a>'),e.push(" </div>"),e.join("")}function T(e){return['<div class="carousel clTop">',"<ul>","<li>"+e,'<li><a href="javascript:;" class="mobi">下载手机客户端，同步相册</a>',"</ul>","</div>"].join("")}function N(){L(a,u),C(a,u)}function C(e,t){var n,r;r=e-t<0?0:e-t;for(n=r;n<e;n++)O(s[n])}function k(e,t){var n,r;e=e-t<0?0:e-t;for(n=e;n<e+t;n++)r=s[n].fileId,$(o[r]).remove(),delete o[r]}function L(e,t){var n,r;r=e+t<=s.length-1?e+t:s.length-1;for(n=e+1;n<=r;n++)O(s[n])}function A(e,t){var n,r,i;r=e+t<=s.length-1?e+t:s.length-1;for(n=e+1;n<=r;n++)i=s[n].fileId,$(o[i]).remove(),delete o[i]}function O(t,n){var r=e.getImageUrl({fileId:t.fileId,fileVersion:t.fileVer,width:l.width,height:l.height});o[t.fileId]?n&&n(o[t.fileId],t.fileId):_(r,t.fileId,function(e,t){e.style.display="none",!o[t]&&i&&(o[t]=e,i.find(".image-container").append(e)),n&&n(o[t],t)})}function M(t,n){var r=e.getImageUrl({fileId:t.fileId,fileVersion:t.fileVer,width:100,height:75}),i=_(r,t.fileId,function(e,t){e.style.width="100px",e.style.height="75px",n&&n(e,t)});return i}function _(e,t,n){var r=new Image;return r.src=e,r.complete?n(r,t):r.onload=function(){r.onload=null,n(r,t)},r}function D(e){var t,n,r,l,c=a-1;c>=0?(t=f.ele,n=s[c],r=n.fileId,l=o[r],l?B(l,t,n.name):(f.ele.style.cssText="display: none;",O(n,function(e,t){t===s[a].fileId&&B(e,null,s[a].name)})),ot(c),a-u>0&&C(a-u,1),a+u<=s.length-1&&A(a+u-1,1),a=c,i.find(".current-index").text(a+1),i.find(".previous").show()):i.find(".previous").hide(),i.find(".next").show()}function P(e){var t,n,r,l,c=a+1;c<=s.length-1?(t=f.ele,n=s[c],r=n.fileId,l=o[r],l?B(l,t,n.name):(f.ele.style.cssText="display: none;",O(n,function(e,t){s[a]&&t===s[a].fileId&&B(e,null,s[a].name)})),ot(c),a+u<s.length-1&&L(a+u,1),a-u>=0&&k(a-u+1,1),a=c,i.find(".current-index").text(a+1),i.find(".next").show()):i.find(".next").hide(),i.find(".previous").show()}function H(e){var t=s[e];e!==a&&(O(t,function(e){B(e,f.ele,t.name)}),C(e,u),L(e,u))}function B(e,t,n){var r,i,s;f.width=e.width,f.height=e.height,f.ele=e,$(".clTop li").eq(0).html(n),t&&(t.style.cssText="display: none"),j(e)}function j(t){$(t).attr("angle")&&(V(0),$(t).attr("angle","").attr("style",""));var n={width:f.width,height:f.height},r=e.compressSize(n,l),s=(l.height-r.height)/2;t.style.width=r.width+"px",t.style.height=r.height+"px",t.style.display="inline-block",i.find(".image-container").css({width:r.width,height:r.height,marginTop:s+80,backgroundPosition:(r.width-173)/2+"px "+r.height/2+"px"})}function F(e){var t=e.originalEvent,n=t.wheelDelta||-t.detail*40;n>0?D():P()}function I(e){var t=i.find(".operate-bar"),n=t.css("width");"0px"===n?t.animate({width:"60px"}):t.animate({width:"0px"})}function q(e){downloadFile.show(s[a])}function R(e){}function U(e){}function z(e){}function W(){var e=f.ele,t;if(!e)return;t=e.getAttribute("angle")||0,t=parseInt(t)-90,V(t)}function X(){var e=f.ele,t;if(!e)return;t=e.getAttribute("angle")||0,t=parseInt(t)+90,V(t)}function V(t){var n=f.ele,r,s,o,u,a,c,h=(t%360+360)%360/90;h===0||h===2?r={width:f.width,height:f.height}:r={width:f.height,height:f.width},s=e.compressSize(r,l),o=e.compressPercent(r,l),o=o||1,u=(l.height-s.height)/2,i.find(".image-container").css({width:s.width,height:s.height,marginTop:u+80}),a=(f.width-r.width)/2+r.width*(1-o)/2,c=(f.height-r.height)/2+r.height*(1-o)/2,n.style.cssText=J(t,o,a,c),n.setAttribute("angle",t)}function J(e,t,n,r){var i=[],s,o,u,a;return window.ActiveXObject?(s=Math.cos(e*.017453293)*t,o=-Math.sin(e*.017453293)*t,u=Math.sin(e*.017453293)*t,a=Math.cos(e*.017453293)*t,i.push("filter:progid:DXImageTransform.Microsoft.Matrix(M11="+s+",M12="+o+",M21="+u+",M22="+a+",SizingMethod='auto expand');}")):(i.push("transform: rotate("+e+"deg) scale("+t+");"),i.push("-webkit-transform: rotate("+e+"deg) scale("+t+");"),i.push("-moz-transform: rotate("+e+"deg) scale("+t+");"),i.push("-o-transform: rotate("+e+"deg) scale("+t+");"),i.push("top: "+ -r+"px;"),i.push("left: "+ -n+"px;")),i.join("")}function K(){var e=n.clientWidth-p*2;c=Math.floor(e/h)}function Q(){var e=Math.floor(c/2);return G(e,c-e-1)}function G(e,t){if(a-e<=0&&a+t>=s.length-1)return{begin:0,end:s.length-1};if(a-e<0&&a+t<s.length-1)return e-=1,t+=1,G(e,t);if(a-e>0&&a+t>s.length-1)return e+=1,t-=1,G(e,t);if(a-e>=0&&a+t<=s.length-1)return{begin:a-e,end:a+t}}function Y(){var e,t=i.find(".thumbnails"),n=t.find("ul"),r,o,u=[];K();var f=Q();v.begin=f.begin,v.end=f.end,d.begin=f.begin,d.end=f.end;for(e=f.begin;e<=f.end;e++)r=M(s[e]),e===a?o=$('<li class="selected" data-index="'+e+'"></li>').append(r).append($('<a href="javascript:void 0"></a>')):o=$('<li data-index="'+e+'"></li>').append(r).append($('<a href="javascript:void 0"></a>')),u.push(o),n.append(o);tt(c),et(c)}function Z(e,t){var n=Math.max(e.children("li").length*h,t.width());e.width(n)}function et(e){var t,n,r,o=[],u,a,f=[],l=i.find(".thumbnails"),c=l.find("ul");t=d.begin-e,n=d.begin,t<0&&(t=0);for(r=n-1;r>=t;r--)u=M(s[r]),a=$('<li data-index="'+r+'"></li>').append(u).append($('<a href="javascript:void 0"></a>')),c.prepend(a);c.css({marginLeft:h*(t-v.begin)+"px"}),d.begin=t,Z(c,l)}function tt(e){var t,n,r,o=[],u,a,f=[],l=i.find(".thumbnails"),c=l.find("ul");t=d.end+1,n=d.end+e,n>=s.length-1&&(n=s.length-1);for(r=t;r<=n;r++)u=M(s[r]),a=$('<li data-index="'+r+'"></li>').append(u).append($('<a href="javascript:void 0"></a>')),c.append(a);d.end=n,Z(c,l)}function nt(e){rt(c)}function rt(e){var t=i.find(".thumbnails ul"),n=e;v.begin-n<=0&&(n=v.begin,i.find(".first-page").show(),setTimeout(function(){i&&i.find(".first-page").fadeOut("slow")},2e3)),et(n),v.begin=v.begin-n,v.end=v.end-n,t.stop().animate({marginLeft:(d.begin-v.begin)*h+"px"})}function it(e){st(c)}function st(e){var t=i.find(".thumbnails ul"),n=e;v.end+n>=s.length-1&&(n=s.length-1-v.end,i.find(".last-page").show(),setTimeout(function(){i.find(".last-page").fadeOut("slow")},2e3)),v.begin=v.begin+n,v.end=v.end+n,t.stop().animate({marginLeft:(d.begin-v.begin)*h+"px"}),tt(n)}function ot(e){var t=$('[data-index="'+a+'"]'),n=$('[data-index="'+e+'"]'),r=Math.floor(c/2)+v.begin;t.removeClass("selected"),n.addClass("selected"),r-e>0&&rt(r-e),r-e<0&&st(e-r)}function ut(e){var t=$(this),n=t.attr("data-index");n=parseInt(n);if(n===undefined)return;H(n),ot(n),a=n,i.find(".current-index").text(a+1)}function at(t){return e.getImageUrl({fileId:t.fileId,fileVersion:t.fileVer,width:100,height:75})}function ft(e){if(i&&f.ele){E(),j(f.ele);var t=i.find(".thumbnails"),n=t.find("ul");K();var r=Q();v.begin=r.begin,v.end=r.end,v.begin<d.begin&&et(v.begin-d.begin),v.end>d.end&&tt(v.end-d.end),n.css({marginLeft:(d.begin-v.begin)*h+"px"}),Z(n,t)}}function lt(e){27===e.keyCode&&i&&t.close();if((39===e.keyCode||40===e.keyCode||13===e.keyCode&&!e.shiftKey)&&i)return P(),!1;if((37===e.keyCode||38===e.keyCode||13===e.keyCode&&e.shiftKey)&&i)return D(),!1}function ct(){function n(e){var t=['<div class="dialogT">手机二维码</div>','<div class="dialogC">','<div class="btns3 mt10">','<img src="'+e+'">',"</div>",'<div class="btns3 mt10">',"使用二维码，下载到手机","</div>",'<div class="btns3 mt10">','<a href="http://www.kuaipan.cn/file/id_38508569401874622.htm" target="_blank">下载手机扫码软件</a>',"</div>","</div>"].join("");return t}function r(e){var t=encodeURIComponent("http://t1.dfs.kuaipan.cn/cdlsched/getdl?fid="+e+"&acc_params=entryid:"+e+",pickupCode:&extm=1376900918-9f06af99b87c26a864acd4cd121eecc6&snk_in_get=1");return"http://chart.apis.google.com/chart?chs=200x200&choe=UTF-8&cht=qr&chld=L|5&chl="+t}i.on("click",".previous",D),i.on("click",".next",P),i.on("click",".operate",I),i.on("click",".download",q),i.on("click",".share",R),i.on("click",".delete",U);var e=!$.browser.mozilla&&!$.browser.webkit;e&&(i.find(".rotate-left").hide(),i.find(".rotate-right").hide()),i.on("click",".rotate-left",W),i.on("click",".rotate-right",X),i.on("click",".info",z),i.on("mousewheel",F),i.on("DOMMouseScroll",F),i.on("click",".previous-page",nt),i.on("click",".next-page",it),i.on("click",".clBottom li",ut),i.on("click",".close",t.close),i.on("click",".clTop .mobi",function(){var e="//i3.s.ksyun.com/4/029.png",t=new Dialog({width:300,html:n(e),beforeClose:function(){t.destory()}})})}var t={},n=document.documentElement,r=$("#overlay"),i=null,s=[],o={},u=8,a=0,f={},l={},c=0,h=114,p=28,d={},v={},m=e.browser();return t.show=function(e,t){g(e,t)},t.close=function(){i.remove(),i=null,s=[],o={},a=0,f={},l={},c=0,d={},v={},b()},$("body").on("keydown",lt),$(window).on("resize",ft),t}(),ImageViewer}),typeof window.localStorage=="undefined"&&~function(){var e=window.localStorage={},t="data-userdata",n=document,r=n.body,i=function(e,n,i,s){r.load(t),i=r.getAttribute(t)||"",s=RegExp("\\b"+e+"\\b,?","i");var o=s.test(i)?1:0;i=n?i.replace(s,""):o?i:i===""?e:i.split(",").concat(e).join(","),alert(i),r.setAttribute(t,i),r.save(t)};r.addBehavior("#default#userData"),e.getItem=function(e){return r.load(e),r.getAttribute(e)},e.setItem=function(e,t){r.setAttribute(e,t),r.save(e),i(e)},e.removeItem=function(e){r.removeAttribute(e),r.save(e),i(e,1)},e.clear=function(){r.load(t);var e=r.getAttribute(t).split(","),n=e.length;if(e[0]==="")return;for(var i=0;i<n;i++)r.removeAttribute(e[i]),r.save(e[i]);r.setAttribute(t,""),r.save(t)}}(),define("lib/localStorage",function(){}),"use strict",define("component/warn/mailInvalid",["jquery","lib/localStorage","lib/dialog/dialog"],function(){if(!CONST.umail)return;var e=CONST.umail.split("@")[1];if(!e)return;if(!e.match(/(yahoo.cn|yahoo.com.cn)$/))return;if(localStorage){if(localStorage.getItem("yahooMailTip"))return;localStorage.setItem("yahooMailTip",1)}new Dialog({html:['<div style="margin:1em 3em 0;line-height:20px;color:#c30">','<p style="height:40px;line-height:40px;font-weight:bold;color:#c30">亲爱的快盘用户：','<p>为了保障您的快盘账号服务不受 <a target="_blank" href="http://migration.cn.yahoo.com/explain.php" style="text-decoration:underline">雅虎邮箱变更</a> 的影响，',"<p>我们开通了快盘绑定邮箱修改服务。",'<p style="margin:1em 0 0"><a href="/personal.htm" style="text-decoration:underline;font-weight:bold;color:green">立即前往进行修改&gt;&gt;</a>',"</div>"].join("")})}),"use strict",require.config({baseUrl:"//j2.s.ksyun.com/pan/v1.1/1378294456726"}),require(["common/config","lib/jquery/ui.custom","module/hash","module/fileview/navlink","extends/zeroclipboard/zeroclipboard","module/operate_message","module/search","module/view_online","module/edit_online","module/select_contact_to_share","module/model","module/fileview/kplist","module/fileview/search","module/fileview/sharelist","module/fileview/linklist","module/fileview/opmenu","module/fileview/share","module/fileview/exitshare","module/fileview/sharemove","module/fileview/outlinkfile","module/fileview/deloutlink","module/fileview/onlineview","module/fileview/newuser","module/fileview/recycle","module/file_management","component/imageviewer/imageviewer","component/warn/mailInvalid"],function(){require(["module/fileview/upload"],function(){KP.Core.startAll(),KP.Core.startApp()})}),define("app/home/main",function(){});